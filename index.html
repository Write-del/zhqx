<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Êô∫ËÉΩÂÅ•Â∫∑ÈóÆËØäÁ≥ªÁªü</title>
    <link rel="stylesheet" href="mobile-responsive.css">
    <style>
        /* Âü∫Á°ÄÊ†∑Âºè - ÂåªÁñó‰∏ªÈ¢ò */
        :root {
            --primary: #1a73e8;
            --secondary: #34a853;
            --accent: #4285f4;
            --warning: #ea4335;
            --gray-light: #f8f9fa;
            --gray-mid: #dadce0;
            --gray-dark: #5f6368;
            --font-size-base: 15px;
            --font-size-large: 18px;
            --font-size-xlarge: 22px;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            margin: 0 auto;
            padding: 20px;
            background: #f0f4f8;
            color: #333;
            line-height: 1.6;
            font-size: var(--font-size-base);
        }

        /* Êñ∞Â¢ûÔºöÈ°∂ÈÉ®Â∑•ÂÖ∑Ê†è */
        .top-toolbar {
            position: absolute;
            top: 15px;
            right: 20px;
            display: flex;
            gap: 15px;
            z-index: 100;
        }

        .toolbar-btn {
            background: white;
            border: 1px solid var(--gray-mid);
            border-radius: 20px;
            padding: 8px 15px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .toolbar-btn:hover {
            background: var(--gray-light);
            border-color: var(--accent);
        }

        .toolbar-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Â§ßÂ≠ó‰ΩìÊ®°Âºè */
        body.large-font {
            --font-size-base: 18px;
            --font-size-large: 22px;
            --font-size-xlarge: 26px;
        }

        body.x-large-font {
            --font-size-base: 22px;
            --font-size-large: 26px;
            --font-size-xlarge: 32px;
        }

        /* ÊñáÂ≠óÂ§ßÂ∞èÂ∫îÁî®Âà∞ÂÖ∑‰ΩìÂÖÉÁ¥† */
        input, select, textarea, button, .checkbox-item span, label {
            font-size: var(--font-size-base);
        }

        legend, h4, .section-title {
            font-size: var(--font-size-large);
        }

        h1, h2, h3 {
            font-size: var(--font-size-xlarge);
        }
    
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            position: relative;
        }
        
        /* ÂåªÁñó‰∏ªÈ¢òÊ†áÈ¢ò */
        h1 {
            color: var(--primary);
            text-align: center;
            font-size: 24px;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--gray-mid);
            position: relative;
        }
        
        h1:before {
            content: "üè•";
            margin-right: 10px;
        }
    
        /* Ë°®ÂçïÊ†∑Âºè‰ºòÂåñ */
        fieldset {
            border: none;
            border-radius: 8px;
            padding: 20px;
            margin: 25px 0;
            background: var(--gray-light);
            position: relative;
        }
    
        legend {
            font-weight: bold;
            padding: 0 15px;
            background: var(--primary);
            color: white;
            border-radius: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: absolute;
            top: -15px;
            left: 20px;
        }
    
        .form-row {
            margin: 20px 0;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
    
        label {
            min-width: 120px;
            font-weight: 500;
            color: var(--gray-dark);
        }
    
        input, select, textarea {
            padding: 10px 12px;
            border: 1px solid var(--gray-mid);
            border-radius: 6px;
            flex: 1;
            transition: all 0.3s ease;
            font-size: 15px;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.2);
            outline: none;
        }
        
        input[type="radio"], input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--primary);
        }
    
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 15px;
            margin: 20px 0 10px;
            width: 100%;
        }
    
        .checkbox-item {
            background-color: white;
            border: 1px solid var(--gray-mid);
            border-radius: 8px;
            padding: 10px 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .checkbox-item:hover {
            border-color: var(--accent);
            box-shadow: 0 2px 8px rgba(66, 133, 244, 0.2);
        }
        
        .checkbox-item input:checked + span {
            font-weight: 500;
            color: var(--primary);
        }
    
        button {
            background: var(--primary);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            margin: 30px auto;
            display: block;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(26, 115, 232, 0.3);
        }
        
        button:hover {
            background: #0d62d0;
            box-shadow: 0 4px 12px rgba(26, 115, 232, 0.4);
            transform: translateY(-2px);
        }
    
        /* Êä•ÂëäÊ†∑Âºè‰ºòÂåñ */
        .report-section {
            background: #fff;
            padding: 25px;
            margin: 25px 0;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border-left: 4px solid var(--primary);
        }
    
        .warning {
            color: var(--warning);
            font-weight: bold;
            padding: 10px 15px;
            border-radius: 6px;
            background: #ffebee;
            margin: 15px 0;
        }
    
        .miao-advice {
            background: #e8f5e9;
            border-left: 4px solid var(--secondary);
            padding: 15px;
            margin: 15px 0;
            border-radius: 6px;
        }
    
        /* Ë°ÄÂéãËæìÂÖ•Ê°Ü‰ºòÂåñ */
        .bp-inputs {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .bp-inputs input {
            max-width: 80px;
        }
        
        .bp-divider {
            font-weight: bold;
            color: var(--gray-dark);
        }
        
        .bp-unit {
            color: var(--gray-dark);
            white-space: nowrap;
        }
        
        /* Âπ∂ÂèëÁóáÂå∫Âüü‰ºòÂåñ */
        .complication-group h4 {
            margin: 20px 0 10px;
            color: var(--primary);
            font-size: 16px;
        }
        
        .complication-group h4:before {
            content: "‚öïÔ∏è";
            margin-right: 8px;
        }
    
        /* MarkdownÊ†∑Âºè‰ºòÂåñ */
        .report-content {
            line-height: 1.8;
        }
        
        .report-content h2 {
            color: var(--primary);
            border-bottom: 2px solid #e6f2ff;
            padding-bottom: 8px;
            margin-top: 30px;
            margin-bottom: 20px;
            font-size: 22px;
        }
        
        .report-content h3 {
            color: var(--accent);
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .report-content ul, .report-content ol {
            padding-left: 25px;
            margin: 15px 0;
        }
        
        .report-content li {
            margin-bottom: 8px;
            position: relative;
        }
        
        .report-content strong {
            color: #1a73e8;
        }
        
        /* Êä•ÂëäÈ°µÈù¢Ê†áÈ¢ò */
        #reportContainer h2 {
            text-align: center;
            color: var(--primary);
            margin: 20px 0 30px;
            font-size: 24px;
        }
        
        /* Ë°®ÂçïÂàÜÁªÑÊ†áÈ¢ò */
        .section-title {
            font-weight: 500;
            color: var(--gray-dark);
            margin-bottom: 5px;
        }
        
        /* ÂåªÁñóÂõæÊ†á */
        .medical-icon {
            font-size: 20px;
            margin-right: 8px;
            vertical-align: middle;
        }
        /* Ê∑ªÂä†ÂàóË°®Ê†∑Âºè */
        .report-content ol {
            list-style-type: decimal;
            padding-left: 30px;
        }
    
        .report-content ul {
            list-style-type: disc;
            padding-left: 30px;
        }
    
        .numbered-list {
            counter-reset: item;
        }
    
        .numbered-list li {
            counter-increment: item;
        }
    
        .numbered-list li::before {
            content: counter(item) ". ";
            margin-right: 5px;
            color: var(--primary);
        }
    
        /* Ê∞ëÊóèÂåªÂ≠¶Âª∫ËÆÆÁâπÊÆäÊ†∑Âºè */
        .ethnic-medicine-advice {
            background: linear-gradient(to right, rgba(52, 168, 83, 0.08), rgba(52, 168, 83, 0.03));
            border: 1px solid rgba(52, 168, 83, 0.2);
            border-left: 5px solid #34a853;
            padding: 25px;
            margin: 35px 0;
            border-radius: 10px;
            position: relative;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            font-family: "Microsoft YaHei", "ÂæÆËΩØÈõÖÈªë", sans-serif !important;
        }
        
        .ethnic-medicine-advice h3 {
            color: var(--secondary);
            margin-top: 0;
            display: flex;
            align-items: center;
        }
        
        .ethnic-medicine-advice h3:before {
            content: "üåø";
            margin-right: 10px;
        }
        
        /* ËØ≠Ë®ÄÊåáÁ§∫Âô® */
        .language-indicator {
            position: absolute;
            top: 10px;
            right: 15px;
            background: rgba(26, 115, 232, 0.1);
            color: var(--primary);
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        /* ÂèåËØ≠ÊòæÁ§∫Ê®°Âºè */
        .bilingual-content {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .miao-text {
            color: var(--primary);
            font-style: italic;
        }
        
        .chinese-text {
            color: var(--gray-dark);
        }
    
        /* Âú®styleÊ†áÁ≠æ‰∏≠Ê∑ªÂä†‰ª•‰∏ãÊ†∑ÂºèÔºåÁªü‰∏ÄÊä•ÂëäÈ°µÂ≠ó‰Ωì */
        .report-content, #reportContainer, .report-section {
            font-family: "Microsoft YaHei", "ÂæÆËΩØÈõÖÈªë", sans-serif !important;
        }

        /* Êõ¥Êñ∞Êä•ÂëäÈ°µÊ†∑ÂºèÔºåÁ°Æ‰øùÂ≠ó‰ΩìÁªü‰∏Ä */
        .report-content h2, .report-content h3, .report-content p, 
        .report-content ul, .report-content ol, .report-content li {
            font-family: "Microsoft YaHei", "ÂæÆËΩØÈõÖÈªë", sans-serif !important;
        }

        /* Ê∞ëÊóèÂåªÂ≠¶Âª∫ËÆÆÁâπÊÆäÊ†∑Âºè */
        .ethnic-medicine-advice {
            background: linear-gradient(to right, rgba(52, 168, 83, 0.08), rgba(52, 168, 83, 0.03));
            border: 1px solid rgba(52, 168, 83, 0.2);
            border-left: 5px solid #34a853;
            padding: 25px;
            margin: 35px 0;
            border-radius: 10px;
            position: relative;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            font-family: "Microsoft YaHei", "ÂæÆËΩØÈõÖÈªë", sans-serif !important;
        }
    
        /* Ê∑ªÂä†‰ºòÂåñÊä•ÂëäÊ†∑ÂºèÂáΩÊï∞ */
        function applyOptimizedReportStyles() {
            const styleElement = document.createElement('style');
            styleElement.textContent = `
                /* ÂÆπÂô®Ê†∑Âºè */
                .container {
                    padding: 30px !important;
                    margin: 0 auto !important;
                }

                /* ÂÖ®Â±ÄÂ≠ó‰ΩìËÆæÁΩÆ */
                #reportContainer, .report-section, .report-content, 
                .report-content h2, .report-content h3, .report-content p, 
                .report-content ul, .report-content ol, .report-content li {
                    font-family: "Microsoft YaHei", "ÂæÆËΩØÈõÖÈªë", sans-serif !important;
                }

                /* Êä•ÂëäÂå∫ÂüüÂ¢ûÂº∫ */
                .report-section {
                    background: #fff;
                    padding: 40px;
                    margin: 30px 0;
                    border-radius: 12px;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
                    border-left: 5px solid #1a73e8;
                    overflow-wrap: break-word;
                    width: auto;
                    position: relative;
                }

                /* Ê†∏ÂøÉÂÜÖÂÆπÊ†∑Âºè */
                .report-content {
                    font-size: 16px;
                    line-height: 1.8;
                    color: #333;
                }

                /* ÈíàÂØπËãóÊóèÁî®Êà∑ÁöÑÁâπÊÆäÊ†∑Âºè */
                .miao-medicine-note {
                    margin-top: 20px;
                    padding: 10px 15px;
                    background-color: rgba(52, 168, 83, 0.1);
                    border-radius: 6px;
                    font-size: 15px;
                    color: #2e7d32;
                    font-style: italic;
                }
            `;
            document.head.appendChild(styleElement);
        }
        .miao-medicine-note {
            margin-top: 20px;
            padding: 10px 15px;
            background-color: rgba(52, 168, 83, 0.1);
            border-radius: 6px;
            font-size: 15px;
            color: #2e7d32;
            font-style: italic;
        }

        .ethnic-medicine-advice h2 {
            color: #34a853 !important;
            border-bottom-color: rgba(52, 168, 83, 0.3) !important;
        }

        .ethnic-medicine-advice h2::before {
            content: "üåø" !important;
            color: #34a853;
        }

        .ethnic-medicine-advice ul.bullet-list li::before {
            content: "üåø" !important;
        }
        
        /* Âú®styleÊ†áÁ≠æ‰∏≠Ê∑ªÂä†ÊàñÂú®applyOptimizedReportStylesÂáΩÊï∞‰∏≠Ê∑ªÂä† */
/* Ê∞ëÊóèÂåªÂ≠¶Âª∫ËÆÆÁöÑÂ∑ÆÂºÇÂåñÊ†∑Âºè */
.ethnic-medicine-advice {
    position: relative;
    padding: 25px;
    margin: 35px 0;
    border-radius: 10px;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
    font-family: "Microsoft YaHei", "ÂæÆËΩØÈõÖÈªë", sans-serif !important;
}

.ethnic-badge {
    position: absolute;
    top: -12px;
    right: 20px;
    padding: 5px 15px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: bold;
    color: white;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

/* ËãóÊóèÁâπËâ≤Ê†∑Âºè */
.miao-ethnic {
    background: linear-gradient(to right, rgba(52, 168, 83, 0.08), rgba(52, 168, 83, 0.03));
    border: 1px solid rgba(52, 168, 83, 0.2);
    border-left: 5px solid #34a853;
}

.miao-ethnic .ethnic-badge {
    background-color: #34a853;
}

.miao-ethnic h2 {
    color: #34a853 !important;
    border-bottom-color: rgba(52, 168, 83, 0.3) !important;
}

.miao-ethnic h2::before {
    content: "üåø" !important;
    color: #34a853;
}

/* Ê∞¥ÊóèÁâπËâ≤Ê†∑Âºè */
.shui-ethnic {
    background: linear-gradient(to right, rgba(66, 133, 244, 0.08), rgba(66, 133, 244, 0.03));
    border: 1px solid rgba(66, 133, 244, 0.2);
    border-left: 5px solid #4285f4;
}

.shui-ethnic .ethnic-badge {
    background-color: #4285f4;
}

.shui-ethnic h2 {
    color: #4285f4 !important;
    border-bottom-color: rgba(66, 133, 244, 0.3) !important;
}

.shui-ethnic h2::before {
    content: "üíß" !important;
    color: #4285f4;
}

/* ‰ª°‰Ω¨ÊóèÁâπËâ≤Ê†∑Âºè */
.gelao-ethnic {
    background: linear-gradient(to right, rgba(234, 67, 53, 0.08), rgba(234, 67, 53, 0.03));
    border: 1px solid rgba(234, 67, 53, 0.2);
    border-left: 5px solid #ea4335;
}

.gelao-ethnic .ethnic-badge {
    background-color: #ea4335;
}

.gelao-ethnic h2 {
    color: #ea4335 !important;
    border-bottom-color: rgba(234, 67, 53, 0.3) !important;
}

.gelao-ethnic h2::before {
    content: "üî•" !important; 
    color: #ea4335;
}

/* ‰æóÊóèÁâπËâ≤Ê†∑Âºè */
.dong-ethnic {
    background: linear-gradient(to right, rgba(251, 188, 5, 0.08), rgba(251, 188, 5, 0.03));
    border: 1px solid rgba(251, 188, 5, 0.2);
    border-left: 5px solid #fbbc05;
}

.dong-ethnic .ethnic-badge {
    background-color: #fbbc05;
}

.dong-ethnic h2 {
    color: #fbbc05 !important;
    border-bottom-color: rgba(251, 188, 5, 0.3) !important;
}

.dong-ethnic h2::before {
    content: "üåæ" !important;
    color: #fbbc05;
}

/* Ê∞ëÊóèÂåªÂ≠¶Ê≥®ÈáäÊ†∑Âºè */
.ethnic-medicine-note {
    margin-top: 20px;
    padding: 10px 15px;
    border-radius: 6px;
    font-size: 14px;
    font-style: italic;
}

.miao-ethnic .ethnic-medicine-note {
    background-color: rgba(52, 168, 83, 0.1);
    color: #2e7d32;
}

.shui-ethnic .ethnic-medicine-note {
    background-color: rgba(66, 133, 244, 0.1);
    color: #1a73e8;
}

.gelao-ethnic .ethnic-medicine-note {
    background-color: rgba(234, 67, 53, 0.1);
    color: #c62828;
}

.dong-ethnic .ethnic-medicine-note {
    background-color: rgba(251, 188, 5, 0.1);
    color: #f57c00;
}

/* Âú®styleÊ†áÁ≠æ‰∏≠Ê∑ªÂä†ÊàñÂú®applyOptimizedReportStylesÂáΩÊï∞‰∏≠Ê∑ªÂä† */
/* Âä†ËΩΩÁä∂ÊÄÅ‰ºòÂåñ */
.loading {
    display: none;
    text-align: center;
    padding: 30px;
    color: var(--gray-dark);
    background: white;
    border-radius: 10px;
    box-shadow: 0 3px 15px rgba(0,0,0,0.1);
    max-width: 500px;
    margin: 20px auto;
}

.loading-dots {
    margin: 10px 0;
    font-size: 30px;
    height: 20px;
}

.loading-dots::after {
    content: "...";
    animation: dots 1.5s infinite;
}

@keyframes dots {
    0%, 20% { content: "."; }
    40%, 60% { content: ".."; }
    80%, 100% { content: "..."; }
}

.progress-container {
    background-color: #f1f1f1;
    border-radius: 10px;
    height: 10px;
    margin: 15px 0;
    overflow: hidden;
}

.progress-bar {
    background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
    height: 100%;
    width: 0%;
    border-radius: 10px;
    transition: width 0.3s ease;
}

.loading-stages {
    display: flex;
    justify-content: space-between;
    font-size: 14px;
    color: var(--gray-dark);
    margin-top: 5px;
}

.stage {
    opacity: 0.6;
    transition: all 0.3s ease;
}

.stage.active {
    color: var(--primary);
    font-weight: bold;
    opacity: 1;
}
    </style>
</head>
<body>
    <!-- È°∂ÈÉ®Â∑•ÂÖ∑Ê†è -->
    <div class="top-toolbar">
        <div id="font-size-toggle" class="toolbar-btn">
            <span>Aa</span> Â§ßÂ≠óÊòæÁ§∫
        </div>
        <div id="language-toggle" class="toolbar-btn">
            <span>Ëãó</span> ËãóËØ≠ÂàáÊç¢
        </div>
    </div>

    <div class="container" id="mainContainer">
        <!-- ÈóÆËØäË°®Âçï -->
        <form id="healthForm">
            <h1>È´òË°ÄÂéãÁ≥ñÂ∞øÁóÖÊô∫ËÉΩÈóÆËØäÁ≥ªÁªü</h1>

            <!-- Âü∫Êú¨‰ø°ÊÅØ -->
            <fieldset>
                <legend>Âü∫Êú¨‰ø°ÊÅØ</legend>
                <div class="form-row">
                    <label for="name">ÂßìÂêçÔºö</label>
                    <input type="text" id="name" placeholder="ËØ∑ËæìÂÖ•ÊÇ®ÁöÑÂßìÂêç" required>
                </div>
                <div class="form-row">
                    <label>ÊÄßÂà´Ôºö</label>
                    <div style="display: flex; gap: 20px;">
                        <label class="male-item">
                            <input type="radio" id="male" name="gender" value="Áî∑" required>
                            <span>Áî∑</span>
                        </label>
                        <label class="male-item">
                            <input type="radio" name="gender" id="female" value="Â•≥">
                            <span>Â•≥</span>
                        </label>
                    </div>
                </div>
                <div class="form-row">
                    <label for="age">Âπ¥ÈæÑÔºö</label>
                    <input type="number" id="age" min="18" max="120" placeholder="ËØ∑ËæìÂÖ•ÊÇ®ÁöÑÂπ¥ÈæÑ" required>
                </div>
                <div class="form-row">
                    <label for="ethnicity">Ê∞ëÊóèÔºö</label>
                    <select id="ethnicity" required>
                        <option value="" disabled selected>ËØ∑ÈÄâÊã©ÊÇ®ÁöÑÊ∞ëÊóè</option>
                        <option value="Ê±âÊóè">Ê±âÊóè</option>
                        <option value="ËãóÊóè">ËãóÊóè</option>
                        <option value="‰æóÊóè">‰æóÊóè</option>
                        <option value="Ê∞¥Êóè">Ê∞¥Êóè</option>
                        <option value="‰ª°‰Ω¨Êóè">‰ª°‰Ω¨Êóè</option>
                    </select>
                </div>
                <div class="form-row">
                    <label for="contact">ËÅîÁ≥ªÊñπÂºèÔºö</label>
                    <input type="tel" id="contact" placeholder="ËØ∑ËæìÂÖ•ÊÇ®ÁöÑËÅîÁ≥ªÁîµËØù" required>
                </div>
                <div class="form-row">
                    <label for="address">Â±Ö‰ΩèÂú∞Ôºö</label>
                    <input type="text" id="address" placeholder="ËØ∑ËæìÂÖ•ÊÇ®ÁöÑÂ±Ö‰ΩèÂú∞ÂùÄ" required>
                </div>
                
                <!-- ‰øÆÊîπË∫´È´ò„ÄÅ‰ΩìÈáçÂíåBMI‰∏∫‰∏ÄË°åÊòæÁ§∫ -->
                <div class="form-row">
                    <label for="height">Ë∫´‰ΩìÊåáÊ†áÔºö</label>
                    <div style="display: flex; align-items: center; gap: 10px; flex: 1;">
                        <input type="number" id="height" min="100" max="250" step="0.1" placeholder="Ë∫´È´ò(cm)" required onchange="calculateBMI()" style="max-width: 100px;">
                        <input type="number" id="weight" min="30" max="200" step="0.1" placeholder="‰ΩìÈáç(kg)" required onchange="calculateBMI()" style="max-width: 100px;">
                        <span style="margin: 0 5px;">BMI:</span>
                        <input type="text" id="bmi" readonly style="background-color: #f8f9fa; max-width: 60px;">
                        <span id="bmi-category" style="font-weight: 500; min-width: 60px;"></span>
                    </div>
                </div>
                <div class="indicator">
                    <span class="indicator-normal">BMIÊ≠£Â∏∏ËåÉÂõ¥: 18.5-24.9</span>
                    <span class="indicator-warning">Ë∂ÖÈáç: ‚â• 25.0</span>
                </div>
            </fieldset>
    
            <!-- Ë°ÄÂéãÂÄº -->
            <fieldset>
                <legend>Ë°ÄÂéãÊµãÈáè</legend>
                <div class="form-row">
                    <label>Ë°ÄÂéãÂÄºÔºö</label>
                    <div class="bp-inputs">
                        <input type="number" id="systolic" placeholder="Êî∂Áº©Âéã" required>
                        <span class="bp-divider">/</span>
                        <input type="number" id="diastolic" placeholder="ËàíÂº†Âéã" required>
                        <span class="bp-unit">mmHg</span>
                    </div>
                </div>
                <div class="indicator">
                    <span class="indicator-normal">Ê≠£Â∏∏ËåÉÂõ¥: ‚â§ 120/80 mmHg</span>
                    <span class="indicator-warning">È´òË°ÄÂéã: ‚â• 140/90 mmHg</span>
                </div>
            </fieldset>
    
            <!-- Ë°ÄÁ≥ñÂÄº -->
            <fieldset>
                <legend>Ë°ÄÁ≥ñÁõëÊµã</legend>
                <div class="form-row">
                    <label>Á©∫ËÖπË°ÄÁ≥ñÔºö</label>
                    <div style="display: flex; align-items: center;">
                        <input type="number" id="blood-sugar-fasting" step="0.1" placeholder="ËØ∑ËæìÂÖ•Á©∫ËÖπË°ÄÁ≥ñÂÄº" required>
                        <span class="bp-unit">mmol/L</span>
                    </div>
                </div>
                <div class="indicator">
                    <span class="indicator-normal">Ê≠£Â∏∏ËåÉÂõ¥: 3.9-6.1 mmol/L</span>
                </div>
                <div class="form-row">
                    <label>È§êÂêéË°ÄÁ≥ñÔºö</label>
                    <div style="display: flex; align-items: center;">
                        <input type="number" id="blood-sugar-dinner" step="0.1" placeholder="ËØ∑ËæìÂÖ•È§êÂêé2Â∞èÊó∂Ë°ÄÁ≥ñÂÄº" required>
                        <span class="bp-unit">mmol/L</span>
                    </div>
                </div>
                <div class="indicator">
                    <span class="indicator-normal">Ê≠£Â∏∏ËåÉÂõ¥: ‚â§ 7.8 mmol/L</span>
                </div>
            </fieldset>
    
            <!-- ÁóáÁä∂ -->
            <fieldset>
                <legend>Ë∫´‰Ωì‰∏çÈÄÇÁóáÁä∂</legend>
                <div class="section-title">ËØ∑ÈÄâÊã©ÊÇ®ÁõÆÂâçÂ≠òÂú®ÁöÑ‰∏çÈÄÇÁóáÁä∂Ôºö</div>
                <div class="checkbox-group">
                    <label class="checkbox-item">
                        <input type="checkbox" name="symptoms" value="Â§¥Êôï">
                        <span>Â§¥Êôï</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="symptoms" value="‰πèÂäõ">
                        <span>‰πèÂäõ</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="symptoms" value="ËÉ∏Áóõ">
                        <span>ËÉ∏Áóõ</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="symptoms" value="ÁúºËä±">
                        <span>ÁúºËä±</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="symptoms" value="Âè£Ê∏¥">
                        <span>Âè£Ê∏¥</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="symptoms" value="Â§öÂ∞ø">
                        <span>Â§öÂ∞ø</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="symptoms" value="ÂøÉÊÇ∏">
                        <span>ÂøÉÊÇ∏</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="symptoms" value="ÂëºÂê∏Âõ∞Èöæ">
                        <span>ÂëºÂê∏Âõ∞Èöæ</span>
                    </label>
                </div>
            </fieldset>
    
            <!-- Âπ∂ÂèëÁóá -->
            <fieldset>
                <legend>Âπ∂ÂèëÁóáËØÑ‰º∞</legend>
                <div class="complication-group">
                    <h4>È´òË°ÄÂéãÂπ∂ÂèëÁóá</h4>
                    <div class="checkbox-group">
                        <label class="checkbox-item">
                            <input type="checkbox" name="hypertension-complications" value="ÂøÉËÑèÁóÖ">
                            <span>ÂøÉËÑèÁóÖ</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="hypertension-complications" value="‰∏≠È£é">
                            <span>‰∏≠È£é</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="hypertension-complications" value="ËÇæÁóÖ">
                            <span>ËÇæÁóÖ</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="hypertension-complications" value="ËßÜÁΩëËÜúÁóÖÂèò">
                            <span>ËßÜÁΩëËÜúÁóÖÂèò</span>
                        </label>
                    </div>
                    <div class="form-row" style="margin-top: 15px;">
                        <label for="hypertension-other">ÂÖ∂‰ªñÂπ∂ÂèëÁóáÔºö</label>
                        <textarea id="hypertension-other" rows="2" placeholder="ËØ∑ËæìÂÖ•ÂÖ∂‰ªñÈ´òË°ÄÂéãÁõ∏ÂÖ≥Âπ∂ÂèëÁóáÊàñÁóáÁä∂"></textarea>
                    </div>
                </div>
    
                <div class="complication-group">
                    <h4>Á≥ñÂ∞øÁóÖÂπ∂ÂèëÁóá</h4>
                    <div class="checkbox-group">
                        <label class="checkbox-item">
                            <input type="checkbox" name="diabetes-complications" value="Á•ûÁªèÊçü‰º§">
                            <span>Á•ûÁªèÊçü‰º§</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="diabetes-complications" value="ËÇæÂäüËÉΩÊçü‰º§">
                            <span>ËÇæÂäüËÉΩÊçü‰º§</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="diabetes-complications" value="ÂøÉË°ÄÁÆ°ÈóÆÈ¢ò">
                            <span>ÂøÉË°ÄÁÆ°ÈóÆÈ¢ò</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="diabetes-complications" value="Á≥ñÂ∞øÁóÖË∂≥">
                            <span>Á≥ñÂ∞øÁóÖË∂≥</span>
                        </label>
                    </div>
                    <div class="form-row" style="margin-top: 15px;">
                        <label for="diabetes-other">ÂÖ∂‰ªñÂπ∂ÂèëÁóáÔºö</label>
                        <textarea id="diabetes-other" rows="2" placeholder="ËØ∑ËæìÂÖ•ÂÖ∂‰ªñÁ≥ñÂ∞øÁóÖÁõ∏ÂÖ≥Âπ∂ÂèëÁóáÊàñÁóáÁä∂"></textarea>
                    </div>
                </div>
            </fieldset>
    
            <!-- ËøáÊïèÂè≤ -->
            <fieldset>
                <legend>ËçØÁâ©ËøáÊïèÂè≤</legend>
                <div class="form-row">
                    <label>ÊòØÂê¶ÊúâËøáÊïèÂè≤Ôºö</label>
                    <div style="display: flex; gap: 20px;">
                        <label class="male-item">
                            <input type="radio" name="allergy" value="ÊòØ" required>
                            <span>ÊòØ</span>
                        </label>
                        <label class="male-item">
                            <input type="radio" name="allergy" value="Âê¶">
                            <span>Âê¶</span>
                        </label>
                    </div>
                </div>
                <div class="form-row">
                    <label for="allergy-details">ËøáÊïèËØ¶ÊÉÖÔºö</label>
                    <textarea id="allergy-details" rows="2" placeholder="ËØ∑ËØ¶ÁªÜÊèèËø∞ÊÇ®ÁöÑËçØÁâ©ËøáÊïèÊÉÖÂÜµ"></textarea>
                </div>
            </fieldset>
    
            <button type="button" onclick="generateReport()">ÁîüÊàêÂÅ•Â∫∑Êä•Âëä</button>
            <div class="loading" id="loading">Ê≠£Âú®ÁîüÊàê‰∏ì‰∏öÂåªÁñóÊä•Âëä</div>
        </form>
    
        <!-- Êä•ÂëäÊòæÁ§∫Âå∫Âüü -->
        <div id="reportContainer" style="display: none;"></div>
    </div>
    
    <script>
        const DEEPSEEK_API_KEY = 'sk-6cecc16e7c074089a36f153ec43f5b8a';
        const API_URL = 'https://api.deepseek.com/v1/chat/completions';
    
        // Ê∑ªÂä†ËãóËØ≠ËØçÂÖ∏
        const miaoTranslation = {
            // È°µÈù¢Ê†áÈ¢òÂíåËÆæÁΩÆ
            "È´òË°ÄÂéãÁ≥ñÂ∞øÁóÖÊô∫ËÉΩÈóÆËØäÁ≥ªÁªü": "Qiub Niangb Diub Bangx Rongx Diex Zangt",
            "Â§ßÂ≠óÊòæÁ§∫": "Meil Delk Lol",
            "ËãóËØ≠ÂàáÊç¢": "Hmongb Lol Fuk",
            "ÂèåËØ≠Ê®°Âºè": "Shuang Lol Mok",
            // Â≠óÊÆµÊ†áÁ≠æ
            "Âü∫Êú¨‰ø°ÊÅØ": "Duh Meil Fenb",
            "ÂßìÂêç": "Guaix",
            "ÊÄßÂà´": "Nix Nanb",
            "Âπ¥ÈæÑ": "Hniangx",
            "Ê∞ëÊóè": "Minb Zuk",
            "ËÅîÁ≥ªÊñπÂºè": "Dien Hua",
            "Â±Ö‰ΩèÂú∞": "Zuk Dib",
            "Ë°ÄÂéãÊµãÈáè": "Sieb Yak Diub",
            "Ë°ÄÁ≥ñÁõëÊµã": "Sieb Tangb Diub",
            "Ë∫´‰Ωì‰∏çÈÄÇÁóáÁä∂": "Mangb Ghangb Zengt",
            "Âπ∂ÂèëÁóáËØÑ‰º∞": "Zengt Vongb Pak",
            "ËçØÁâ©ËøáÊïèÂè≤": "Yak Mix Hak",
            // ÈÄâÈ°π
            "Áî∑": "Nanb",
            "Â•≥": "Nix",
            "Ê±âÊóè": "Han Zuk",
            "ËãóÊóè": "Hmongb Zuk",
            "‰æóÊóè": "Dongb Zuk",
            "Ê∞¥Êóè": "Suib Zuk",
            "‰ª°‰Ω¨Êóè": "Gelb Laob Zuk",
            // ÁóáÁä∂
            "Â§¥Êôï": "Daub Yuk",
            "‰πèÂäõ": "Mongb Lik",
            "ËÉ∏Áóõ": "Hangt Tongb",
            "ÁúºËä±": "Maix Vut",
            "Âè£Ê∏¥": "Kot Hax",
            "Â§öÂ∞ø": "Zix Senb",
            "ÂøÉÊÇ∏": "Sim Baix",
            "ÂëºÂê∏Âõ∞Èöæ": "Haix Cuk Nant",
            // Âπ∂ÂèëÁóá
            "È´òË°ÄÂéãÂπ∂ÂèëÁóá": "Qiub Niangb Zengt",
            "ÂøÉËÑèÁóÖ": "Sim Zengt",
            "‰∏≠È£é": "Tongb Fongb",
            "ËÇæÁóÖ": "Yenx Zengt",
            "ËßÜÁΩëËÜúÁóÖÂèò": "Maix Vut Zent",
            "Á≥ñÂ∞øÁóÖÂπ∂ÂèëÁóá": "Tangb Zengt",
            "Á•ûÁªèÊçü‰º§": "Simt Zengt",
            "ËÇæÂäüËÉΩÊçü‰º§": "Yenx Vek",
            "ÂøÉË°ÄÁÆ°ÈóÆÈ¢ò": "Sim Sieb Zengt",
            "Á≥ñÂ∞øÁóÖË∂≥": "Diek Zengt",
            // ËøáÊïèÂè≤
            "ÊòØÂê¶ÊúâËøáÊïèÂè≤": "Mix Hak Lak",
            "ÊòØ": "Mix",
            "Âê¶": "Ax",
            "ËøáÊïèËØ¶ÊÉÖ": "Mix Hak Duk",
            // ÊåâÈíÆÂíåÊèêÁ§∫
            "ÁîüÊàêÂÅ•Â∫∑Êä•Âëä": "Dak Jiank Kangt Baot",
            "Ê≠£Âú®ÁîüÊàê‰∏ì‰∏öÂåªÁñóÊä•Âëä": "Dak Zak Jiank Baot",
            "ËøîÂõûÈóÆËØäË°®Âçï": "Rout Diex Dab",
            "ÁöÑÂÅ•Â∫∑Êä•Âëä": "Jiank Kangt Baot",
            // ÊåáÊ†áÂíåÂçï‰Ωç
            "Ë°ÄÂéãÂÄº": "Sieb Yak",
            "Êî∂Áº©Âéã": "Sot Yak",
            "ËàíÂº†Âéã": "Suk Yak",
            "Á©∫ËÖπË°ÄÁ≥ñ": "Kong Sieb",
            "È§êÂêéË°ÄÁ≥ñ": "Niaot Sieb",
            "Ê≠£Â∏∏ËåÉÂõ¥": "Zangt Fant",
            "È´òË°ÄÂéã": "Qiub Sieb",
            "ËØ∑ËæìÂÖ•ÊÇ®ÁöÑÂßìÂêç": "Guaix",
            "ËØ∑ËæìÂÖ•ÊÇ®ÁöÑÂπ¥ÈæÑ": "Hniangx",
            "ËØ∑ÈÄâÊã©ÊÇ®ÁöÑÊ∞ëÊóè": "Minb Zuk",
            "ËØ∑ËæìÂÖ•ÊÇ®ÁöÑËÅîÁ≥ªÁîµËØù": "Dien Hua",
            "ËØ∑ËæìÂÖ•ÊÇ®ÁöÑÂ±Ö‰ΩèÂú∞ÂùÄ": "Zuk Dib",
            "ËØ∑ËæìÂÖ•Á©∫ËÖπË°ÄÁ≥ñÂÄº": "Kong Sieb",
            "ËØ∑ËæìÂÖ•È§êÂêé2Â∞èÊó∂Ë°ÄÁ≥ñÂÄº": "Niaot Sieb",
            "ËØ∑ÈÄâÊã©ÊÇ®ÁõÆÂâçÂ≠òÂú®ÁöÑ‰∏çÈÄÇÁóáÁä∂": "Mangb Ghangb Zengt",
            "ËØ∑ËØ¶ÁªÜÊèèËø∞ÊÇ®ÁöÑËçØÁâ©ËøáÊïèÊÉÖÂÜµ": "Mix Hak Duk",
            // Êä•ÂëäÈÉ®ÂàÜ
            "È£éÈô©ËØÑ‰º∞": "Fengx Xib Pakx",
            "ÂåªÁñóÂª∫ËÆÆ": "Yix Dak Jiex",
            "Ë•øËçØÊ≤ªÁñóÊñπÊ°à": "Seix Yak Fangx",
            "‰∏≠ËçØ/Ê∞ëÊóèÂåªËçØÂª∫ËÆÆ": "Zongx Yak Jiex",
            "Ê∞ëÊóèÂåªËçØÂª∫ËÆÆ": "Minb Zux Yak",
            "ÁîüÊ¥ªÂª∫ËÆÆ": "Sengx Huox Jiex",
            "È•ÆÈ£üÂª∫ËÆÆ": "Yinx Sik Jiex",
            "ËøêÂä®Âª∫ËÆÆ": "Yunx Dongx Jiex",
            "Ê≥®ÊÑè‰∫ãÈ°π": "Zux Yix Sirx",
            // Êñ∞Â¢ûË∫´È´ò‰ΩìÈáçBMIÁõ∏ÂÖ≥ÁøªËØë
            "Ë∫´È´ò": "Ghaob",
            "‰ΩìÈáç": "Zenb",
            "BMIÊåáÊï∞": "BMI Zhix",
            "ËØ∑ËæìÂÖ•ÊÇ®ÁöÑË∫´È´ò": "Ghaob",
            "ËØ∑ËæìÂÖ•ÊÇ®ÁöÑ‰ΩìÈáç": "Zenb",
            "ÂÅèÁò¶": "Piant Sout",
            "Ê≠£Â∏∏": "Zhengb Changk",
            "Ë∂ÖÈáç": "Chaot Zhongb",
            "ËÇ•ËÉñ": "Feib Pangb",
            "ÈáçÂ∫¶ËÇ•ËÉñ": "Zhongb Feib",
            // Êñ∞Â¢ûÁøªËØë
            "Ë∫´‰ΩìÊåáÊ†á": "Shenb Tix Zhix",
            "BMIÊ≠£Â∏∏ËåÉÂõ¥": "BMI Fant Wei",
            "ÂÖ∂‰ªñÂπ∂ÂèëÁóá": "Qib Taf Bingb",
            "ËØ∑ËæìÂÖ•ÂÖ∂‰ªñÈ´òË°ÄÂéãÁõ∏ÂÖ≥Âπ∂ÂèëÁóáÊàñÁóáÁä∂": "Qiub Niangb Qib Taf Bingb",
            "ËØ∑ËæìÂÖ•ÂÖ∂‰ªñÁ≥ñÂ∞øÁóÖÁõ∏ÂÖ≥Âπ∂ÂèëÁóáÊàñÁóáÁä∂": "Tangb Diub Qib Taf Bingb"
        };

        // ËãóÊñáÊ£ÄÊµãÂô® - Ê£ÄÊü•ÊñáÊú¨ÊòØÂê¶‰∏∫ËãóÊñá
        function isMiaoText(text) {
            // ÁÆÄÂçïÊ£ÄÊµãÔºöËãóÊñáÂ∏∏Áî®Â≠óÁ¨¶ÁâπÂæÅ
            const miaoCharacters = /[A-Z][a-z]+b|[A-Z][a-z]+k|[A-Z][a-z]+x|[A-Z][a-z]+t/;
            return miaoCharacters.test(text) && !/[\u4e00-\u9fa5]/.test(text); // ÂåÖÂê´ËãóÊñáÁâπÂæÅ‰∏î‰∏çÂåÖÂê´‰∏≠Êñá
        }

        // ÂèçÂêëÁøªËØëÔºöËãóÊñá->‰∏≠Êñá
        const chineseTranslation = {};
        for (const [chinese, miao] of Object.entries(miaoTranslation)) {
            chineseTranslation[miao] = chinese;
        }

        // Â≠ó‰ΩìÂ§ßÂ∞èÂàáÊç¢
        let currentFontSize = 0; // 0: Ê≠£Â∏∏, 1: Â§ß, 2: ÁâπÂ§ß
        const fontSizeToggle = document.getElementById('font-size-toggle');
        fontSizeToggle.addEventListener('click', function() {
            currentFontSize = (currentFontSize + 1) % 3;
            document.body.classList.remove('large-font', 'x-large-font');
            
            if (currentFontSize === 1) {
                document.body.classList.add('large-font');
                this.innerHTML = '<span>Aa</span> Â§ßÂ≠óÊ®°Âºè';
            } else if (currentFontSize === 2) {
                document.body.classList.add('x-large-font');
                this.innerHTML = '<span>Aa</span> ÁâπÂ§ßÂ≠ó‰Ωì';
            } else {
                this.innerHTML = '<span>Aa</span> Â§ßÂ≠óÊòæÁ§∫';
            }
            
            // Â¶ÇÊûúÂ∑≤ÁªèÂàáÊç¢‰∏∫ËãóËØ≠ÔºåÈúÄË¶ÅËøõË°åÁõ∏Â∫îÁøªËØë
            if (isMiaoMode) {
                if (currentFontSize === 1) {
                    this.innerHTML = '<span>Aa</span> Meil Delk';
                } else if (currentFontSize === 2) {
                    this.innerHTML = '<span>Aa</span> Meil Dal';
                } else {
                    this.innerHTML = '<span>Aa</span> Meil Delk Lol';
                }
            }
        });

        // ËãóËØ≠ÂàáÊç¢
        let isMiaoMode = false;
        const languageToggle = document.getElementById('language-toggle');
        languageToggle.addEventListener('click', function() {
            isMiaoMode = !isMiaoMode;
            this.classList.toggle('active');
            
            if (isMiaoMode) {
                // ÂàáÊç¢Âà∞ËãóËØ≠
                this.innerHTML = '<span>‰∏≠</span> ÂàáÊç¢‰∏≠Êñá';
                translateToMiao();
            } else {
                // ÂàáÊç¢Âõû‰∏≠Êñá
                this.innerHTML = '<span>Ëãó</span> ËãóËØ≠ÂàáÊç¢';
                translateToChinese();
            }
            
            // Â§ÑÁêÜÂ≠ó‰ΩìÂ§ßÂ∞èÊåâÈíÆÁöÑÊñáÊú¨
            if (isMiaoMode) {
                if (currentFontSize === 1) {
                    fontSizeToggle.innerHTML = '<span>Aa</span> Meil Delk';
                } else if (currentFontSize === 2) {
                    fontSizeToggle.innerHTML = '<span>Aa</span> Meil Dal';
                } else {
                    fontSizeToggle.innerHTML = '<span>Aa</span> Meil Delk Lol';
                }
            } else {
                if (currentFontSize === 1) {
                    fontSizeToggle.innerHTML = '<span>Aa</span> Â§ßÂ≠óÊ®°Âºè';
                } else if (currentFontSize === 2) {
                    fontSizeToggle.innerHTML = '<span>Aa</span> ÁâπÂ§ßÂ≠ó‰Ωì';
                } else {
                    fontSizeToggle.innerHTML = '<span>Aa</span> Â§ßÂ≠óÊòæÁ§∫';
                }
            }
        });

        // Ëá™Âä®Ê£ÄÊµãËæìÂÖ•ËØ≠Ë®ÄÁ±ªÂûã
        document.querySelectorAll('input[type="text"], textarea').forEach(input => {
            input.addEventListener('input', function() {
                const value = this.value.trim();
                if (value && isMiaoText(value)) {
                    // Ê£ÄÊµãÂà∞ËãóÊñáËæìÂÖ•ÔºåËá™Âä®ÂàáÊç¢Âà∞ËãóÊñáÊ®°Âºè
                    if (!isMiaoMode) {
                        isMiaoMode = true;
                        languageToggle.classList.add('active');
                        languageToggle.innerHTML = '<span>‰∏≠</span> ÂàáÊç¢‰∏≠Êñá';
                        translateToMiao();
                    }
                }
            });
        });

        // Â∞ÜÈ°µÈù¢ÂÖÉÁ¥†ÁøªËØë‰∏∫ËãóËØ≠
        function translateToMiao() {
            // Ê†áÈ¢ò
            document.querySelector('h1').textContent = miaoTranslation["È´òË°ÄÂéãÁ≥ñÂ∞øÁóÖÊô∫ËÉΩÈóÆËØäÁ≥ªÁªü"] || document.querySelector('h1').textContent;
            
            // fieldset Ê†áÈ¢ò (legend)
            document.querySelectorAll('legend').forEach(legend => {
                const chinese = legend.textContent;
                legend.textContent = miaoTranslation[chinese] || chinese;
            });
            
            // Ê†áÁ≠æÊñáÊú¨
            document.querySelectorAll('label').forEach(label => {
                if (label.childElementCount === 0) { // Âè™ÁøªËØëÊ≤°ÊúâÂ≠êÂÖÉÁ¥†ÁöÑÊ†áÁ≠æ
                    const chinese = label.textContent.replace('Ôºö', '');
                    if (miaoTranslation[chinese]) {
                        label.textContent = miaoTranslation[chinese] + 'Ôºö';
                    }
                }
            });
            
            // ÂçïÈÄâÊ°ÜÂíåÂ§çÈÄâÊ°Ü
            document.querySelectorAll('.male-item span, .checkbox-item span').forEach(span => {
                const chinese = span.textContent;
                span.textContent = miaoTranslation[chinese] || chinese;
            });
            
            // placeholder Â±ûÊÄß
            document.querySelectorAll('input[placeholder], textarea[placeholder]').forEach(input => {
                const chinese = input.placeholder;
                input.placeholder = miaoTranslation[chinese] || chinese;
            });
            
            // ÈÄâÊã©Ê°ÜÈÄâÈ°π
            document.querySelectorAll('option').forEach(option => {
                const chinese = option.textContent;
                if (chinese && chinese.trim() !== '') {
                    option.textContent = miaoTranslation[chinese] || chinese;
                }
            });
            
            // ÊåâÈíÆÊñáÊú¨
            document.querySelectorAll('button').forEach(button => {
                const chinese = button.textContent;
                button.textContent = miaoTranslation[chinese] || chinese;
            });
            
            // ÊèêÁ§∫‰ø°ÊÅØ
            document.querySelectorAll('.indicator span').forEach(span => {
                // ‰ªÖÊõøÊç¢ÂÜíÂè∑ÂâçÁöÑÊñáÊú¨Ôºå‰øùÁïôÊï∞ÂÄºËåÉÂõ¥
                const parts = span.textContent.split(':');
                if (parts.length > 1) {
                    const textPart = parts[0].trim();
                    const valuePart = parts.slice(1).join(':').trim();
                    span.textContent = (miaoTranslation[textPart] || textPart) + ': ' + valuePart;
                }
            });
            
            // Âä†ËΩΩÊñáÊú¨
            const loading = document.getElementById('loading');
            if (loading) {
                loading.textContent = miaoTranslation["Ê≠£Âú®ÁîüÊàê‰∏ì‰∏öÂåªÁñóÊä•Âëä"] || loading.textContent;
            }
        }
        
        // Â∞ÜÈ°µÈù¢ÂÖÉÁ¥†ÊÅ¢Â§ç‰∏∫‰∏≠Êñá
        function translateToChinese() {
            // Âà∑Êñ∞È°µÈù¢ÊòØÊúÄÁÆÄÂçïÁöÑÊñπÂºè
            location.reload();
        }

        // Ê£ÄÊµãËæìÂÖ•ÊòØÂê¶‰∏∫ËãóÊñá
        function detectMiaoInput() {
            // Ê£ÄÊü•ÂÖ≥ÈîÆËæìÂÖ•Â≠óÊÆµ
            const nameValue = document.getElementById('name').value;
            const allergyDetails = document.getElementById('allergy-details').value;
            
            // Â¶ÇÊûú‰ªª‰∏ÄÂ≠óÊÆµÂåÖÂê´ËãóÊñáÁâπÂæÅ
            if (isMiaoText(nameValue) || isMiaoText(allergyDetails)) {
                return true;
            }
            
            return false;
        }
    
        // Ê∑ªÂä†Êõ¥Áõ¥ËßÇÁöÑÂä†ËΩΩÊèêÁ§∫
        function updateLoadingUI() {
            const loadingElement = document.getElementById('loading');
            const dots = document.createElement('div');
            dots.className = 'loading-dots';
            
            // Ê∏ÖÁ©∫ÂΩìÂâçÂÜÖÂÆπ
            loadingElement.innerHTML = 'Ê≠£Âú®ÁîüÊàê‰∏ì‰∏öÂåªÁñóÊä•Âëä';
            
            // Ê∑ªÂä†ËøõÂ∫¶ÊåáÁ§∫Âô®
            const progressBar = document.createElement('div');
            progressBar.className = 'loading-progress';
            progressBar.innerHTML = `
                <div class="progress-container">
                    <div class="progress-bar"></div>
                </div>
                <div class="loading-stages">
                    <span class="stage active">ÂàÜÊûêÊï∞ÊçÆ</span>
                    <span class="stage">ÁîüÊàêÂª∫ËÆÆ</span>
                    <span class="stage">Ê†ºÂºèÂåñÊä•Âëä</span>
                </div>
            `;
            
            loadingElement.appendChild(dots);
            loadingElement.appendChild(progressBar);
            
            // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
            loadingElement.style.display = 'block';
            
            // Ê®°ÊãüËøõÂ∫¶
            simulateProgress();
        }

        // Ê®°ÊãüAPIÂ§ÑÁêÜËøõÂ∫¶
        function simulateProgress() {
            const progressBar = document.querySelector('.progress-bar');
            const stages = document.querySelectorAll('.stage');
            let width = 0;
            
            // ÈáçÁΩÆËøõÂ∫¶Êù°ÂíåÈò∂ÊÆµ
            progressBar.style.width = '0%';
            stages.forEach((stage, index) => {
                if (index === 0) {
                    stage.classList.add('active');
                } else {
                    stage.classList.remove('active');
                }
            });
            
            const interval = setInterval(() => {
                if (width >= 100) {
                    clearInterval(interval);
                } else {
                    width += 0.5;
                    progressBar.style.width = width + '%';
                    
                    // Êõ¥Êñ∞Èò∂ÊÆµÊòæÁ§∫
                    if (width > 30 && width < 75) {
                        stages[0].classList.remove('active');
                        stages[1].classList.add('active');
                    } else if (width >= 75) {
                        stages[1].classList.remove('active');
                        stages[2].classList.add('active');
                    }
                }
            }, 100);
        }

        // ‰øÆÊîπÁîüÊàêÊä•ÂëäÂáΩÊï∞ÔºåÊ∑ªÂä†Ë∂ÖÊó∂Â§ÑÁêÜÂíåÁºìÂ≠ò
        async function generateReport() {
            try {
                // Êõ¥Êñ∞Âä†ËΩΩUI
                updateLoadingUI();
    
                // Êî∂ÈõÜË°®ÂçïÊï∞ÊçÆ
                const formData = {
                    name: document.getElementById('name').value,
                    gender: document.querySelector('input[name="gender"]:checked')?.value || '',
                    age: document.getElementById('age').value,
                    ethnicity: document.getElementById('ethnicity').value,
                    // Ë∫´È´ò‰ΩìÈáçBMIÊï∞ÊçÆ
                    height: document.getElementById('height').value,
                    weight: document.getElementById('weight').value,
                    bmi: document.getElementById('bmi').value,
                    bmiCategory: document.getElementById('bmi-category').textContent,
                    systolic: document.getElementById('systolic').value,
                    diastolic: document.getElementById('diastolic').value,
                    bloodSugarFasting: document.getElementById('blood-sugar-fasting').value,
                    bloodSugarDinner: document.getElementById('blood-sugar-dinner').value,
                    symptoms: Array.from(document.querySelectorAll('[name="symptoms"]:checked')).map(c => c.value),
                    hypertensionComplications: Array.from(document.querySelectorAll('[name="hypertension-complications"]:checked')).map(c => c.value),
                    hypertensionOther: document.getElementById('hypertension-other').value, // Êñ∞Â¢ûÂ≠óÊÆµ
                    diabetesComplications: Array.from(document.querySelectorAll('[name="diabetes-complications"]:checked')).map(c => c.value),
                    diabetesOther: document.getElementById('diabetes-other').value, // Êñ∞Â¢ûÂ≠óÊÆµ
                    allergy: document.querySelector('input[name="allergy"]:checked')?.value || 'Âê¶',
                    allergyDetails: document.getElementById('allergy-details').value
                };
    
                // Âü∫Êú¨È™åËØÅ
                if (!formData.name || !formData.age || !formData.systolic || !formData.diastolic || !formData.height || !formData.weight) {
                    alert(isMiaoMode ? 'Niub Dab Fenb Qebt' : 'ËØ∑Â°´ÂÜôÊâÄÊúâÂøÖÂ°´Â≠óÊÆµ');
                    document.getElementById('loading').style.display = 'none';
                    return;
                }
                
                // Ê£ÄÊü•ÁºìÂ≠ò‰∏≠ÊòØÂê¶ÊúâÁõ∏‰ººÊä•Âëä
                const cacheKey = generateCacheKey(formData);
                const cachedReport = localStorage.getItem(cacheKey);
                
                if (cachedReport) {
                    // ‰ΩøÁî®ÁºìÂ≠òÁöÑÊä•ÂëäÂÜÖÂÆπ
                    console.log("‰ΩøÁî®ÁºìÂ≠òÁöÑÊä•ÂëäÂÜÖÂÆπ");
                    showReport(formData, cachedReport);
                    return;
                }
    
                // ÊûÑÂª∫ÊèêÁ§∫ËØç
                const prompt = `‰Ωú‰∏∫‰∏ì‰∏öÂåªÁîüÔºåËØ∑Ê†πÊçÆ‰ª•‰∏ãÊÇ£ËÄÖ‰ø°ÊÅØÁîüÊàêËØ¶ÁªÜÂÅ•Â∫∑Êä•ÂëäÔºö
ÊÇ£ËÄÖ‰ø°ÊÅØÔºö
- ÂßìÂêçÔºö${formData.name}
- Âπ¥ÈæÑÔºö${formData.age}Â≤Å
- ÊÄßÂà´Ôºö${formData.gender}
- Ê∞ëÊóèÔºö${formData.ethnicity}
- Ë∫´È´òÔºö${formData.height} cm
- ‰ΩìÈáçÔºö${formData.weight} kg
- BMIÔºö${formData.bmi}Ôºà${formData.bmiCategory}Ôºâ
- Ë°ÄÂéãÔºö${formData.systolic}/${formData.diastolic} mmHg
- Ë°ÄÁ≥ñÔºöÁ©∫ËÖπ ${formData.bloodSugarFasting} mmol/LÔºåÈ§êÂêé ${formData.bloodSugarDinner} mmol/L
- ÁóáÁä∂Ôºö${formData.symptoms.join(', ') || 'Êó†'}
- Âπ∂ÂèëÁóáÔºö
  * È´òË°ÄÂéãÔºö${formData.hypertensionComplications.join(', ') || 'Êó†'}${formData.hypertensionOther ? 'Ôºå' + formData.hypertensionOther : ''}
  * Á≥ñÂ∞øÁóÖÔºö${formData.diabetesComplications.join(', ') || 'Êó†'}${formData.diabetesOther ? 'Ôºå' + formData.diabetesOther : ''}
- ËøáÊïèÂè≤Ôºö${formData.allergy === 'ÊòØ' ? formData.allergyDetails : 'Êó†'}

ËØ∑Áî®${isMiaoMode ? 'ËãóËØ≠' : '‰∏≠Êñá'}Êåâ‰ª•‰∏ãÁªìÊûÑÁªÑÁªáÊä•ÂëäÂÜÖÂÆπÔºå‰ΩøÁî®MarkdownÊ†ºÂºèÔºåËØ∑‰∏•Ê†º‰ΩøÁî®‰ª•‰∏ãÊ†ºÂºèÔºö
## È£éÈô©ËØÑ‰º∞
1. È´òË°ÄÂéãÈ£éÈô©ËØÑ‰º∞...
    1.Á¨¨‰∏ÄÊù°ÂÜÖÂÆπ...
    2.Á¨¨‰∫åÊù°ÂÜÖÂÆπ...
2. Á≥ñÂ∞øÁóÖÈ£éÈô©ËØÑ‰º∞...
    1.Á¨¨‰∏ÄÊù°ÂÜÖÂÆπ...
    2.Á¨¨‰∫åÊù°ÂÜÖÂÆπ...

## ÂåªÁñóÂª∫ËÆÆ
### 1. Ë•øËçØÊ≤ªÁñóÊñπÊ°à
1. Á¨¨‰∏ÄÊù°Âª∫ËÆÆ...
2. Á¨¨‰∫åÊù°Âª∫ËÆÆ...

### 2. ‰∏≠ËçØ/Ê∞ëÊóèÂåªËçØÂª∫ËÆÆ
1. Á¨¨‰∏ÄÊù°Âª∫ËÆÆ...
2. Á¨¨‰∫åÊù°Âª∫ËÆÆ...

## Ê∞ëÊóèÂåªËçØÁâπËâ≤Âª∫ËÆÆ
${generateEthnicMedicinePrompt(formData.ethnicity)}

## ÁîüÊ¥ªÂª∫ËÆÆ
### 1. È•ÆÈ£üÂª∫ËÆÆ
- Á¨¨‰∏ÄÊù°Âª∫ËÆÆ...
- Á¨¨‰∫åÊù°Âª∫ËÆÆ...
### 2. ËøêÂä®Âª∫ËÆÆ
- Á¨¨‰∏ÄÊù°Âª∫ËÆÆ...
- Á¨¨‰∫åÊù°Âª∫ËÆÆ..


## Ê≥®ÊÑè‰∫ãÈ°π
[ÁâπÊÆäË≠¶Á§∫‰ø°ÊÅØ]

${shouldProvideEthnicMedicine(formData.ethnicity) ? 'ËØ∑ÁâπÂà´ÂÖ≥Ê≥®‰º†ÁªüÂåªËçØÂíåÁé∞‰ª£ÂåªÂ≠¶ÁöÑÁªìÂêàÔºåÊèê‰æõÂÖ®Èù¢ÁöÑÂÅ•Â∫∑ÊåáÂØº„ÄÇ' : ''}`;

                // Ê∑ªÂä†Ê†πÊçÆÊ∞ëÊóèÁîüÊàêÂØπÂ∫îÂåªÂ≠¶Âª∫ËÆÆÊèêÁ§∫ÁöÑÂáΩÊï∞
                function generateEthnicMedicinePrompt(ethnicity) {
                    switch(ethnicity) {
                        case 'ËãóÊóè':
                            return 'ËØ∑Âú®Ê≠§ÈÉ®ÂàÜËØ¶ÁªÜÈòêËø∞ÈÄÇÂêàËãóÊóèÊÇ£ËÄÖÁöÑ‰º†ÁªüÂåªËçØÁü•ËØÜÔºåÂåÖÊã¨ËçâËçØ„ÄÅÈ£üÁñóÂíå‰º†ÁªüÊ≤ªÁñóÊñπÊ≥ïÔºåËøôÈÉ®ÂàÜÂçïÁã¨Êàê‰∏∫‰∏Ä‰∏™Á´†ËäÇ„ÄÇÁâπÂà´ÂÖ≥Ê≥®ËãóÊóèÊ∞ëÈó¥ÂØπÈ´òË°ÄÂéãÂíåÁ≥ñÂ∞øÁóÖÁöÑ‰º†ÁªüÊ≤ªÁñóÊñπÊ≥ï‰∏éÁªèÈ™åÔºåÂ¶ÇËãóÂåªÁöÑ"Á≥ØÊâé"ÔºàÊîæË°ÄÁñóÊ≥ïÔºâ„ÄÅ"Á≥ØÁÅ∏"ÔºàËâæÁÅ∏ÔºâÂíåËãóÊóèÂ∏∏Áî®ËçØÊùêÂ¶ÇÈªÑÁ≤æ„ÄÅËã¶ÂèÇ„ÄÅËí≤ÂÖ¨Ëã±„ÄÅÈáëÈì∂Ëä±Á≠âÂú®Ê≤ªÁñóÈ´òË°ÄÂéãÂíåÁ≥ñÂ∞øÁóÖÁöÑÂ∫îÁî®„ÄÇ';
                            
                        case 'Ê∞¥Êóè':
                            return 'ËØ∑Âú®Ê≠§ÈÉ®ÂàÜËØ¶ÁªÜÈòêËø∞ÈÄÇÂêàÊ∞¥ÊóèÊÇ£ËÄÖÁöÑ‰º†ÁªüÂåªËçØÁü•ËØÜÔºåÂåÖÊã¨ËçâËçØ„ÄÅÈ£üÁñóÂíå‰º†ÁªüÊ≤ªÁñóÊñπÊ≥ïÔºåËøôÈÉ®ÂàÜÂçïÁã¨Êàê‰∏∫‰∏Ä‰∏™Á´†ËäÇ„ÄÇÁâπÂà´‰ªãÁªçÊ∞¥ÊóèÂåªËçØÁâπËâ≤ÔºåÂ¶Ç"Ê∞¥ÊóèÂçÅ‰∏âÊñπ"‰º†ÁªüËçØÊñπ„ÄÅÊ∞¥ÊóèÁâπÊúâÁöÑ"ÂÜ∑ÁÉ≠Âπ≥Ë°°"Ê≤ªÁñóÁêÜÂøµÔºå‰ª•ÂèäÊ∞¥ÊóèÂ∏∏Áî®ËçØÊùêÂ¶ÇÈáëÊ®±Ê†π„ÄÅÊ∞¥Áâõ‰∏É„ÄÅÈ±ºËÖ•Ëçâ„ÄÅÈ©¨ËπÑÊ†πÁ≠âÂú®Ê≤ªÁñóÈ´òË°ÄÂéãÂíåÁ≥ñÂ∞øÁóÖÊñπÈù¢ÁöÑÂ∫îÁî®„ÄÇ‰πü‰ªãÁªçÊ∞¥ÊóèÁâπËâ≤ÁöÑËçØÊµ¥„ÄÅËâæÁÅ∏ÂíåÂàÆÁóßÁ≠âÂ§ñÊ≤ªÊ≥ï„ÄÇ';
                            
                        case '‰ª°‰Ω¨Êóè':
                            return 'ËØ∑Âú®Ê≠§ÈÉ®ÂàÜËØ¶ÁªÜÈòêËø∞ÈÄÇÂêà‰ª°‰Ω¨ÊóèÊÇ£ËÄÖÁöÑ‰º†ÁªüÂåªËçØÁü•ËØÜÔºåÂåÖÊã¨ËçâËçØ„ÄÅÈ£üÁñóÂíå‰º†ÁªüÊ≤ªÁñóÊñπÊ≥ïÔºåËøôÈÉ®ÂàÜÂçïÁã¨Êàê‰∏∫‰∏Ä‰∏™Á´†ËäÇ„ÄÇÁâπÂà´ÂÖ≥Ê≥®‰ª°‰Ω¨Êóè‰º†ÁªüÂåªËçØ‰∏≠ÁöÑ"‰∏â‰∏É"Â∫îÁî®„ÄÅ"Ë∑åÊâìÊçü‰º§ËçØ"ËΩ¨ÂåñÊ≤ªÁñóÊÖ¢ÊÄßÁóÖÁöÑÊñπÊ≥ïÔºå‰ª•Âèä‰ª°‰Ω¨ÊóèÁâπÊúâÁöÑËçØÈÖí„ÄÅËçØËÜèÁ≠âÂà∂ÂâÇÂú®È´òË°ÄÂéãÂíåÁ≥ñÂ∞øÁóÖÊ≤ªÁñó‰∏≠ÁöÑËæÖÂä©‰ΩúÁî®„ÄÇ‰ªãÁªç‰ª°‰Ω¨ÊóèÂ∏∏Áî®ËçØÊùêÂ¶Ç‰ªôËåÖ„ÄÅËëõÊ†π„ÄÅËõáÂ∫äÂ≠ê„ÄÅ‰ª°‰Ω¨ÂáâÂ∏≠ËçâÁ≠âÁöÑÂäüÊïàÂíåÁî®Ê≥ï„ÄÇ';
                            
                        case '‰æóÊóè':
                            return 'ËØ∑Âú®Ê≠§ÈÉ®ÂàÜËØ¶ÁªÜÈòêËø∞ÈÄÇÂêà‰æóÊóèÊÇ£ËÄÖÁöÑ‰º†ÁªüÂåªËçØÁü•ËØÜÔºåÂåÖÊã¨ËçâËçØ„ÄÅÈ£üÁñóÂíå‰º†ÁªüÊ≤ªÁñóÊñπÊ≥ïÔºåËøôÈÉ®ÂàÜÂçïÁã¨Êàê‰∏∫‰∏Ä‰∏™Á´†ËäÇ„ÄÇÁâπÂà´‰ªãÁªç‰æóÊóèÂåªËçØ‰∏≠ÁöÑ"‰æóËçØ‰πùÂà∂"„ÄÅ"‰æóÊóèËçØÊûï"„ÄÅËçØÊµ¥ÁñóÊ≥ïÔºå‰ª•Âèä‰æóÊóèÁâπÊúâÁöÑ"‰æóÂåªËçØËå∂"„ÄÅÈÖ∏ÊÄßÈ£üÁâ©Âú®Ë∞ÉËäÇË°ÄÂéãÂíåË°ÄÁ≥ñÊñπÈù¢ÁöÑ‰ΩúÁî®„ÄÇÁªìÂêà‰æóÊóèÂ∏∏Áî®ËçØÊùêÂ¶Ç‰æóÊóèËçâËçØ„ÄÅÈáéÁîüÁÅµËäù„ÄÅ‰æóËçØ‰∫îÂÄçÂ≠êÁ≠âÂú®Ê≤ªÁñóÈ´òË°ÄÂéãÂíåÁ≥ñÂ∞øÁóÖÊñπÈù¢ÁöÑÂ∫îÁî®„ÄÇ';
                            
                        default:
                            return 'Ê≠§ÈÉ®ÂàÜÊ†πÊçÆÊÇ£ËÄÖÊ∞ëÊóèËÉåÊôØÊèê‰æõÁõ∏ÂÖ≥ÁöÑ‰º†ÁªüÂåªËçØÂª∫ËÆÆ„ÄÇ';
                    }
                }

                // Âà§Êñ≠ÊòØÂê¶Â∫îËØ•Êèê‰æõÊ∞ëÊóèÂåªÂ≠¶Âª∫ËÆÆ
                function shouldProvideEthnicMedicine(ethnicity) {
                    return ['ËãóÊóè', 'Ê∞¥Êóè', '‰ª°‰Ω¨Êóè', '‰æóÊóè'].includes(ethnicity) || isMiaoMode;
                }
    
                // ËÆæÁΩÆËØ∑Ê±ÇË∂ÖÊó∂
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 30000); // 30ÁßíË∂ÖÊó∂
                
                try {
                // Ë∞ÉÁî®API
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${DEEPSEEK_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: "deepseek-chat",
                        messages: [{ role: "user", content: prompt }],
                        temperature: 0.3
                        }),
                        signal: controller.signal
                });
                    
                    clearTimeout(timeoutId);
    
                const data = await response.json();
                const reportContent = data.choices[0].message.content;
                    
                    // ÁºìÂ≠òÊä•ÂëäÂÜÖÂÆπ
                    localStorage.setItem(cacheKey, reportContent);
    
                // ÁîüÊàêÊä•ÂëäÈ°µÈù¢
                showReport(formData, reportContent);
                } catch (fetchError) {
                    if (fetchError.name === 'AbortError') {
                        // Â§ÑÁêÜË∂ÖÊó∂
                        handleTimeoutFallback(formData);
                    } else {
                        throw fetchError;
                    }
                }
            } catch (error) {
                alert(isMiaoMode ? 'Baot Dak Bib: ' + error.message : `Êä•ÂëäÁîüÊàêÂ§±Ë¥•: ${error.message}`);
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }
    
        // ÁîüÊàêÁºìÂ≠òÈîÆ
        function generateCacheKey(formData) {
            // ÂàõÂª∫ÂîØ‰∏ÄÊ†áËØÜÔºå‰ΩøÁî®ÂÖ≥ÈîÆÂ≠óÊÆµ
            return `report_${formData.ethnicity}_${formData.gender}_${formData.age}_${formData.systolic}_${formData.diastolic}_${formData.bloodSugarFasting}_${Math.floor(Date.now() / (1000 * 60 * 60 * 24))}`;
        }
    
        // Â§ÑÁêÜË∂ÖÊó∂ÁöÑÂõûÈÄÄÊñπÊ°à
        function handleTimeoutFallback(formData) {
            alert("ÁîüÊàêÊä•ÂëäÊó∂Èó¥ËæÉÈïøÔºåÊ≠£Âú®‰ΩøÁî®Âø´ÈÄüÊ®°Âºè...");
            
            // ÁîüÊàê‰∏Ä‰∏™ÁÆÄÂåñÁöÑÊä•Âëä
            const simplifiedReport = generateSimplifiedReport(formData);
            showReport(formData, simplifiedReport);
        }
    
        // ÁîüÊàêÁÆÄÂåñÁâàÊä•Âëä
        function generateSimplifiedReport(formData) {
            return `
## È£éÈô©ËØÑ‰º∞
1. È´òË°ÄÂéãÈ£éÈô©ËØÑ‰º∞
   - Ë°ÄÂéãÂÄºÔºö${formData.systolic}/${formData.diastolic} mmHgÔºå${evaluateBloodPressure(formData.systolic, formData.diastolic)}
   - ÈúÄÂÖ≥Ê≥®Âπ∂ÂèëÁóáÔºö${formData.hypertensionComplications.join('„ÄÅ') || 'ÊöÇÊó†'}

2. Á≥ñÂ∞øÁóÖÈ£éÈô©ËØÑ‰º∞
   - Á©∫ËÖπË°ÄÁ≥ñÔºö${formData.bloodSugarFasting} mmol/LÔºå${evaluateBloodSugar(formData.bloodSugarFasting, true)}
   - È§êÂêéË°ÄÁ≥ñÔºö${formData.bloodSugarDinner} mmol/LÔºå${evaluateBloodSugar(formData.bloodSugarDinner, false)}
   - ÈúÄÂÖ≥Ê≥®Âπ∂ÂèëÁóáÔºö${formData.diabetesComplications.join('„ÄÅ') || 'ÊöÇÊó†'}

## ÂåªÁñóÂª∫ËÆÆ
### 1. Ë•øËçØÊ≤ªÁñóÊñπÊ°à
1. ËØ∑ÈÅµÂåªÂò±ÊúçÁî®ÈôçÂéãËçØÁâ©
2. ËØ∑ÈÅµÂåªÂò±ÊéßÂà∂Ë°ÄÁ≥ñ

### 2. ‰∏≠ËçØ/Ê∞ëÊóèÂåªËçØÂª∫ËÆÆ
1. Âª∫ËÆÆÂú®‰∏ì‰∏ö‰∏≠ÂåªÊåáÂØº‰∏ã‰ΩøÁî®‰∏≠ËçØË∞ÉÁêÜ
2. Ëæ®ËØÅÊñΩÊ≤ªÔºåÊ†πÊçÆ‰ΩìË¥®‰∏™ÊÄßÂåñÁî®ËçØ

## ÁîüÊ¥ªÂª∫ËÆÆ
### 1. È•ÆÈ£üÂª∫ËÆÆ
- ÂáèÂ∞ëÁõêÂàÜÊëÑÂÖ•ÔºåÊéßÂà∂ÊØèÊó•ÊëÑÂÖ•Èáè‰Ωé‰∫é6g
- ÈôêÂà∂È´òÁ≥ñÈ£üÁâ©ÔºåÂ¢ûÂä†ËÜ≥È£üÁ∫§Áª¥ÊëÑÂÖ•
- Â§öÈ£üÁî®Êñ∞È≤úËî¨ÊûúÔºåÊéßÂà∂ÊÄªÁÉ≠Èáè

### 2. ËøêÂä®Âª∫ËÆÆ
- ÂùöÊåÅÊúâÊ∞ßËøêÂä®ÔºåÂ¶ÇÂø´Ëµ∞„ÄÅÊ∏∏Ê≥≥Á≠â
- ÊØèÂë®Ëá≥Â∞ë150ÂàÜÈíü‰∏≠Á≠âÂº∫Â∫¶ËøêÂä®
- ÈÅøÂÖçÂâßÁÉàËøêÂä®ÔºåÊéßÂà∂ËøêÂä®Âº∫Â∫¶

## Ê≥®ÊÑè‰∫ãÈ°π
ÂÆöÊúüÁõëÊµãË°ÄÂéãÂíåË°ÄÁ≥ñÔºåÂá∫Áé∞ÂºÇÂ∏∏ÂèäÊó∂Â∞±Âåª„ÄÇ‰øùÊåÅËâØÂ•ΩÂøÉÊÄÅÔºåÈÅøÂÖçÊÉÖÁª™Ê≥¢Âä®„ÄÇ

*Êú¨Êä•Âëä‰∏∫‰∏¥Êó∂ÁîüÊàêÔºåËØ∑‰ª•ÂåªÁîüËØäÊñ≠‰∏∫ÂáÜ*
`;
        }
    
        // ËØÑ‰º∞Ë°ÄÂéã
        function evaluateBloodPressure(systolic, diastolic) {
            if (systolic < 120 && diastolic < 80) {
                return "Ê≠£Â∏∏";
            } else if ((systolic >= 120 && systolic < 140) || (diastolic >= 80 && diastolic < 90)) {
                return "Ë°ÄÂéãÂÅèÈ´ò";
            } else if (systolic >= 140 || diastolic >= 90) {
                return "È´òË°ÄÂéã";
            }
            return "ÈúÄËØÑ‰º∞";
        }
    
        // ËØÑ‰º∞Ë°ÄÁ≥ñ
        function evaluateBloodSugar(value, isFasting) {
            if (isFasting) {
                if (value < 6.1) return "Ê≠£Â∏∏";
                else if (value >= 6.1 && value < 7.0) return "Á©∫ËÖπË°ÄÁ≥ñÂèóÊçü";
                else return "ÂÅèÈ´ò";
            } else {
                if (value < 7.8) return "Ê≠£Â∏∏";
                else if (value >= 7.8 && value < 11.1) return "Á≥ñËÄêÈáèÂèóÊçü";
                else return "ÂÅèÈ´ò";
            }
        }
    
        // Êõ¥Êñ∞ÊòæÁ§∫Êä•ÂëäÁöÑ‰∏ªÂáΩÊï∞
function showReport(formData, reportContent) {
    // ÁßªÈô§ÂèØËÉΩÂá∫Áé∞ÁöÑmarkdownÂâçÁºÄÂíåÊ†áËÆ∞
    let cleanedReportContent = reportContent.replace(/^markdown\s*/i, '').replace(/\bmarkdown\b/gi, '');
    
    // Â∞ÜMarkdownËΩ¨Êç¢‰∏∫HTML
    const htmlContent = parseMarkdown(cleanedReportContent);
    
            // Ê∑ªÂä†Ê∞ëÊóèÂåªËçØÂª∫ËÆÆÁâπÊÆäÂå∫Âüü
            const enhancedHtmlContent = addEthnicMedicineHighlight(htmlContent, formData.ethnicity);
            
            // ‰øùÂ≠òÂéüÊù•ÁöÑÈ°∂ÈÉ®Â∑•ÂÖ∑Ê†è
            const originalToolbar = document.querySelector('.top-toolbar');
            
            // Êõ¥Êñ∞DOMÊòæÁ§∫Êä•ÂëäÔºå‰ΩÜ‰øùÁïôÈ°∂ÈÉ®Â∑•ÂÖ∑Ê†è
    document.getElementById('healthForm').style.display = 'none';
    document.getElementById('reportContainer').innerHTML = `
                <h2>${formData.name}${isMiaoMode ? ' Jiank Kangt Baot' : 'ÁöÑÂÅ•Â∫∑Êä•Âëä'}</h2>
                <div class="language-indicator">${isMiaoMode ? 'ËãóËØ≠ÁâàÊú¨' : '‰∏≠ÊñáÁâàÊú¨'}</div>
        <div class="report-section">
                    <div class="report-content" contenteditable="true">${enhancedHtmlContent}</div>
        </div>
                <div class="report-controls">
                    <button class="control-btn" onclick="printReport()">ÊâìÂç∞Êä•Âëä</button>
                    <button class="control-btn" onclick="saveReport()">‰øùÂ≠òÊä•Âëä</button>
                    <button onclick="location.reload()">${isMiaoMode ? 'Rout Diex Dab' : 'ËøîÂõûÈóÆËØäË°®Âçï'}</button>
                </div>
    `;
    document.getElementById('reportContainer').style.display = 'block';
    
    // Â∫îÁî®‰ºòÂåñÊ†∑Âºè
    applyOptimizedReportStyles();
            
            // Á°Æ‰øùÂ∑•ÂÖ∑Ê†èÊåâÈíÆÂú®Êä•ÂëäÈ°µÈù¢‰ªçÁÑ∂ÊúâÊïà
            rebindToolbarEvents();
        }
        
        // Êñ∞Â¢ûÂáΩÊï∞ÔºöÈáçÊñ∞ÁªëÂÆöÂ∑•ÂÖ∑Ê†è‰∫ã‰ª∂
        function rebindToolbarEvents() {
            // ÈáçÊñ∞Ëé∑ÂèñÂ≠ó‰ΩìÂ§ßÂ∞èÊåâÈíÆÂπ∂ÁªëÂÆö‰∫ã‰ª∂
            const fontSizeToggle = document.getElementById('font-size-toggle');
            if (fontSizeToggle) {
                fontSizeToggle.addEventListener('click', function() {
                    currentFontSize = (currentFontSize + 1) % 3;
                    document.body.classList.remove('large-font', 'x-large-font');
                    
                    if (currentFontSize === 1) {
                        document.body.classList.add('large-font');
                        this.innerHTML = '<span>Aa</span> ' + (isMiaoMode ? 'Meil Delk' : 'Â§ßÂ≠óÊ®°Âºè');
                    } else if (currentFontSize === 2) {
                        document.body.classList.add('x-large-font');
                        this.innerHTML = '<span>Aa</span> ' + (isMiaoMode ? 'Meil Dal' : 'ÁâπÂ§ßÂ≠ó‰Ωì');
                    } else {
                        this.innerHTML = '<span>Aa</span> ' + (isMiaoMode ? 'Meil Delk Lol' : 'Â§ßÂ≠óÊòæÁ§∫');
                    }
                });
            }
            
            // ÈáçÊñ∞ÁªëÂÆöËØ≠Ë®ÄÂàáÊç¢ÊåâÈíÆ‰∫ã‰ª∂
            const languageToggle = document.getElementById('language-toggle');
            if (languageToggle) {
                languageToggle.addEventListener('click', function() {
                    // Âú®Êä•ÂëäÈ°µÈù¢‰∏çÂÖÅËÆ∏ÂàáÊç¢ËØ≠Ë®ÄÔºåÂõ†‰∏∫ËøôÈúÄË¶ÅÈáçÊñ∞ÁîüÊàêÊä•Âëä
                    alert('Êä•ÂëäÂ∑≤ÁîüÊàêÔºåÊó†Ê≥ïÂú®Ê≠§È°µÈù¢ÂàáÊç¢ËØ≠Ë®Ä„ÄÇËØ∑ËøîÂõûË°®ÂçïÈ°µÈù¢ÈáçÊñ∞ÁîüÊàêÊä•Âëä„ÄÇ');
                });
            }
        }

        // ‰øÆÊîπÈ´ò‰∫ÆÊ∞ëÊóèÂåªËçØÂª∫ËÆÆÈÉ®ÂàÜÁöÑÂáΩÊï∞
        function addEthnicMedicineHighlight(html, ethnicity) {
            // ËØÜÂà´ÂåÖÂê´Ê∞ëÊóèÂåªËçØÂª∫ËÆÆÁöÑÊ†áÈ¢òÂíåÂÜÖÂÆπ
            const ethnicMedicineRegex = /<h2>Ê∞ëÊóèÂåªËçØÁâπËâ≤Âª∫ËÆÆ<\/h2>|<h2>Minb Zux Yak<\/h2>/;
            
            // Â¶ÇÊûúÊòØËãóÊóèÁî®Êà∑Êàñ‰ΩøÁî®ËãóËØ≠Ê®°ÂºèÔºåÁ°Æ‰øùÊ∞ëÊóèÂåªËçØÂª∫ËÆÆÈÉ®ÂàÜÂæóÂà∞Á™ÅÂá∫ÊòæÁ§∫
            const shouldHighlightEthnicMedicine = ethnicity === 'ËãóÊóè' || isMiaoMode;
            
            if (ethnicMedicineRegex.test(html)) {
                // ÊèêÂèñÊ∞ëÊóèÂåªËçØÈÉ®ÂàÜÁöÑÂÜÖÂÆπ
                let parts = html.split(ethnicMedicineRegex);
                if (parts.length >= 2) {
                    // ÊâæÂà∞‰∏ã‰∏Ä‰∏™h2Ê†áÈ¢òÁöÑ‰ΩçÁΩÆÔºåÊà™Âèñ‰∏≠Èó¥ÈÉ®ÂàÜ
                    const nextH2Index = parts[1].indexOf('<h2>');
                    let ethnicMedicinePart;
                    
                    if (nextH2Index !== -1) {
                        ethnicMedicinePart = parts[1].substring(0, nextH2Index);
                        parts[1] = parts[1].substring(nextH2Index);
                    } else {
                        ethnicMedicinePart = parts[1];
                        parts[1] = '';
                    }
                    
                    // Â∫îÁî®ÁâπÊÆäÊ†∑ÂºèÂà∞Ê∞ëÊóèÂåªËçØÈÉ®ÂàÜ
                    const ethnicMedicineHtml = `
                    <div class="ethnic-medicine-advice">
                        <h2>${isMiaoMode ? 'Minb Zux Yak' : 'Ê∞ëÊóèÂåªËçØÁâπËâ≤Âª∫ËÆÆ'}</h2>
                        ${ethnicMedicinePart}
                        ${shouldHighlightEthnicMedicine ? '<div class="miao-medicine-note">‰ª•‰∏äÂª∫ËÆÆÊ†πÊçÆËãóÊóè‰º†ÁªüÂåªËçØÁü•ËØÜÊèê‰æõÔºåÁªìÂêàÁé∞‰ª£ÂåªÂ≠¶ÁêÜËÆ∫ÂèÇËÄÉ„ÄÇ</div>' : ''}
                    </div>
                    `;
                    
                    // ÈáçÁªÑHTML
                    return parts[0] + ethnicMedicineHtml + parts[1];
                }
            }
            
            return html;
}

// MarkdownËß£Êûê‰∏ªÂáΩÊï∞
function parseMarkdown(markdown) {
    // Â§ÑÁêÜÊ†áÈ¢ò
    let html = markdown
        .replace(/^# (.*$)/gm, '<h1>$1</h1>')
        .replace(/^## (.*$)/gm, '<h2>$1</h2>')
        .replace(/^### (.*$)/gm, '<h3>$1</h3>')
        .replace(/^#### (.*$)/gm, '<h4>$1</h4>');
    
    // Â§ÑÁêÜÂàóË°® - ‰ΩøÁî®Êñ∞ÁöÑÁÆÄÂåñÊñπÊ≥ï
    html = processLists(html);
    
    // Â§ÑÁêÜÁ≤ó‰ΩìÂíåÊñú‰Ωì
    html = html
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.*?)\*/g, '<em>$1</em>')
        .replace(/_([^_]+)_/g, '<em>$1</em>');
    
    // Â§ÑÁêÜ‰ª£Á†Å
    html = html
        .replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>')
        .replace(/`([^`]+)`/g, '<code>$1</code>');
    
    // Â§ÑÁêÜÈìæÊé•ÂíåÂõæÁâá
    html = html
        .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2">$1</a>')
        .replace(/!\[([^\]]+)\]\(([^)]+)\)/g, '<img src="$2" alt="$1">');
    
    // Â§ÑÁêÜÂºïÁî®ÂíåÊ∞¥Âπ≥Á∫ø
    html = html
        .replace(/^> (.*$)/gm, '<blockquote>$1</blockquote>')
        .replace(/^\-\-\-$/gm, '<hr>');
    
    // Â§ÑÁêÜÊÆµËêΩ
    html = processParagraphs(html);
    
    return html;
}
        
function addBulletListStyle() {
    const styleElement = document.createElement('style');
    styleElement.textContent = `
        .bullet-list {
            list-style-type: disc; /* ‰ΩøÁî®ÂÆûÂøÉÂúÜÁÇπ */
            padding-left: 30px;
            margin: 15px 0;
        }
        
        .bullet-list li {
            margin-bottom: 8px;
            position: relative;
        }
        
        /* ÁßªÈô§ÊóßÁöÑÁºñÂè∑Ê†∑Âºè */
        .numbered-list {
            list-style-type: disc !important; /* Âº∫Âà∂‰ΩøÁî®ÂÆûÂøÉÂúÜÁÇπ */
        }
        
        .numbered-list li::before {
            content: none !important; /* ÁßªÈô§Ëá™ÂÆö‰πâÁºñÂè∑ */
        }
    `;
    document.head.appendChild(styleElement);
}

// Â§ÑÁêÜÊÆµËêΩ
function processParagraphs(html) {
    // ÊåâÊç¢Ë°åÁ¨¶ÂàÜÂâ≤
    const lines = html.split('\n');
    let processedHtml = '';
    let inParagraph = false;
    
    for (let i = 0; i < lines.length; i++) {
        const line = lines[i].trim();
        
        // Ë∑≥ËøáÂ∑≤ÁªèÊòØHTMLÊ†áÁ≠æÁöÑË°å
        if (!line || 
            line.startsWith('<h') || 
            line.startsWith('<ul') || 
            line.startsWith('<ol') || 
            line.startsWith('<li') || 
            line.startsWith('<pre') || 
            line.startsWith('<blockquote') ||
            line.startsWith('<hr') ||
            line.startsWith('</')) {
            
            if (inParagraph) {
                processedHtml += '</p>\n';
                inParagraph = false;
            }
            
            processedHtml += line + '\n';
            continue;
        }
        
        // ÂºÄÂßãÊñ∞ÊÆµËêΩ
        if (!inParagraph) {
            processedHtml += '<p>' + line;
            inParagraph = true;
        } else {
            // ÁªßÁª≠ÂΩìÂâçÊÆµËêΩ
            processedHtml += '<br>' + line;
        }
        
        // Â¶ÇÊûú‰∏ã‰∏ÄË°åÊòØÁ©∫Ë°åÊàñËÄÖÊòØHTMLÊ†áÁ≠æÔºåÁªìÊùüÂΩìÂâçÊÆµËêΩ
        if (i === lines.length - 1 || 
            !lines[i + 1].trim() || 
            lines[i + 1].trim().startsWith('<')) {
            
            if (inParagraph) {
                processedHtml += '</p>\n';
                inParagraph = false;
            }
        }
    }
    
    // Á°Æ‰øùÊâÄÊúâÊÆµËêΩÈÉΩÊ≠£Á°ÆÂÖ≥Èó≠
    if (inParagraph) {
        processedHtml += '</p>\n';
    }
    
    return processedHtml;
}

// ÂÆåÂÖ®ÈáçÂÜôÂàóË°®Â§ÑÁêÜÂáΩÊï∞ÔºåÂ∞ÜÊâÄÊúâÊúâÂ∫èÂàóË°®ËΩ¨Êç¢‰∏∫Êó†Â∫èÂàóË°®ÔºàÈ°πÁõÆÁ¨¶Âè∑Ôºâ
function processLists(text) {
    // 1. ÂÖàÁßªÈô§ÊâÄÊúâÁ±ªÂûãÁöÑÂàóË°®Ê†áËÆ∞ÔºåÂåÖÊã¨ÁºñÂè∑ÂíåÁ¨¶Âè∑
    let cleanedText = text;
    
    // ÁßªÈô§ÈáçÂ§çÁöÑÁºñÂè∑ÔºàÂ¶Ç"1. 1."Ôºâ
    cleanedText = cleanedText.replace(/^(\s*)(\d+)\.\s*(\d+)\.\s+(.*?)$/gm, function(match, space, num1, num2, content) {
        return `${space}BULLET_MARKER ${content}`;
    });
    
    // ÁßªÈô§Âçï‰∏™ÁºñÂè∑ÔºàÂ¶Ç"1."Ôºâ
    cleanedText = cleanedText.replace(/^(\s*)(\d+)\.\s+(.*?)$/gm, function(match, space, num, content) {
        return `${space}BULLET_MARKER ${content}`;
    });
    
    // ÁßªÈô§Êó†Â∫èÂàóË°®Á¨¶Âè∑ÔºàÂ¶Ç"- "„ÄÅ"* "„ÄÅ"+ "Ôºâ
    cleanedText = cleanedText.replace(/^(\s*)[-*+]\s+(.*?)$/gm, function(match, space, content) {
        return `${space}BULLET_MARKER ${content}`;
    });
    
    // 2. ËØÜÂà´ÂàóË°®Âå∫ÂüüÂπ∂ËΩ¨Êç¢‰∏∫Êó†Â∫èÂàóË°®
    const lines = cleanedText.split('\n');
    let result = '';
    let inList = false;
    let listItems = [];
    
    for (let i = 0; i < lines.length; i++) {
        const line = lines[i];
        // Êü•ÊâæÊàë‰ª¨Ê†áËÆ∞ÁöÑÂàóË°®È°π
        const listItemMatch = line.match(/^(\s*)BULLET_MARKER\s+(.*)/);
        
        if (listItemMatch) {
            // ÊâæÂà∞ÂàóË°®È°π
            if (!inList) {
                // ÂºÄÂßã‰∏Ä‰∏™Êñ∞ÂàóË°®
                inList = true;
                listItems = [];
            }
            
            // Ê∑ªÂä†ÂàóË°®È°πÂÜÖÂÆπ
            listItems.push(listItemMatch[2]);
        } else if (inList && (line.trim() === '' || !line.includes('BULLET_MARKER'))) {
            // ÂàóË°®ÁªìÊùü
            result += generateBulletListHtml(listItems);
            inList = false;
            listItems = [];
            if (line.trim() !== '') {
                result += line;
            }
            result += '\n';
        } else {
            // ÈùûÂàóË°®ÂÜÖÂÆπ
            result += line + '\n';
        }
    }
    
    // Â§ÑÁêÜÊñáÊ°£ÁªìÊùüÊó∂ÁöÑÂàóË°®
    if (inList) {
        result += generateBulletListHtml(listItems);
    }
    
    return result;
}
        
// ÁîüÊàêÈ°πÁõÆÁ¨¶Âè∑ÂàóË°®HTML
function generateBulletListHtml(items) {
    if (items.length === 0) return '';
    
    let html = '<ul class="bullet-list">\n';
    for (let item of items) {
        html += `  <li>${item}</li>\n`;
    }
    html += '</ul>\n';
    return html;
}
        
// Â§ÑÁêÜÊúâÂ∫èÂàóË°® - ‰øÆÂ§çÈáçÂ§çÁºñÂè∑ÈóÆÈ¢ò
function processOrderedLists(text) {
    // 1. ÂÖàÁßªÈô§Ë°åÈ¶ñÁöÑÊï∞Â≠óÁºñÂè∑Ôºå‰øùÁïôÂÜÖÂÆπ
    let cleanedText = text.replace(/^(\s*)(\d+)\.\s*(\d+)\.\s+(.*?)$/gm, function(match, space, num1, num2, content) {
        // Âè™‰øùÁïôÂÜÖÂÆπÔºåÂà†Èô§ÊâÄÊúâÁºñÂè∑
        return `${space}LIST_ITEM_MARKER ${content}`;
    });

    // 2. ÂØπ‰∫éÂè™Êúâ‰∏Ä‰∏™ÁºñÂè∑ÁöÑË°å‰πüËøõË°åÂ§ÑÁêÜ
    cleanedText = cleanedText.replace(/^(\s*)(\d+)\.\s+(.*?)$/gm, function(match, space, num, content) {
        return `${space}LIST_ITEM_MARKER ${content}`;
    });

    // 3. ËØÜÂà´ÂàóË°®Âå∫Âüü
    const lines = cleanedText.split('\n');
    let result = '';
    let inList = false;
    let listItems = [];
    
    for (let i = 0; i < lines.length; i++) {
        const line = lines[i];
        // Êü•ÊâæÊàë‰ª¨Ê†áËÆ∞ÁöÑÂàóË°®È°π
        const listItemMatch = line.match(/^(\s*)LIST_ITEM_MARKER\s+(.*)/);
        
        if (listItemMatch) {
            // ÊâæÂà∞ÂàóË°®È°π
            if (!inList) {
                // ÂºÄÂßã‰∏Ä‰∏™Êñ∞ÂàóË°®
                inList = true;
                listItems = [];
            }
            
            // Ê∑ªÂä†ÂàóË°®È°πÂÜÖÂÆπ
            listItems.push(listItemMatch[2]);
        } else if (inList && line.trim() === '') {
            // Á©∫Ë°åÁªìÊùüÂàóË°®
            result += generateOrderedListHtml(listItems);
            inList = false;
            listItems = [];
            result += '\n';
        } else if (inList) {
            // ÂÖ∂‰ªñÂÜÖÂÆπÁªìÊùüÂàóË°®
            result += generateOrderedListHtml(listItems);
            inList = false;
            listItems = [];
            result += line + '\n';
        } else {
            // ÈùûÂàóË°®ÂÜÖÂÆπ
            result += line + '\n';
        }
    }
    
    // Â§ÑÁêÜÊñáÊ°£ÁªìÊùüÊó∂ÁöÑÂàóË°®
    if (inList) {
        result += generateOrderedListHtml(listItems);
    }
    
    return result;
}

// ÁîüÊàêÊúâÂ∫èÂàóË°®HTML
function generateOrderedListHtml(items) {
    if (items.length === 0) return '';
    
    let html = '<ol class="numbered-list">\n';
    for (let item of items) {
        html += `  <li>${item}</li>\n`;
    }
    html += '</ol>\n';
    return html;
}

// Â§ÑÁêÜÊó†Â∫èÂàóË°®
function processUnorderedLists(text) {
    const lines = text.split('\n');
    let result = '';
    let inList = false;
    let listItems = [];
    
    for (let i = 0; i < lines.length; i++) {
        const line = lines[i];
        const listMatch = line.match(/^(\s*)[-*+]\s+(.*)/);
        
        if (listMatch) {
            // ÊâæÂà∞Êó†Â∫èÂàóË°®È°π
            if (!inList) {
                inList = true;
                listItems = [];
            }
            
            // ‰øùÂ≠òÂàóË°®È°π
            const indent = listMatch[1].length;
            const content = listMatch[2];
            listItems.push({ indent, content });
        } else if (inList && (line.trim() === '' || !line.match(/^(\s*)[-*+]\s+(.*)/))) {
            // ÂàóË°®ÁªìÊùü
            result += generateUnorderedListHtml(listItems);
            inList = false;
            listItems = [];
            result += line + '\n';
        } else {
            // ÈùûÂàóË°®ÂÜÖÂÆπ
            result += line + '\n';
        }
    }
    
    // Â§ÑÁêÜÊñáÊ°£ÁªìÊùüÊó∂ÁöÑÂàóË°®
    if (inList) {
        result += generateUnorderedListHtml(listItems);
    }
    
    return result;
}

// ÁîüÊàêÊó†Â∫èÂàóË°®HTML
function generateUnorderedListHtml(items) {
    if (items.length === 0) return '';
    
    let html = '<ul class="bulleted-list">\n';
    
    for (let item of items) {
        html += `  <li>${item.content}</li>\n`;
    }
    
    html += '</ul>\n';
    return html;
}
        
// Ê∑ªÂä†Â¢ûÂº∫ÁöÑÊä•ÂëäÊ†∑Âºè
function applyOptimizedReportStyles() {
    const styleElement = document.createElement('style');
    styleElement.textContent = `
        /* ÂÆπÂô®Ê†∑Âºè */
        .container {
            padding: 30px !important;
            margin: 0 auto !important;
        }

                /* ÂÖ®Â±ÄÂ≠ó‰ΩìËÆæÁΩÆ */
                #reportContainer, .report-section, .report-content, 
                .report-content h2, .report-content h3, .report-content p, 
                .report-content ul, .report-content ol, .report-content li {
                    font-family: "Microsoft YaHei", "ÂæÆËΩØÈõÖÈªë", sans-serif !important;
                }

                /* Êä•ÂëäÂå∫ÂüüÂìçÂ∫îÂºèÂ≠ó‰ΩìÂ§ßÂ∞è */
                body.large-font .report-content {
                    font-size: 18px !important;
                }
                
                body.large-font .report-content h2 {
                    font-size: 30px !important;
                }
                
                body.large-font .report-content h3 {
                    font-size: 24px !important;
                }
                
                body.x-large-font .report-content {
                    font-size: 22px !important;
                }
                
                body.x-large-font .report-content h2 {
                    font-size: 36px !important;
                }
                
                body.x-large-font .report-content h3 {
                    font-size: 28px !important;
                }
                
                /* ‰øùÊåÅÂ∑•ÂÖ∑Ê†èÂú®Êä•ÂëäÈ°µÈù¢ÂèØËßÅ */
                .top-toolbar {
                    position: fixed;
                    top: 15px;
                    right: 20px;
                    display: flex;
                    gap: 15px;
                    z-index: 1000;
                    background: rgba(255, 255, 255, 0.9);
                    padding: 5px;
                    border-radius: 30px;
                    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
                }
                
                /* ÂÖ∂‰ΩôÂéüÊúâÊ†∑Âºè... */
            `;
            document.head.appendChild(styleElement);
        }

        // ‰øÆÂ§çÂ∑•ÂÖ∑Ê†è‰ΩçÁΩÆÈóÆÈ¢ò
        document.addEventListener('DOMContentLoaded', function() {
            // Á°Æ‰øùÂ∑•ÂÖ∑Ê†èÂßãÁªà‰Ωç‰∫éÁ™óÂè£È°∂ÈÉ®
            const toolbar = document.querySelector('.top-toolbar');
            if (toolbar) {
                document.body.appendChild(toolbar);
            }
        });

        // È°µÈù¢Âä†ËΩΩÊó∂Ê£ÄÊü•URLÂèÇÊï∞ÔºåËá™Âä®ÊøÄÊ¥ªÁõ∏Â∫îÊ®°Âºè
        window.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            
            // Ê£ÄÊü•ÊòØÂê¶ÊúâËØ≠Ë®ÄËÆæÁΩÆÂèÇÊï∞
            if (urlParams.has('lang')) {
                const lang = urlParams.get('lang');
                if (lang === 'miao') {
                    // Ëá™Âä®ÊøÄÊ¥ªËãóËØ≠Ê®°Âºè
                    isMiaoMode = true;
                    languageToggle.classList.add('active');
                    languageToggle.innerHTML = '<span>‰∏≠</span> ÂàáÊç¢‰∏≠Êñá';
                    translateToMiao();
                }
            }
            
            // Ê£ÄÊü•ÊòØÂê¶ÊúâÂ≠ó‰ΩìÂ§ßÂ∞èÂèÇÊï∞
            if (urlParams.has('fontSize')) {
                const size = urlParams.get('fontSize');
                if (size === 'large') {
                    currentFontSize = 1;
                    document.body.classList.add('large-font');
                    fontSizeToggle.innerHTML = '<span>Aa</span> ' + (isMiaoMode ? 'Meil Delk' : 'Â§ßÂ≠óÊ®°Âºè');
                } else if (size === 'xlarge') {
                    currentFontSize = 2;
                    document.body.classList.add('x-large-font');
                    fontSizeToggle.innerHTML = '<span>Aa</span> ' + (isMiaoMode ? 'Meil Dal' : 'ÁâπÂ§ßÂ≠ó‰Ωì');
                }
            }
            
            // Ê£ÄÊü•ÊòØÂê¶ÊúâÂèåËØ≠Ê®°ÂºèÂèÇÊï∞
            if (urlParams.has('bilingual') && urlParams.get('bilingual') === 'true') {
                isBilingualMode = true;
                inputModeToggle.classList.add('active');
                inputModeToggle.innerHTML = '<span>Âçï</span> ' + (isMiaoMode ? 'Dant Lol Mok' : 'ÂçïËØ≠Ê®°Âºè');
            }
        });

        // ËÆ°ÁÆóBMIÂíåÂàÜÁ±ª
        function calculateBMI() {
            const height = parseFloat(document.getElementById('height').value);
            const weight = parseFloat(document.getElementById('weight').value);
            const bmiField = document.getElementById('bmi');
            const bmiCategory = document.getElementById('bmi-category');
            
            if (height && weight && height > 0 && weight > 0) {
                // ËÆ°ÁÆóBMI: ‰ΩìÈáç(kg) / Ë∫´È´ò(m)¬≤
                const heightInMeter = height / 100;
                const bmiValue = (weight / (heightInMeter * heightInMeter)).toFixed(1);
                
                // ÊòæÁ§∫BMIÂÄº
                bmiField.value = bmiValue;
                
                // Á°ÆÂÆöBMIÂàÜÁ±ªÂπ∂ÊòæÁ§∫
                let category = "";
                let color = "";
                
                if (bmiValue < 18.5) {
                    category = isMiaoMode ? "Piant Sout" : "ÂÅèÁò¶";
                    color = "#4285f4"; // ËìùËâ≤
                } else if (bmiValue < 25) {
                    category = isMiaoMode ? "Zhengb Changk" : "Ê≠£Â∏∏";
                    color = "#34a853"; // ÁªøËâ≤
                } else if (bmiValue < 30) {
                    category = isMiaoMode ? "Chaot Zhongb" : "Ë∂ÖÈáç";
                    color = "#fbbc05"; // ÈªÑËâ≤
                } else if (bmiValue < 35) {
                    category = isMiaoMode ? "Feib Pangb" : "ËÇ•ËÉñ";
                    color = "#ea4335"; // Á∫¢Ëâ≤
                } else {
                    category = isMiaoMode ? "Zhongb Feib" : "ÈáçÂ∫¶ËÇ•ËÉñ";
                    color = "#a50e0e"; // Ê∑±Á∫¢Ëâ≤
                }
                
                bmiCategory.textContent = category;
                bmiCategory.style.color = color;
            } else {
                // Ê∏ÖÁ©∫ÁªìÊûú
                bmiField.value = "";
                bmiCategory.textContent = "";
            }
        }

        // Ê∑ªÂä†ÊâìÂç∞Êä•ÂëäÂäüËÉΩ
        function printReport() {
            window.print();
        }

        // Ê∑ªÂä†‰øùÂ≠òÊä•ÂëäÂäüËÉΩ
        function saveReport() {
            const reportContent = document.querySelector('.report-content').innerHTML;
            const patientName = document.querySelector('#reportContainer h2').textContent.replace(/ÁöÑÂÅ•Â∫∑Êä•Âëä|Jiank Kangt Baot/g, '');
            const dateStr = new Date().toLocaleDateString().replace(/\//g, '-');
            
            // ÂàõÂª∫‰∏Ä‰∏™‰∏¥Êó∂ÈìæÊé•Áî®‰∫é‰∏ãËΩΩ
            const a = document.createElement('a');
            const blob = new Blob([`
            <!DOCTYPE html>
            <html>
            <head>
                <meta charset="UTF-8">
                <title>${patientName}ÁöÑÂÅ•Â∫∑Êä•Âëä - ${dateStr}</title>
                <style>
                    body {
                        font-family: "Microsoft YaHei", "ÂæÆËΩØÈõÖÈªë", sans-serif;
                        margin: 40px;
                        line-height: 1.6;
                        color: #333;
                    }
                    h1, h2, h3 {
                        color: #1a73e8;
                    }
                    .report-content {
                        background: #fff;
                        padding: 20px;
                        border-radius: 8px;
                    }
                    ul, ol {
                        padding-left: 25px;
                    }
                    .ethnic-medicine-advice {
                        background: #f0f8f0;
                        padding: 15px;
                        border-left: 4px solid #34a853;
            margin: 20px 0;
            border-radius: 6px;
                    }
                </style>
            </head>
            <body>
                <h1>${patientName}ÁöÑÂÅ•Â∫∑Êä•Âëä</h1>
                <p>ÁîüÊàêÊó•ÊúüÔºö${dateStr}</p>
                <div class="report-content">
                    ${reportContent}
                </div>
            </body>
            </html>
            `], {type: 'text/html'});
            
            a.href = URL.createObjectURL(blob);
            a.download = `${patientName}ÂÅ•Â∫∑Êä•Âëä-${dateStr}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }
    </script>

    <!-- Ê∑ªÂä†Áõ∏ÂÖ≥CSSÊ†∑Âºè -->
    <style>
        /* ‰∏∫ÂèØÁºñËæëÂå∫ÂüüÊ∑ªÂä†Ê†∑Âºè */
        .report-content[contenteditable="true"] {
            border: 1px solid transparent;
            transition: all 0.3s ease;
            outline: none;
            padding: 5px;
        }
        
        .report-content[contenteditable="true"]:hover {
            border-color: #dadce0;
            background-color: #f8f9fa;
        }
        
        .report-content[contenteditable="true"]:focus {
            border-color: #4285f4;
            background-color: #fff;
            box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.2);
        }
        
        /* Ê∑ªÂä†Êä•ÂëäÊéßÂà∂ÊåâÈíÆÊ†∑Âºè */
        .report-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
        }
        
        .control-btn {
            background: #f8f9fa;
            color: #1a73e8;
            border: 1px solid #dadce0;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .control-btn:hover {
            background: #e8f0fe;
            border-color: #4285f4;
        }
        
        /* ÊâìÂç∞Ê†∑Âºè‰ºòÂåñ */
        @media print {
            body {
                margin: 0;
                padding: 0;
                background: white;
            }
            
            .top-toolbar, .report-controls, .language-indicator {
                display: none !important;
            }
            
            .report-section {
                box-shadow: none !important;
                border: none !important;
                padding: 0 !important;
            }
            
            .report-content {
                font-size: 12pt !important;
            }
            
            .report-content h2 {
                font-size: 16pt !important;
            }
            
            .report-content h3 {
                font-size: 14pt !important;
            }
        }
    </style>
</body>
</html>
