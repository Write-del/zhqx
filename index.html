<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½å¥åº·é—®è¯Šç³»ç»Ÿ</title>
    <style>
        /* åŸºç¡€æ ·å¼ - åŒ»ç–—ä¸»é¢˜ */
        :root {
            --primary: #1a73e8;
            --secondary: #34a853;
            --accent: #4285f4;
            --warning: #ea4335;
            --gray-light: #f8f9fa;
            --gray-mid: #dadce0;
            --gray-dark: #5f6368;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f0f4f8;
            color: #333;
            line-height: 1.6;
        }
    
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        /* åŒ»ç–—ä¸»é¢˜æ ‡é¢˜ */
        h1 {
            color: var(--primary);
            text-align: center;
            font-size: 24px;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--gray-mid);
            position: relative;
        }
        
        h1:before {
            content: "ğŸ¥";
            margin-right: 10px;
        }
    
        /* è¡¨å•æ ·å¼ä¼˜åŒ– */
        fieldset {
            border: none;
            border-radius: 8px;
            padding: 20px;
            margin: 25px 0;
            background: var(--gray-light);
            position: relative;
        }
    
        legend {
            font-weight: bold;
            padding: 0 15px;
            background: var(--primary);
            color: white;
            border-radius: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: absolute;
            top: -15px;
            left: 20px;
        }
    
        .form-row {
            margin: 20px 0;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
    
        label {
            min-width: 120px;
            font-weight: 500;
            color: var(--gray-dark);
        }
    
        input, select, textarea {
            padding: 10px 12px;
            border: 1px solid var(--gray-mid);
            border-radius: 6px;
            flex: 1;
            transition: all 0.3s ease;
            font-size: 15px;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.2);
            outline: none;
        }
        
        input[type="radio"], input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--primary);
        }
    
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 15px;
            margin: 20px 0 10px;
            width: 100%;
        }
    
        .checkbox-item {
            background-color: white;
            border: 1px solid var(--gray-mid);
            border-radius: 8px;
            padding: 10px 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .checkbox-item:hover {
            border-color: var(--accent);
            box-shadow: 0 2px 8px rgba(66, 133, 244, 0.2);
        }
        
        .checkbox-item input:checked + span {
            font-weight: 500;
            color: var(--primary);
        }
    
        button {
            background: var(--primary);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            margin: 30px auto;
            display: block;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(26, 115, 232, 0.3);
        }
        
        button:hover {
            background: #0d62d0;
            box-shadow: 0 4px 12px rgba(26, 115, 232, 0.4);
            transform: translateY(-2px);
        }
    
        /* æŠ¥å‘Šæ ·å¼ä¼˜åŒ– */
        .report-section {
            background: #fff;
            padding: 25px;
            margin: 25px 0;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border-left: 4px solid var(--primary);
        }
    
        .warning {
            color: var(--warning);
            font-weight: bold;
            padding: 10px 15px;
            border-radius: 6px;
            background: #ffebee;
            margin: 15px 0;
        }
    
        .miao-advice {
            background: #e8f5e9;
            border-left: 4px solid var(--secondary);
            padding: 15px;
            margin: 15px 0;
            border-radius: 6px;
        }
    
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: var(--gray-dark);
        }
        
        .loading:after {
            content: "...";
            animation: dots 1.5s steps(5, end) infinite;
        }
        
        @keyframes dots {
            0%, 20% { content: "."; }
            40% { content: ".."; }
            60%, 100% { content: "..."; }
        }
        
        .male-item {
            display: inline-flex;
            align-items: center;
            background-color: white;
            border: 1px solid var(--gray-mid);
            border-radius: 8px;
            padding: 10px 20px;
            margin-right: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .male-item:hover {
            border-color: var(--accent);
        }
        
        /* æŒ‡æ ‡æç¤º */
        .indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 5px 0;
        }
        
        .indicator-normal {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .indicator-warning {
            background: #fff3e0;
            color: #e65100;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        /* è¡€å‹è¾“å…¥æ¡†ä¼˜åŒ– */
        .bp-inputs {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .bp-inputs input {
            max-width: 80px;
        }
        
        .bp-divider {
            font-weight: bold;
            color: var(--gray-dark);
        }
        
        .bp-unit {
            color: var(--gray-dark);
            white-space: nowrap;
        }
        
        /* å¹¶å‘ç—‡åŒºåŸŸä¼˜åŒ– */
        .complication-group h4 {
            margin: 20px 0 10px;
            color: var(--primary);
            font-size: 16px;
        }
        
        .complication-group h4:before {
            content: "âš•ï¸";
            margin-right: 8px;
        }
    
        /* Markdownæ ·å¼ä¼˜åŒ– */
        .report-content {
            line-height: 1.8;
        }
        
        .report-content h2 {
            color: var(--primary);
            border-bottom: 2px solid #e6f2ff;
            padding-bottom: 8px;
            margin-top: 30px;
            margin-bottom: 20px;
            font-size: 22px;
        }
        
        .report-content h3 {
            color: var(--accent);
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .report-content ul, .report-content ol {
            padding-left: 25px;
            margin: 15px 0;
        }
        
        .report-content li {
            margin-bottom: 8px;
            position: relative;
        }
        
        .report-content strong {
            color: #1a73e8;
        }
        
        /* æŠ¥å‘Šé¡µé¢æ ‡é¢˜ */
        #reportContainer h2 {
            text-align: center;
            color: var(--primary);
            margin: 20px 0 30px;
            font-size: 24px;
        }
        
        /* è¡¨å•åˆ†ç»„æ ‡é¢˜ */
        .section-title {
            font-weight: 500;
            color: var(--gray-dark);
            margin-bottom: 5px;
        }
        
        /* åŒ»ç–—å›¾æ ‡ */
        .medical-icon {
            font-size: 20px;
            margin-right: 8px;
            vertical-align: middle;
        }
        /* æ·»åŠ åˆ—è¡¨æ ·å¼ */
        .report-content ol {
            list-style-type: decimal;
            padding-left: 30px;
        }
    
        .report-content ul {
            list-style-type: disc;
            padding-left: 30px;
        }
    
        .numbered-list {
            counter-reset: item;
        }
    
        .numbered-list li {
            counter-increment: item;
        }
    
        .numbered-list li::before {
            content: counter(item) ". ";
            margin-right: 5px;
            color: var(--primary);
        }
    
    </style>
</head>
<body>

    <div class="container" id="mainContainer">
        <!-- é—®è¯Šè¡¨å• -->
        <form id="healthForm">
            <h1>é«˜è¡€å‹ç³–å°¿ç—…æ™ºèƒ½é—®è¯Šç³»ç»Ÿ</h1>

            <!-- åŸºæœ¬ä¿¡æ¯ -->
            <fieldset>
                <legend>åŸºæœ¬ä¿¡æ¯</legend>
                <div class="form-row">
                    <label for="name">å§“åï¼š</label>
                    <input type="text" id="name" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å" required>
                </div>
                <div class="form-row">
                    <label>æ€§åˆ«ï¼š</label>
                    <div style="display: flex; gap: 20px;">
                        <label class="male-item">
                            <input type="radio" id="male" name="gender" value="ç”·" required>
                            <span>ç”·</span>
                        </label>
                        <label class="male-item">
                            <input type="radio" name="gender" id="female" value="å¥³">
                            <span>å¥³</span>
                        </label>
                    </div>
                </div>
                <div class="form-row">
                    <label for="age">å¹´é¾„ï¼š</label>
                    <input type="number" id="age" min="18" max="120" placeholder="è¯·è¾“å…¥æ‚¨çš„å¹´é¾„" required>
                </div>
                <div class="form-row">
                    <label for="ethnicity">æ°‘æ—ï¼š</label>
                    <select id="ethnicity" required>
                        <option value="" disabled selected>è¯·é€‰æ‹©æ‚¨çš„æ°‘æ—</option>
                        <option value="æ±‰æ—">æ±‰æ—</option>
                        <option value="è‹—æ—">è‹—æ—</option>
                        <option value="ä¾—æ—">ä¾—æ—</option>
                    </select>
                </div>
                <div class="form-row">
                    <label for="contact">è”ç³»æ–¹å¼ï¼š</label>
                    <input type="tel" id="contact" placeholder="è¯·è¾“å…¥æ‚¨çš„è”ç³»ç”µè¯" required>
                </div>
                <div class="form-row">
                    <label for="address">å±…ä½åœ°ï¼š</label>
                    <input type="text" id="address" placeholder="è¯·è¾“å…¥æ‚¨çš„å±…ä½åœ°å€" required>
                </div>
            </fieldset>
    
            <!-- è¡€å‹å€¼ -->
            <fieldset>
                <legend>è¡€å‹æµ‹é‡</legend>
                <div class="form-row">
                    <label>è¡€å‹å€¼ï¼š</label>
                    <div class="bp-inputs">
                        <input type="number" id="systolic" placeholder="æ”¶ç¼©å‹" required>
                        <span class="bp-divider">/</span>
                        <input type="number" id="diastolic" placeholder="èˆ’å¼ å‹" required>
                        <span class="bp-unit">mmHg</span>
                    </div>
                </div>
                <div class="indicator">
                    <span class="indicator-normal">æ­£å¸¸èŒƒå›´: â‰¤ 120/80 mmHg</span>
                    <span class="indicator-warning">é«˜è¡€å‹: â‰¥ 140/90 mmHg</span>
                </div>
            </fieldset>
    
            <!-- è¡€ç³–å€¼ -->
            <fieldset>
                <legend>è¡€ç³–ç›‘æµ‹</legend>
                <div class="form-row">
                    <label>ç©ºè…¹è¡€ç³–ï¼š</label>
                    <div style="display: flex; align-items: center;">
                        <input type="number" id="blood-sugar-fasting" step="0.1" placeholder="è¯·è¾“å…¥ç©ºè…¹è¡€ç³–å€¼" required>
                        <span class="bp-unit">mmol/L</span>
                    </div>
                </div>
                <div class="indicator">
                    <span class="indicator-normal">æ­£å¸¸èŒƒå›´: 3.9-6.1 mmol/L</span>
                </div>
                <div class="form-row">
                    <label>é¤åè¡€ç³–ï¼š</label>
                    <div style="display: flex; align-items: center;">
                        <input type="number" id="blood-sugar-dinner" step="0.1" placeholder="è¯·è¾“å…¥é¤å2å°æ—¶è¡€ç³–å€¼" required>
                        <span class="bp-unit">mmol/L</span>
                    </div>
                </div>
                <div class="indicator">
                    <span class="indicator-normal">æ­£å¸¸èŒƒå›´: â‰¤ 7.8 mmol/L</span>
                </div>
            </fieldset>
    
            <!-- ç—‡çŠ¶ -->
            <fieldset>
                <legend>èº«ä½“ä¸é€‚ç—‡çŠ¶</legend>
                <div class="section-title">è¯·é€‰æ‹©æ‚¨ç›®å‰å­˜åœ¨çš„ä¸é€‚ç—‡çŠ¶ï¼š</div>
                <div class="checkbox-group">
                    <label class="checkbox-item">
                        <input type="checkbox" name="symptoms" value="å¤´æ™•">
                        <span>å¤´æ™•</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="symptoms" value="ä¹åŠ›">
                        <span>ä¹åŠ›</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="symptoms" value="èƒ¸ç—›">
                        <span>èƒ¸ç—›</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="symptoms" value="çœ¼èŠ±">
                        <span>çœ¼èŠ±</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="symptoms" value="å£æ¸´">
                        <span>å£æ¸´</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="symptoms" value="å¤šå°¿">
                        <span>å¤šå°¿</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="symptoms" value="å¿ƒæ‚¸">
                        <span>å¿ƒæ‚¸</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="symptoms" value="å‘¼å¸å›°éš¾">
                        <span>å‘¼å¸å›°éš¾</span>
                    </label>
                </div>
            </fieldset>
    
            <!-- å¹¶å‘ç—‡ -->
            <fieldset>
                <legend>å¹¶å‘ç—‡è¯„ä¼°</legend>
                <div class="complication-group">
                    <h4>é«˜è¡€å‹å¹¶å‘ç—‡</h4>
                    <div class="checkbox-group">
                        <label class="checkbox-item">
                            <input type="checkbox" name="hypertension-complications" value="å¿ƒè„ç—…">
                            <span>å¿ƒè„ç—…</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="hypertension-complications" value="ä¸­é£">
                            <span>ä¸­é£</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="hypertension-complications" value="è‚¾ç—…">
                            <span>è‚¾ç—…</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="hypertension-complications" value="è§†ç½‘è†œç—…å˜">
                            <span>è§†ç½‘è†œç—…å˜</span>
                        </label>
                    </div>
                </div>
    
                <div class="complication-group">
                    <h4>ç³–å°¿ç—…å¹¶å‘ç—‡</h4>
                    <div class="checkbox-group">
                        <label class="checkbox-item">
                            <input type="checkbox" name="diabetes-complications" value="ç¥ç»æŸä¼¤">
                            <span>ç¥ç»æŸä¼¤</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="diabetes-complications" value="è‚¾åŠŸèƒ½æŸä¼¤">
                            <span>è‚¾åŠŸèƒ½æŸä¼¤</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="diabetes-complications" value="å¿ƒè¡€ç®¡é—®é¢˜">
                            <span>å¿ƒè¡€ç®¡é—®é¢˜</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="diabetes-complications" value="ç³–å°¿ç—…è¶³">
                            <span>ç³–å°¿ç—…è¶³</span>
                        </label>
                    </div>
                </div>
            </fieldset>
    
            <!-- è¿‡æ•å² -->
            <fieldset>
                <legend>è¯ç‰©è¿‡æ•å²</legend>
                <div class="form-row">
                    <label>æ˜¯å¦æœ‰è¿‡æ•å²ï¼š</label>
                    <div style="display: flex; gap: 20px;">
                        <label class="male-item">
                            <input type="radio" name="allergy" value="æ˜¯" required>
                            <span>æ˜¯</span>
                        </label>
                        <label class="male-item">
                            <input type="radio" name="allergy" value="å¦">
                            <span>å¦</span>
                        </label>
                    </div>
                </div>
                <div class="form-row">
                    <label for="allergy-details">è¿‡æ•è¯¦æƒ…ï¼š</label>
                    <textarea id="allergy-details" rows="2" placeholder="è¯·è¯¦ç»†æè¿°æ‚¨çš„è¯ç‰©è¿‡æ•æƒ…å†µ"></textarea>
                </div>
            </fieldset>
    
            <button type="button" onclick="generateReport()">ç”Ÿæˆå¥åº·æŠ¥å‘Š</button>
            <div class="loading" id="loading">æ­£åœ¨ç”Ÿæˆä¸“ä¸šåŒ»ç–—æŠ¥å‘Š</div>
        </form>
    
        <!-- æŠ¥å‘Šæ˜¾ç¤ºåŒºåŸŸ -->
        <div id="reportContainer" style="display: none;"></div>
    </div>
    
    <script>
        const DEEPSEEK_API_KEY = 'sk-6cecc16e7c074089a36f153ec43f5b8a';
        const API_URL = 'https://api.deepseek.com/v1/chat/completions';
    
        async function generateReport() {
            try {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                document.getElementById('loading').style.display = 'block';
    
                // æ”¶é›†è¡¨å•æ•°æ®
                const formData = {
                    name: document.getElementById('name').value,
                    gender: document.querySelector('input[name="gender"]:checked')?.value || '',
                    age: document.getElementById('age').value,
                    ethnicity: document.getElementById('ethnicity').value,
                    systolic: document.getElementById('systolic').value,
                    diastolic: document.getElementById('diastolic').value,
                    bloodSugarFasting: document.getElementById('blood-sugar-fasting').value,
                    bloodSugarDinner: document.getElementById('blood-sugar-dinner').value,
                    symptoms: Array.from(document.querySelectorAll('[name="symptoms"]:checked')).map(c => c.value),
                    hypertensionComplications: Array.from(document.querySelectorAll('[name="hypertension-complications"]:checked')).map(c => c.value),
                    diabetesComplications: Array.from(document.querySelectorAll('[name="diabetes-complications"]:checked')).map(c => c.value),
                    allergy: document.querySelector('input[name="allergy"]:checked')?.value || 'å¦',
                    allergyDetails: document.getElementById('allergy-details').value
                };
    
                // åŸºæœ¬éªŒè¯
                if (!formData.name || !formData.age || !formData.systolic || !formData.diastolic) {
                    alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ');
                    document.getElementById('loading').style.display = 'none';
                    return;
                }
    
                // æ„å»ºæç¤ºè¯
                const prompt = `ä½œä¸ºä¸“ä¸šåŒ»ç”Ÿï¼Œè¯·æ ¹æ®ä»¥ä¸‹æ‚£è€…ä¿¡æ¯ç”Ÿæˆè¯¦ç»†å¥åº·æŠ¥å‘Šï¼š
æ‚£è€…ä¿¡æ¯ï¼š
- å§“åï¼š${formData.name}
- å¹´é¾„ï¼š${formData.age}å²
- æ€§åˆ«ï¼š${formData.gender}
- æ°‘æ—ï¼š${formData.ethnicity}
- è¡€å‹ï¼š${formData.systolic}/${formData.diastolic} mmHg
- è¡€ç³–ï¼šç©ºè…¹ ${formData.bloodSugarFasting} mmol/Lï¼Œé¤å ${formData.bloodSugarDinner} mmol/L
- ç—‡çŠ¶ï¼š${formData.symptoms.join(', ') || 'æ— '}
- å¹¶å‘ç—‡ï¼š
  * é«˜è¡€å‹ï¼š${formData.hypertensionComplications.join(', ') || 'æ— '}
  * ç³–å°¿ç—…ï¼š${formData.diabetesComplications.join(', ') || 'æ— '}
- è¿‡æ•å²ï¼š${formData.allergy === 'æ˜¯' ? formData.allergyDetails : 'æ— '}

è¯·ç”¨ä¸­æ–‡æŒ‰ä»¥ä¸‹ç»“æ„ç»„ç»‡æŠ¥å‘Šå†…å®¹ï¼Œä½¿ç”¨Markdownæ ¼å¼ï¼Œè¯·ä¸¥æ ¼ä½¿ç”¨ä»¥ä¸‹æ ¼å¼ï¼š
## é£é™©è¯„ä¼°
1. é«˜è¡€å‹é£é™©è¯„ä¼°...
    1.ç¬¬ä¸€æ¡å†…å®¹...
    2.ç¬¬äºŒæ¡å†…å®¹...
2. ç³–å°¿ç—…é£é™©è¯„ä¼°...
    1.ç¬¬ä¸€æ¡å†…å®¹...
    2.ç¬¬äºŒæ¡å†…å®¹...

## åŒ»ç–—å»ºè®®
### 1. è¥¿è¯æ²»ç–—æ–¹æ¡ˆ
1. ç¬¬ä¸€æ¡å»ºè®®...
2. ç¬¬äºŒæ¡å»ºè®®...

### 2. ä¸­è¯/æ°‘æ—åŒ»è¯å»ºè®®
1. ç¬¬ä¸€æ¡å»ºè®®...
2. ç¬¬äºŒæ¡å»ºè®®...

## ç”Ÿæ´»å»ºè®®
### 1. é¥®é£Ÿå»ºè®®
- ç¬¬ä¸€æ¡å»ºè®®...
- ç¬¬äºŒæ¡å»ºè®®...
### 2. è¿åŠ¨å»ºè®®
- ç¬¬ä¸€æ¡å»ºè®®...
- ç¬¬äºŒæ¡å»ºè®®..


## æ³¨æ„äº‹é¡¹
[ç‰¹æ®Šè­¦ç¤ºä¿¡æ¯]

${formData.ethnicity === 'è‹—æ—' ? 'è¯·é¢å¤–æä¾›é€‚åˆè‹—æ—æ‚£è€…çš„ä¼ ç»ŸåŒ»è¯å»ºè®®' : ''}`;

                // è°ƒç”¨API
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${DEEPSEEK_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: "deepseek-chat",
                        messages: [{ role: "user", content: prompt }],
                        temperature: 0.3
                    })
                });
    
                const data = await response.json();
                const reportContent = data.choices[0].message.content;
    
                // ç”ŸæˆæŠ¥å‘Šé¡µé¢
                showReport(formData, reportContent);
    
            } catch (error) {
                alert(`æŠ¥å‘Šç”Ÿæˆå¤±è´¥: ${error.message}`);
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }
    
        // æ›´æ–°æ˜¾ç¤ºæŠ¥å‘Šçš„ä¸»å‡½æ•°
function showReport(formData, reportContent) {
    // ç§»é™¤å¯èƒ½å‡ºç°çš„markdownå‰ç¼€å’Œæ ‡è®°
    let cleanedReportContent = reportContent.replace(/^markdown\s*/i, '').replace(/\bmarkdown\b/gi, '');
    
    // å°†Markdownè½¬æ¢ä¸ºHTML
    const htmlContent = parseMarkdown(cleanedReportContent);
    
    // æ›´æ–°DOMæ˜¾ç¤ºæŠ¥å‘Š
    document.getElementById('healthForm').style.display = 'none';
    document.getElementById('reportContainer').innerHTML = `
        <h2>${formData.name}çš„å¥åº·æŠ¥å‘Š</h2>
        <div class="report-section">
            <div class="report-content">${htmlContent}</div>
        </div>
        <button onclick="location.reload()">è¿”å›é—®è¯Šè¡¨å•</button>
    `;
    document.getElementById('reportContainer').style.display = 'block';
    
    // åº”ç”¨ä¼˜åŒ–æ ·å¼
    optimizeReportContainer();
}

// Markdownè§£æä¸»å‡½æ•°
function parseMarkdown(markdown) {
    // å¤„ç†æ ‡é¢˜
    let html = markdown
        .replace(/^# (.*$)/gm, '<h1>$1</h1>')
        .replace(/^## (.*$)/gm, '<h2>$1</h2>')
        .replace(/^### (.*$)/gm, '<h3>$1</h3>')
        .replace(/^#### (.*$)/gm, '<h4>$1</h4>');
    
    // å¤„ç†åˆ—è¡¨ - ä½¿ç”¨æ–°çš„ç®€åŒ–æ–¹æ³•
    html = processLists(html);
    
    // å¤„ç†ç²—ä½“å’Œæ–œä½“
    html = html
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.*?)\*/g, '<em>$1</em>')
        .replace(/_([^_]+)_/g, '<em>$1</em>');
    
    // å¤„ç†ä»£ç 
    html = html
        .replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>')
        .replace(/`([^`]+)`/g, '<code>$1</code>');
    
    // å¤„ç†é“¾æ¥å’Œå›¾ç‰‡
    html = html
        .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2">$1</a>')
        .replace(/!\[([^\]]+)\]\(([^)]+)\)/g, '<img src="$2" alt="$1">');
    
    // å¤„ç†å¼•ç”¨å’Œæ°´å¹³çº¿
    html = html
        .replace(/^> (.*$)/gm, '<blockquote>$1</blockquote>')
        .replace(/^\-\-\-$/gm, '<hr>');
    
    // å¤„ç†æ®µè½
    html = processParagraphs(html);
    
    return html;
}
function addBulletListStyle() {
    const styleElement = document.createElement('style');
    styleElement.textContent = `
        .bullet-list {
            list-style-type: disc; /* ä½¿ç”¨å®å¿ƒåœ†ç‚¹ */
            padding-left: 30px;
            margin: 15px 0;
        }
        
        .bullet-list li {
            margin-bottom: 8px;
            position: relative;
        }
        
        /* ç§»é™¤æ—§çš„ç¼–å·æ ·å¼ */
        .numbered-list {
            list-style-type: disc !important; /* å¼ºåˆ¶ä½¿ç”¨å®å¿ƒåœ†ç‚¹ */
        }
        
        .numbered-list li::before {
            content: none !important; /* ç§»é™¤è‡ªå®šä¹‰ç¼–å· */
        }
    `;
    document.head.appendChild(styleElement);
}

// å¤„ç†æ®µè½
function processParagraphs(html) {
    // æŒ‰æ¢è¡Œç¬¦åˆ†å‰²
    const lines = html.split('\n');
    let processedHtml = '';
    let inParagraph = false;
    
    for (let i = 0; i < lines.length; i++) {
        const line = lines[i].trim();
        
        // è·³è¿‡å·²ç»æ˜¯HTMLæ ‡ç­¾çš„è¡Œ
        if (!line || 
            line.startsWith('<h') || 
            line.startsWith('<ul') || 
            line.startsWith('<ol') || 
            line.startsWith('<li') || 
            line.startsWith('<pre') || 
            line.startsWith('<blockquote') ||
            line.startsWith('<hr') ||
            line.startsWith('</')) {
            
            if (inParagraph) {
                processedHtml += '</p>\n';
                inParagraph = false;
            }
            
            processedHtml += line + '\n';
            continue;
        }
        
        // å¼€å§‹æ–°æ®µè½
        if (!inParagraph) {
            processedHtml += '<p>' + line;
            inParagraph = true;
        } else {
            // ç»§ç»­å½“å‰æ®µè½
            processedHtml += '<br>' + line;
        }
        
        // å¦‚æœä¸‹ä¸€è¡Œæ˜¯ç©ºè¡Œæˆ–è€…æ˜¯HTMLæ ‡ç­¾ï¼Œç»“æŸå½“å‰æ®µè½
        if (i === lines.length - 1 || 
            !lines[i + 1].trim() || 
            lines[i + 1].trim().startsWith('<')) {
            
            if (inParagraph) {
                processedHtml += '</p>\n';
                inParagraph = false;
            }
        }
    }
    
    // ç¡®ä¿æ‰€æœ‰æ®µè½éƒ½æ­£ç¡®å…³é—­
    if (inParagraph) {
        processedHtml += '</p>\n';
    }
    
    return processedHtml;
}

// å®Œå…¨é‡å†™åˆ—è¡¨å¤„ç†å‡½æ•°ï¼Œå°†æ‰€æœ‰æœ‰åºåˆ—è¡¨è½¬æ¢ä¸ºæ— åºåˆ—è¡¨ï¼ˆé¡¹ç›®ç¬¦å·ï¼‰
function processLists(text) {
    // 1. å…ˆç§»é™¤æ‰€æœ‰ç±»å‹çš„åˆ—è¡¨æ ‡è®°ï¼ŒåŒ…æ‹¬ç¼–å·å’Œç¬¦å·
    let cleanedText = text;
    
    // ç§»é™¤é‡å¤çš„ç¼–å·ï¼ˆå¦‚"1. 1."ï¼‰
    cleanedText = cleanedText.replace(/^(\s*)(\d+)\.\s*(\d+)\.\s+(.*?)$/gm, function(match, space, num1, num2, content) {
        return `${space}BULLET_MARKER ${content}`;
    });
    
    // ç§»é™¤å•ä¸ªç¼–å·ï¼ˆå¦‚"1."ï¼‰
    cleanedText = cleanedText.replace(/^(\s*)(\d+)\.\s+(.*?)$/gm, function(match, space, num, content) {
        return `${space}BULLET_MARKER ${content}`;
    });
    
    // ç§»é™¤æ— åºåˆ—è¡¨ç¬¦å·ï¼ˆå¦‚"- "ã€"* "ã€"+ "ï¼‰
    cleanedText = cleanedText.replace(/^(\s*)[-*+]\s+(.*?)$/gm, function(match, space, content) {
        return `${space}BULLET_MARKER ${content}`;
    });
    
    // 2. è¯†åˆ«åˆ—è¡¨åŒºåŸŸå¹¶è½¬æ¢ä¸ºæ— åºåˆ—è¡¨
    const lines = cleanedText.split('\n');
    let result = '';
    let inList = false;
    let listItems = [];
    
    for (let i = 0; i < lines.length; i++) {
        const line = lines[i];
        // æŸ¥æ‰¾æˆ‘ä»¬æ ‡è®°çš„åˆ—è¡¨é¡¹
        const listItemMatch = line.match(/^(\s*)BULLET_MARKER\s+(.*)/);
        
        if (listItemMatch) {
            // æ‰¾åˆ°åˆ—è¡¨é¡¹
            if (!inList) {
                // å¼€å§‹ä¸€ä¸ªæ–°åˆ—è¡¨
                inList = true;
                listItems = [];
            }
            
            // æ·»åŠ åˆ—è¡¨é¡¹å†…å®¹
            listItems.push(listItemMatch[2]);
        } else if (inList && (line.trim() === '' || !line.includes('BULLET_MARKER'))) {
            // åˆ—è¡¨ç»“æŸ
            result += generateBulletListHtml(listItems);
            inList = false;
            listItems = [];
            if (line.trim() !== '') {
                result += line;
            }
            result += '\n';
        } else {
            // éåˆ—è¡¨å†…å®¹
            result += line + '\n';
        }
    }
    
    // å¤„ç†æ–‡æ¡£ç»“æŸæ—¶çš„åˆ—è¡¨
    if (inList) {
        result += generateBulletListHtml(listItems);
    }
    
    return result;
}
// ç”Ÿæˆé¡¹ç›®ç¬¦å·åˆ—è¡¨HTML
function generateBulletListHtml(items) {
    if (items.length === 0) return '';
    
    let html = '<ul class="bullet-list">\n';
    for (let item of items) {
        html += `  <li>${item}</li>\n`;
    }
    html += '</ul>\n';
    return html;
}
// å¤„ç†æœ‰åºåˆ—è¡¨ - ä¿®å¤é‡å¤ç¼–å·é—®é¢˜
function processOrderedLists(text) {
    // 1. å…ˆç§»é™¤è¡Œé¦–çš„æ•°å­—ç¼–å·ï¼Œä¿ç•™å†…å®¹
    let cleanedText = text.replace(/^(\s*)(\d+)\.\s*(\d+)\.\s+(.*?)$/gm, function(match, space, num1, num2, content) {
        // åªä¿ç•™å†…å®¹ï¼Œåˆ é™¤æ‰€æœ‰ç¼–å·
        return `${space}LIST_ITEM_MARKER ${content}`;
    });

    // 2. å¯¹äºåªæœ‰ä¸€ä¸ªç¼–å·çš„è¡Œä¹Ÿè¿›è¡Œå¤„ç†
    cleanedText = cleanedText.replace(/^(\s*)(\d+)\.\s+(.*?)$/gm, function(match, space, num, content) {
        return `${space}LIST_ITEM_MARKER ${content}`;
    });

    // 3. è¯†åˆ«åˆ—è¡¨åŒºåŸŸ
    const lines = cleanedText.split('\n');
    let result = '';
    let inList = false;
    let listItems = [];
    
    for (let i = 0; i < lines.length; i++) {
        const line = lines[i];
        // æŸ¥æ‰¾æˆ‘ä»¬æ ‡è®°çš„åˆ—è¡¨é¡¹
        const listItemMatch = line.match(/^(\s*)LIST_ITEM_MARKER\s+(.*)/);
        
        if (listItemMatch) {
            // æ‰¾åˆ°åˆ—è¡¨é¡¹
            if (!inList) {
                // å¼€å§‹ä¸€ä¸ªæ–°åˆ—è¡¨
                inList = true;
                listItems = [];
            }
            
            // æ·»åŠ åˆ—è¡¨é¡¹å†…å®¹
            listItems.push(listItemMatch[2]);
        } else if (inList && line.trim() === '') {
            // ç©ºè¡Œç»“æŸåˆ—è¡¨
            result += generateOrderedListHtml(listItems);
            inList = false;
            listItems = [];
            result += '\n';
        } else if (inList) {
            // å…¶ä»–å†…å®¹ç»“æŸåˆ—è¡¨
            result += generateOrderedListHtml(listItems);
            inList = false;
            listItems = [];
            result += line + '\n';
        } else {
            // éåˆ—è¡¨å†…å®¹
            result += line + '\n';
        }
    }
    
    // å¤„ç†æ–‡æ¡£ç»“æŸæ—¶çš„åˆ—è¡¨
    if (inList) {
        result += generateOrderedListHtml(listItems);
    }
    
    return result;
}

// ç”Ÿæˆæœ‰åºåˆ—è¡¨HTML
function generateOrderedListHtml(items) {
    if (items.length === 0) return '';
    
    let html = '<ol class="numbered-list">\n';
    for (let item of items) {
        html += `  <li>${item}</li>\n`;
    }
    html += '</ol>\n';
    return html;
}

// å¤„ç†æ— åºåˆ—è¡¨
function processUnorderedLists(text) {
    const lines = text.split('\n');
    let result = '';
    let inList = false;
    let listItems = [];
    
    for (let i = 0; i < lines.length; i++) {
        const line = lines[i];
        const listMatch = line.match(/^(\s*)[-*+]\s+(.*)/);
        
        if (listMatch) {
            // æ‰¾åˆ°æ— åºåˆ—è¡¨é¡¹
            if (!inList) {
                inList = true;
                listItems = [];
            }
            
            // ä¿å­˜åˆ—è¡¨é¡¹
            const indent = listMatch[1].length;
            const content = listMatch[2];
            listItems.push({ indent, content });
        } else if (inList && (line.trim() === '' || !line.match(/^(\s*)[-*+]\s+(.*)/))) {
            // åˆ—è¡¨ç»“æŸ
            result += generateUnorderedListHtml(listItems);
            inList = false;
            listItems = [];
            result += line + '\n';
        } else {
            // éåˆ—è¡¨å†…å®¹
            result += line + '\n';
        }
    }
    
    // å¤„ç†æ–‡æ¡£ç»“æŸæ—¶çš„åˆ—è¡¨
    if (inList) {
        result += generateUnorderedListHtml(listItems);
    }
    
    return result;
}

// ç”Ÿæˆæ— åºåˆ—è¡¨HTML
function generateUnorderedListHtml(items) {
    if (items.length === 0) return '';
    
    let html = '<ul class="bulleted-list">\n';
    
    for (let item of items) {
        html += `  <li>${item.content}</li>\n`;
    }
    
    html += '</ul>\n';
    return html;
}
// æ·»åŠ å¢å¼ºçš„æŠ¥å‘Šæ ·å¼
function addEnhancedReportStyle() {
    const styleElement = document.createElement('style');
    styleElement.textContent = `
        .report-content {
            font-family: "Microsoft YaHei", "å¾®è½¯é›…é»‘", sans-serif;
            font-size: 16px;
            line-height: 1.8;
            color: #333;
        }
        
        .report-content h2 {
            font-size: 24px;
            color: #1a73e8;
            border-bottom: 2px solid #e6f2ff;
            padding-bottom: 12px;
            margin-top: 35px;
            margin-bottom: 25px;
            position: relative;
        }
        
        .report-content h2::before {
            content: "ğŸ“Š";
            margin-right: 10px;
            font-size: 24px;
        }
        
        .report-content h3 {
            font-size: 20px;
            color: #4285f4;
            margin-top: 30px;
            margin-bottom: 18px;
            position: relative;
        }
        
        .report-content h3::before {
            content: "ğŸ“‹";
            margin-right: 10px;
            font-size: 20px;
        } 
        /* é£é™©è¯„ä¼°é¡¹ç›®ä½¿ç”¨çº¢è‰²è­¦ç¤ºå›¾æ ‡ */
        .report-content h2:contains("é£é™©è¯„ä¼°") + .bullet-list li::before {
            content: "âš ï¸";
            color: #ea4335;
        }
        
        /* åŒ»ç–—å»ºè®®é¡¹ç›®ä½¿ç”¨è¯ä¸¸å›¾æ ‡ */
        .report-content h2:contains("åŒ»ç–—å»ºè®®") + .bullet-list li::before,
        .report-content h3:contains("è¥¿è¯æ²»ç–—") + .bullet-list li::before {
            content: "ğŸ’Š";
        }
        
        /* ä¸­è¯å»ºè®®é¡¹ç›®ä½¿ç”¨è‰è¯å›¾æ ‡ */
        .report-content h3:contains("ä¸­è¯") + .bullet-list li::before {
            content: "ğŸŒ¿";
        }
        
        /* ç”Ÿæ´»å»ºè®®é¡¹ç›®ä½¿ç”¨ç¯æ³¡å›¾æ ‡ */
        .report-content h2:contains("ç”Ÿæ´»å»ºè®®") + .bullet-list li::before {
            content: "ğŸ’¡";
        }
        
        /* é¥®é£Ÿå»ºè®®é¡¹ç›®ä½¿ç”¨é£Ÿç‰©å›¾æ ‡ */
        .report-content h3:contains("é¥®é£Ÿå»ºè®®") + .bullet-list li::before {
            content: "ğŸ";
        }
        
        /* è¿åŠ¨å»ºè®®é¡¹ç›®ä½¿ç”¨è¿åŠ¨å›¾æ ‡ */
        .report-content h3:contains("è¿åŠ¨å»ºè®®") + .bullet-list li::before {
            content: "ğŸƒ";
        }
        
        /* æ³¨æ„äº‹é¡¹ä½¿ç”¨è­¦å‘Šå›¾æ ‡ */
        .report-content h2:contains("æ³¨æ„äº‹é¡¹") + p {
            background-color: #fff8e1;
            border-left: 4px solid #ffa000;
            padding: 15px;
            margin: 20px 0;
            border-radius: 6px;
            font-size: 16px;
            position: relative;
            padding-left: 40px;
        }
        
        .report-content h2:contains("æ³¨æ„äº‹é¡¹") + p::before {
            content: "âš ï¸";
            position: absolute;
            left: 10px;
            font-size: 20px;
        }
        
        .report-content strong {
            color: #1a73e8;
            font-weight: 600;
        }
        
        /* æŠ¥å‘Šæ ‡é¢˜æ ·å¼å¢å¼º */
        #reportContainer h2 {
            text-align: center;
            color: #1a73e8;
            margin: 20px 0 30px;
            font-size: 28px;
            font-family: "Microsoft YaHei", "å¾®è½¯é›…é»‘", sans-serif;
            font-weight: 600;
            position: relative;
            padding-bottom: 15px;
        }
        
        #reportContainer h2::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 3px;
            background: linear-gradient(to right, #1a73e8, #34a853);
            border-radius: 3px;
        }
        
        /* æŠ¥å‘Šå®¹å™¨å¢å¼º */
        .report-section {
            background: #fff;
            padding: 30px;
            margin: 30px 0;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border-left: 5px solid #1a73e8;
        }
        
        /* è¿”å›æŒ‰é’®å¢å¼º */
        #reportContainer button {
            background: #1a73e8;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            margin: 30px auto;
            display: block;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(26, 115, 232, 0.3);
            font-family: "Microsoft YaHei", "å¾®è½¯é›…é»‘", sans-serif;
        }
        
        #reportContainer button:hover {
            background: #0d62d0;
            box-shadow: 0 4px 12px rgba(26, 115, 232, 0.4);
            transform: translateY(-2px);
        }
    `;
    document.head.appendChild(styleElement);
}
function optimizeReportContainer() {
    const styleElement = document.createElement('style');
    styleElement.textContent = `
        /* æ‰©å¤§å®¹å™¨å®½åº¦ */
        .container {
            max-width: 1200px !important;
            padding: 30px !important;
            margin: 0 auto !important;
        }
        
        /* ä¼˜åŒ–æŠ¥å‘ŠåŒºåŸŸ */
        .report-section {
            background: #fff;
            padding: 40px;
            margin: 30px 0;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border-left: 5px solid #1a73e8;
            overflow-wrap: break-word;
            word-wrap: break-word;
            width: auto;
            max-width: 100%;
        }
        
        /* ä¼˜åŒ–æŠ¥å‘Šå†…å®¹ */
        .report-content {
            font-family: "Microsoft YaHei", "å¾®è½¯é›…é»‘", sans-serif;
            font-size: 16px;
            line-height: 1.8;
            color: #333;
        }
        
        /* æ ‡é¢˜æ ·å¼ */
        .report-content h2 {
            font-size: 24px;
            color: #1a73e8;
            border-bottom: 2px solid #e6f2ff;
            padding-bottom: 12px;
            margin-top: 35px;
            margin-bottom: 25px;
            position: relative;
        }
        
        .report-content h2::before {
            content: "ğŸ“Š";
            margin-right: 10px;
            font-size: 24px;
        }
        
        /* å‰¯æ ‡é¢˜æ ·å¼ */
        .report-content h3 {
            font-size: 20px;
            color: #4285f4;
            margin-top: 30px;
            margin-bottom: 18px;
            position: relative;
        }
        
        .report-content h3::before {
            content: "ğŸ“‹";
            margin-right: 10px;
            font-size: 20px;
        }
        
        /* å¼ºè°ƒæ–‡æœ¬ */
        .report-content strong {
            color: #1a73e8;
            font-weight: 600;
        }
        
        /* ç¡®ä¿æ‰€æœ‰æ–‡æœ¬éƒ½ä¸æº¢å‡ºå®¹å™¨ */
        .report-content p, 
        .report-content li, 
        .report-content h2, 
        .report-content h3, 
        .report-content h4 {
            max-width: 100%;
            overflow-wrap: break-word;
            word-wrap: break-word;
        }
        
        /* æŠ¥å‘Šæ ‡é¢˜ */
        #reportContainer h2 {
            text-align: center;
            color: #1a73e8;
            margin: 20px 0 30px;
            font-size: 28px;
            font-family: "Microsoft YaHei", "å¾®è½¯é›…é»‘", sans-serif;
            font-weight: 600;
            position: relative;
            padding-bottom: 15px;
        }
        
        #reportContainer h2::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 3px;
            background: linear-gradient(to right, #1a73e8, #34a853);
            border-radius: 3px;
        }
        
        /* è¿”å›æŒ‰é’® */
        #reportContainer button {
            background: #1a73e8;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            margin: 30px auto;
            display: block;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(26, 115, 232, 0.3);
            font-family: "Microsoft YaHei", "å¾®è½¯é›…é»‘", sans-serif;
        }
        
        #reportContainer button:hover {
            background: #0d62d0;
            box-shadow: 0 4px 12px rgba(26, 115, 232, 0.4);
            transform: translateY(-2px);
        }
        
        /* å¢åŠ ç§»åŠ¨ç«¯é€‚é…æ€§ */
        @media (max-width: 768px) {
            .report-section {
                padding: 20px;
            }
            
            .report-content h2 {
                font-size: 22px;
            }
            
            .report-content h3 {
                font-size: 18px;
            }
        }
    `;
    document.head.appendChild(styleElement);
}
</script>

</body>
</html>
