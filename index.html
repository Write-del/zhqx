<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½å¥åº·é—®è¯Šç³»ç»Ÿ</title>
    <link rel="stylesheet" href="mobile-responsive.css">
    <style>
        /* åŸºç¡€æ ·å¼ - åŒ»ç–—ä¸»é¢˜ */
        :root {
            --primary: #1a73e8;
            --secondary: #34a853;
            --accent: #4285f4;
            --warning: #ea4335;
            --gray-light: #f8f9fa;
            --gray-mid: #dadce0;
            --gray-dark: #5f6368;
            --font-size-base: 15px;
            --font-size-large: 18px;
            --font-size-xlarge: 22px;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            margin: 0 auto;
            padding: 20px;
            background: #f0f4f8;
            color: #333;
            line-height: 1.6;
            font-size: var(--font-size-base);
        }

        /* æ–°å¢ï¼šé¡¶éƒ¨å·¥å…·æ  */
        .top-toolbar {
            position: absolute;
            top: 15px;
            right: 20px;
            display: flex;
            gap: 15px;
            z-index: 100;
        }

        .toolbar-btn {
            background: white;
            border: 1px solid var(--gray-mid);
            border-radius: 20px;
            padding: 8px 15px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .toolbar-btn:hover {
            background: var(--gray-light);
            border-color: var(--accent);
        }

        .toolbar-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* å¤§å­—ä½“æ¨¡å¼ */
        body.large-font {
            --font-size-base: 18px;
            --font-size-large: 22px;
            --font-size-xlarge: 26px;
        }

        body.x-large-font {
            --font-size-base: 22px;
            --font-size-large: 26px;
            --font-size-xlarge: 32px;
        }

        /* æ–‡å­—å¤§å°åº”ç”¨åˆ°å…·ä½“å…ƒç´  */
        input, select, textarea, button, .checkbox-item span, label {
            font-size: var(--font-size-base);
        }

        legend, h4, .section-title {
            font-size: var(--font-size-large);
        }

        h1, h2, h3 {
            font-size: var(--font-size-xlarge);
        }
    
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            position: relative;
        }
        
        /* åŒ»ç–—ä¸»é¢˜æ ‡é¢˜ */
        h1 {
            color: var(--primary);
            text-align: center;
            font-size: 24px;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--gray-mid);
            position: relative;
        }
        
        h1:before {
            content: "ğŸ¥";
            margin-right: 10px;
        }
    
        /* è¡¨å•æ ·å¼ä¼˜åŒ– */
        fieldset {
            border: none;
            border-radius: 8px;
            padding: 20px;
            margin: 25px 0;
            background: var(--gray-light);
            position: relative;
        }
    
        legend {
            font-weight: bold;
            padding: 0 15px;
            background: var(--primary);
            color: white;
            border-radius: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: absolute;
            top: -15px;
            left: 20px;
        }
    
        .form-row {
            margin: 20px 0;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
    
        label {
            min-width: 120px;
            font-weight: 500;
            color: var(--gray-dark);
        }
    
        input, select, textarea {
            padding: 10px 12px;
            border: 1px solid var(--gray-mid);
            border-radius: 6px;
            flex: 1;
            transition: all 0.3s ease;
            font-size: 15px;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.2);
            outline: none;
        }
        
        input[type="radio"], input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--primary);
        }
    
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 15px;
            margin: 20px 0 10px;
            width: 100%;
        }
    
        .checkbox-item {
            background-color: white;
            border: 1px solid var(--gray-mid);
            border-radius: 8px;
            padding: 10px 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .checkbox-item:hover {
            border-color: var(--accent);
            box-shadow: 0 2px 8px rgba(66, 133, 244, 0.2);
        }
        
        .checkbox-item input:checked + span {
            font-weight: 500;
            color: var(--primary);
        }
    
        button {
            background: var(--primary);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            margin: 30px auto;
            display: block;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(26, 115, 232, 0.3);
        }
        
        button:hover {
            background: #0d62d0;
            box-shadow: 0 4px 12px rgba(26, 115, 232, 0.4);
            transform: translateY(-2px);
        }
    
        /* æŠ¥å‘Šæ ·å¼ä¼˜åŒ– */
        .report-section {
            background: #fff;
            padding: 25px;
            margin: 25px 0;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border-left: 4px solid var(--primary);
        }
    
        .warning {
            color: var(--warning);
            font-weight: bold;
            padding: 10px 15px;
            border-radius: 6px;
            background: #ffebee;
            margin: 15px 0;
        }
    
        .miao-advice {
            background: #e8f5e9;
            border-left: 4px solid var(--secondary);
            padding: 15px;
            margin: 15px 0;
            border-radius: 6px;
        }
    
        /* è¡€å‹è¾“å…¥æ¡†ä¼˜åŒ– */
        .bp-inputs {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .bp-inputs input {
            max-width: 80px;
        }
        
        .bp-divider {
            font-weight: bold;
            color: var(--gray-dark);
        }
        
        .bp-unit {
            color: var(--gray-dark);
            white-space: nowrap;
        }
        
        /* å¹¶å‘ç—‡åŒºåŸŸä¼˜åŒ– */
        .complication-group h4 {
            margin: 20px 0 10px;
            color: var(--primary);
            font-size: 16px;
        }
        
        .complication-group h4:before {
            content: "âš•ï¸";
            margin-right: 8px;
        }
    
        /* Markdownæ ·å¼ä¼˜åŒ– */
        .report-content {
            line-height: 1.8;
        }
        
        .report-content h2 {
            color: var(--primary);
            border-bottom: 2px solid #e6f2ff;
            padding-bottom: 8px;
            margin-top: 30px;
            margin-bottom: 20px;
            font-size: 22px;
        }
        
        .report-content h3 {
            color: var(--accent);
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .report-content ul, .report-content ol {
            padding-left: 25px;
            margin: 15px 0;
        }
        
        .report-content li {
            margin-bottom: 8px;
            position: relative;
        }
        
        .report-content strong {
            color: #1a73e8;
        }
        
        /* æŠ¥å‘Šé¡µé¢æ ‡é¢˜ */
        #reportContainer h2 {
            text-align: center;
            color: var(--primary);
            margin: 20px 0 30px;
            font-size: 24px;
        }
        
        /* è¡¨å•åˆ†ç»„æ ‡é¢˜ */
        .section-title {
            font-weight: 500;
            color: var(--gray-dark);
            margin-bottom: 5px;
        }
        
        /* åŒ»ç–—å›¾æ ‡ */
        .medical-icon {
            font-size: 20px;
            margin-right: 8px;
            vertical-align: middle;
        }
        /* æ·»åŠ åˆ—è¡¨æ ·å¼ */
        .report-content ol {
            list-style-type: decimal;
            padding-left: 30px;
        }
    
        .report-content ul {
            list-style-type: disc;
            padding-left: 30px;
        }
    
        .numbered-list {
            counter-reset: item;
        }
    
        .numbered-list li {
            counter-increment: item;
        }
    
        .numbered-list li::before {
            content: counter(item) ". ";
            margin-right: 5px;
            color: var(--primary);
        }
    
        /* æ°‘æ—åŒ»å­¦å»ºè®®ç‰¹æ®Šæ ·å¼ */
        .ethnic-medicine-advice {
            background: linear-gradient(to right, rgba(52, 168, 83, 0.08), rgba(52, 168, 83, 0.03));
            border: 1px solid rgba(52, 168, 83, 0.2);
            border-left: 5px solid #34a853;
            padding: 25px;
            margin: 35px 0;
            border-radius: 10px;
            position: relative;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            font-family: "Microsoft YaHei", "å¾®è½¯é›…é»‘", sans-serif !important;
        }
        
        .ethnic-medicine-advice h3 {
            color: var(--secondary);
            margin-top: 0;
            display: flex;
            align-items: center;
        }
        
        .ethnic-medicine-advice h3:before {
            content: "ğŸŒ¿";
            margin-right: 10px;
        }
        
        /* è¯­è¨€æŒ‡ç¤ºå™¨ */
        .language-indicator {
            position: absolute;
            top: 10px;
            right: 15px;
            background: rgba(26, 115, 232, 0.1);
            color: var(--primary);
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        /* åŒè¯­æ˜¾ç¤ºæ¨¡å¼ */
        .bilingual-content {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .miao-text {
            color: var(--primary);
            font-style: italic;
        }
        
        .chinese-text {
            color: var(--gray-dark);
        }
    
        /* åœ¨styleæ ‡ç­¾ä¸­æ·»åŠ ä»¥ä¸‹æ ·å¼ï¼Œç»Ÿä¸€æŠ¥å‘Šé¡µå­—ä½“ */
        .report-content, #reportContainer, .report-section {
            font-family: "Microsoft YaHei", "å¾®è½¯é›…é»‘", sans-serif !important;
        }

        /* æ›´æ–°æŠ¥å‘Šé¡µæ ·å¼ï¼Œç¡®ä¿å­—ä½“ç»Ÿä¸€ */
        .report-content h2, .report-content h3, .report-content p, 
        .report-content ul, .report-content ol, .report-content li {
            font-family: "Microsoft YaHei", "å¾®è½¯é›…é»‘", sans-serif !important;
        }

        /* æ°‘æ—åŒ»å­¦å»ºè®®ç‰¹æ®Šæ ·å¼ */
        .ethnic-medicine-advice {
            background: linear-gradient(to right, rgba(52, 168, 83, 0.08), rgba(52, 168, 83, 0.03));
            border: 1px solid rgba(52, 168, 83, 0.2);
            border-left: 5px solid #34a853;
            padding: 25px;
            margin: 35px 0;
            border-radius: 10px;
            position: relative;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            font-family: "Microsoft YaHei", "å¾®è½¯é›…é»‘", sans-serif !important;
        }
    
        /* æ·»åŠ ä¼˜åŒ–æŠ¥å‘Šæ ·å¼å‡½æ•° */
        function applyOptimizedReportStyles() {
            const styleElement = document.createElement('style');
            styleElement.textContent = `
                /* å®¹å™¨æ ·å¼ */
                .container {
                    padding: 30px !important;
                    margin: 0 auto !important;
                }

                /* å…¨å±€å­—ä½“è®¾ç½® */
                #reportContainer, .report-section, .report-content, 
                .report-content h2, .report-content h3, .report-content p, 
                .report-content ul, .report-content ol, .report-content li {
                    font-family: "Microsoft YaHei", "å¾®è½¯é›…é»‘", sans-serif !important;
                }

                /* æŠ¥å‘ŠåŒºåŸŸå¢å¼º */
                .report-section {
                    background: #fff;
                    padding: 40px;
                    margin: 30px 0;
                    border-radius: 12px;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
                    border-left: 5px solid #1a73e8;
                    overflow-wrap: break-word;
                    width: auto;
                    position: relative;
                }

                /* æ ¸å¿ƒå†…å®¹æ ·å¼ */
                .report-content {
                    font-size: 16px;
                    line-height: 1.8;
                    color: #333;
                }

                /* é’ˆå¯¹è‹—æ—ç”¨æˆ·çš„ç‰¹æ®Šæ ·å¼ */
                .miao-medicine-note {
                    margin-top: 20px;
                    padding: 10px 15px;
                    background-color: rgba(52, 168, 83, 0.1);
                    border-radius: 6px;
                    font-size: 15px;
                    color: #2e7d32;
                    font-style: italic;
                }
            `;
            document.head.appendChild(styleElement);
        }
        .miao-medicine-note {
            margin-top: 20px;
            padding: 10px 15px;
            background-color: rgba(52, 168, 83, 0.1);
            border-radius: 6px;
            font-size: 15px;
            color: #2e7d32;
            font-style: italic;
        }

        .ethnic-medicine-advice h2 {
            color: #34a853 !important;
            border-bottom-color: rgba(52, 168, 83, 0.3) !important;
        }

        .ethnic-medicine-advice h2::before {
            content: "ğŸŒ¿" !important;
            color: #34a853;
        }

        .ethnic-medicine-advice ul.bullet-list li::before {
            content: "ğŸŒ¿" !important;
        }
        
        /* åœ¨styleæ ‡ç­¾ä¸­æ·»åŠ æˆ–åœ¨applyOptimizedReportStyleså‡½æ•°ä¸­æ·»åŠ  */
/* æ°‘æ—åŒ»å­¦å»ºè®®çš„å·®å¼‚åŒ–æ ·å¼ */
.ethnic-medicine-advice {
    position: relative;
    padding: 25px;
    margin: 35px 0;
    border-radius: 10px;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
    font-family: "Microsoft YaHei", "å¾®è½¯é›…é»‘", sans-serif !important;
}

.ethnic-badge {
    position: absolute;
    top: -12px;
    right: 20px;
    padding: 5px 15px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: bold;
    color: white;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

/* è‹—æ—ç‰¹è‰²æ ·å¼ */
.miao-ethnic {
    background: linear-gradient(to right, rgba(52, 168, 83, 0.08), rgba(52, 168, 83, 0.03));
    border: 1px solid rgba(52, 168, 83, 0.2);
    border-left: 5px solid #34a853;
}

.miao-ethnic .ethnic-badge {
    background-color: #34a853;
}

.miao-ethnic h2 {
    color: #34a853 !important;
    border-bottom-color: rgba(52, 168, 83, 0.3) !important;
}

.miao-ethnic h2::before {
    content: "ğŸŒ¿" !important;
    color: #34a853;
}

/* æ°´æ—ç‰¹è‰²æ ·å¼ */
.shui-ethnic {
    background: linear-gradient(to right, rgba(66, 133, 244, 0.08), rgba(66, 133, 244, 0.03));
    border: 1px solid rgba(66, 133, 244, 0.2);
    border-left: 5px solid #4285f4;
}

.shui-ethnic .ethnic-badge {
    background-color: #4285f4;
}

.shui-ethnic h2 {
    color: #4285f4 !important;
    border-bottom-color: rgba(66, 133, 244, 0.3) !important;
}

.shui-ethnic h2::before {
    content: "ğŸ’§" !important;
    color: #4285f4;
}

/* ä»¡ä½¬æ—ç‰¹è‰²æ ·å¼ */
.gelao-ethnic {
    background: linear-gradient(to right, rgba(234, 67, 53, 0.08), rgba(234, 67, 53, 0.03));
    border: 1px solid rgba(234, 67, 53, 0.2);
    border-left: 5px solid #ea4335;
}

.gelao-ethnic .ethnic-badge {
    background-color: #ea4335;
}

.gelao-ethnic h2 {
    color: #ea4335 !important;
    border-bottom-color: rgba(234, 67, 53, 0.3) !important;
}

.gelao-ethnic h2::before {
    content: "ğŸ”¥" !important; 
    color: #ea4335;
}

/* ä¾—æ—ç‰¹è‰²æ ·å¼ */
.dong-ethnic {
    background: linear-gradient(to right, rgba(251, 188, 5, 0.08), rgba(251, 188, 5, 0.03));
    border: 1px solid rgba(251, 188, 5, 0.2);
    border-left: 5px solid #fbbc05;
}

.dong-ethnic .ethnic-badge {
    background-color: #fbbc05;
}

.dong-ethnic h2 {
    color: #fbbc05 !important;
    border-bottom-color: rgba(251, 188, 5, 0.3) !important;
}

.dong-ethnic h2::before {
    content: "ğŸŒ¾" !important;
    color: #fbbc05;
}

/* æ°‘æ—åŒ»å­¦æ³¨é‡Šæ ·å¼ */
.ethnic-medicine-note {
    margin-top: 20px;
    padding: 10px 15px;
    border-radius: 6px;
    font-size: 14px;
    font-style: italic;
}

.miao-ethnic .ethnic-medicine-note {
    background-color: rgba(52, 168, 83, 0.1);
    color: #2e7d32;
}

.shui-ethnic .ethnic-medicine-note {
    background-color: rgba(66, 133, 244, 0.1);
    color: #1a73e8;
}

.gelao-ethnic .ethnic-medicine-note {
    background-color: rgba(234, 67, 53, 0.1);
    color: #c62828;
}

.dong-ethnic .ethnic-medicine-note {
    background-color: rgba(251, 188, 5, 0.1);
    color: #f57c00;
}

/* åœ¨styleæ ‡ç­¾ä¸­æ·»åŠ æˆ–åœ¨applyOptimizedReportStyleså‡½æ•°ä¸­æ·»åŠ  */
/* åŠ è½½çŠ¶æ€ä¼˜åŒ– */
.loading {
    display: none;
    text-align: center;
    padding: 30px;
    color: var(--gray-dark);
    background: white;
    border-radius: 10px;
    box-shadow: 0 3px 15px rgba(0,0,0,0.1);
    max-width: 500px;
    margin: 20px auto;
}

.loading-dots {
    margin: 10px 0;
    font-size: 30px;
    height: 20px;
}

.loading-dots::after {
    content: "...";
    animation: dots 1.5s infinite;
}

@keyframes dots {
    0%, 20% { content: "."; }
    40%, 60% { content: ".."; }
    80%, 100% { content: "..."; }
}

.progress-container {
    background-color: #f1f1f1;
    border-radius: 10px;
    height: 10px;
    margin: 15px 0;
    overflow: hidden;
}

.progress-bar {
    background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
    height: 100%;
    width: 0%;
    border-radius: 10px;
    transition: width 0.3s ease;
}

.loading-stages {
    display: flex;
    justify-content: space-between;
    font-size: 14px;
    color: var(--gray-dark);
    margin-top: 5px;
}

.stage {
    opacity: 0.6;
    transition: all 0.3s ease;
}

.stage.active {
    color: var(--primary);
    font-weight: bold;
    opacity: 1;
}
    </style>
</head>
<body>
    <!-- é¡¶éƒ¨å·¥å…·æ  -->
    <div class="top-toolbar">
        <div id="font-size-toggle" class="toolbar-btn">
            <span>Aa</span> å¤§å­—æ˜¾ç¤º
        </div>
        <div id="language-toggle" class="toolbar-btn">
            <span>è‹—</span> è‹—è¯­åˆ‡æ¢
        </div>
    </div>

    <div class="container" id="mainContainer">
        <!-- é—®è¯Šè¡¨å• -->
        <form id="healthForm">
            <h1>é«˜è¡€å‹ç³–å°¿ç—…æ™ºèƒ½é—®è¯Šç³»ç»Ÿ</h1>

            <!-- åŸºæœ¬ä¿¡æ¯ -->
            <fieldset>
                <legend>åŸºæœ¬ä¿¡æ¯</legend>
                <div class="form-row">
                    <label for="name">å§“åï¼š</label>
                    <input type="text" id="name" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å" required>
                </div>
                <div class="form-row">
                    <label>æ€§åˆ«ï¼š</label>
                    <div style="display: flex; gap: 20px;">
                        <label class="male-item">
                            <input type="radio" id="male" name="gender" value="ç”·" required>
                            <span>ç”·</span>
                        </label>
                        <label class="male-item">
                            <input type="radio" name="gender" id="female" value="å¥³">
                            <span>å¥³</span>
                        </label>
                    </div>
                </div>
                <div class="form-row">
                    <label for="age">å¹´é¾„ï¼š</label>
                    <input type="number" id="age" min="18" max="120" placeholder="è¯·è¾“å…¥æ‚¨çš„å¹´é¾„" required>
                </div>
                <div class="form-row">
                    <label for="ethnicity">æ°‘æ—ï¼š</label>
                    <select id="ethnicity" required>
                        <option value="" disabled selected>è¯·é€‰æ‹©æ‚¨çš„æ°‘æ—</option>
                        <option value="æ±‰æ—">æ±‰æ—</option>
                        <option value="è‹—æ—">è‹—æ—</option>
                        <option value="ä¾—æ—">ä¾—æ—</option>
                        <option value="æ°´æ—">æ°´æ—</option>
                        <option value="ä»¡ä½¬æ—">ä»¡ä½¬æ—</option>
                    </select>
                </div>
                <div class="form-row">
                    <label for="contact">è”ç³»æ–¹å¼ï¼š</label>
                    <input type="tel" id="contact" placeholder="è¯·è¾“å…¥æ‚¨çš„è”ç³»ç”µè¯" required>
                </div>
                <div class="form-row">
                    <label for="address">å±…ä½åœ°ï¼š</label>
                    <input type="text" id="address" placeholder="è¯·è¾“å…¥æ‚¨çš„å±…ä½åœ°å€" required>
                </div>
                
                <!-- ä¿®æ”¹èº«é«˜ã€ä½“é‡å’ŒBMIä¸ºä¸€è¡Œæ˜¾ç¤º -->
                <div class="form-row">
                    <label for="height">èº«ä½“æŒ‡æ ‡ï¼š</label>
                    <div style="display: flex; align-items: center; gap: 10px; flex: 1;">
                        <input type="number" id="height" min="100" max="250" step="0.1" placeholder="èº«é«˜(cm)" required onchange="calculateBMI()" style="max-width: 100px;">
                        <input type="number" id="weight" min="30" max="200" step="0.1" placeholder="ä½“é‡(kg)" required onchange="calculateBMI()" style="max-width: 100px;">
                        <span style="margin: 0 5px;">BMI:</span>
                        <input type="text" id="bmi" readonly style="background-color: #f8f9fa; max-width: 60px;">
                        <span id="bmi-category" style="font-weight: 500; min-width: 60px;"></span>
                    </div>
                </div>
                <div class="indicator">
                    <span class="indicator-normal">BMIæ­£å¸¸èŒƒå›´: 18.5-24.9</span>
                    <span class="indicator-warning">è¶…é‡: â‰¥ 25.0</span>
                </div>
            </fieldset>
    
            <!-- è¡€å‹å€¼ -->
            <fieldset>
                <legend>è¡€å‹æµ‹é‡</legend>
                <div class="form-row">
                    <label>è¡€å‹å€¼ï¼š</label>
                    <div class="bp-inputs">
                        <input type="number" id="systolic" placeholder="æ”¶ç¼©å‹" required>
                        <span class="bp-divider">/</span>
                        <input type="number" id="diastolic" placeholder="èˆ’å¼ å‹" required>
                        <span class="bp-unit">mmHg</span>
                    </div>
                </div>
                <div class="indicator">
                    <span class="indicator-normal">æ­£å¸¸èŒƒå›´: â‰¤ 120/80 mmHg</span>
                    <span class="indicator-warning">é«˜è¡€å‹: â‰¥ 140/90 mmHg</span>
                </div>
            </fieldset>
    
            <!-- è¡€ç³–å€¼ -->
            <fieldset>
                <legend>è¡€ç³–ç›‘æµ‹</legend>
                <div class="form-row">
                    <label>ç©ºè…¹è¡€ç³–ï¼š</label>
                    <div style="display: flex; align-items: center;">
                        <input type="number" id="blood-sugar-fasting" step="0.1" placeholder="è¯·è¾“å…¥ç©ºè…¹è¡€ç³–å€¼" required>
                        <span class="bp-unit">mmol/L</span>
                    </div>
                </div>
                <div class="indicator">
                    <span class="indicator-normal">æ­£å¸¸èŒƒå›´: 3.9-6.1 mmol/L</span>
                </div>
                <div class="form-row">
                    <label>é¤åè¡€ç³–ï¼š</label>
                    <div style="display: flex; align-items: center;">
                        <input type="number" id="blood-sugar-dinner" step="0.1" placeholder="è¯·è¾“å…¥é¤å2å°æ—¶è¡€ç³–å€¼" required>
                        <span class="bp-unit">mmol/L</span>
                    </div>
                </div>
                <div class="indicator">
                    <span class="indicator-normal">æ­£å¸¸èŒƒå›´: â‰¤ 7.8 mmol/L</span>
                </div>
            </fieldset>
    
            <!-- ç—‡çŠ¶ -->
            <fieldset>
                <legend>èº«ä½“ä¸é€‚ç—‡çŠ¶</legend>
                <div class="section-title">è¯·é€‰æ‹©æ‚¨ç›®å‰å­˜åœ¨çš„ä¸é€‚ç—‡çŠ¶ï¼š</div>
                <div class="checkbox-group">
                    <label class="checkbox-item">
                        <input type="checkbox" name="symptoms" value="å¤´æ™•">
                        <span>å¤´æ™•</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="symptoms" value="ä¹åŠ›">
                        <span>ä¹åŠ›</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="symptoms" value="èƒ¸ç—›">
                        <span>èƒ¸ç—›</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="symptoms" value="çœ¼èŠ±">
                        <span>çœ¼èŠ±</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="symptoms" value="å£æ¸´">
                        <span>å£æ¸´</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="symptoms" value="å¤šå°¿">
                        <span>å¤šå°¿</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="symptoms" value="å¿ƒæ‚¸">
                        <span>å¿ƒæ‚¸</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="symptoms" value="å‘¼å¸å›°éš¾">
                        <span>å‘¼å¸å›°éš¾</span>
                    </label>
                </div>
            </fieldset>
    
            <!-- å¹¶å‘ç—‡ -->
            <fieldset>
                <legend>å¹¶å‘ç—‡è¯„ä¼°</legend>
                <div class="complication-group">
                    <h4>é«˜è¡€å‹å¹¶å‘ç—‡</h4>
                    <div class="checkbox-group">
                        <label class="checkbox-item">
                            <input type="checkbox" name="hypertension-complications" value="å¿ƒè„ç—…">
                            <span>å¿ƒè„ç—…</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="hypertension-complications" value="ä¸­é£">
                            <span>ä¸­é£</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="hypertension-complications" value="è‚¾ç—…">
                            <span>è‚¾ç—…</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="hypertension-complications" value="è§†ç½‘è†œç—…å˜">
                            <span>è§†ç½‘è†œç—…å˜</span>
                        </label>
                    </div>
                    <div class="form-row" style="margin-top: 15px;">
                        <label for="hypertension-other">å…¶ä»–å¹¶å‘ç—‡ï¼š</label>
                        <textarea id="hypertension-other" rows="2" placeholder="è¯·è¾“å…¥å…¶ä»–é«˜è¡€å‹ç›¸å…³å¹¶å‘ç—‡æˆ–ç—‡çŠ¶"></textarea>
                    </div>
                </div>
    
                <div class="complication-group">
                    <h4>ç³–å°¿ç—…å¹¶å‘ç—‡</h4>
                    <div class="checkbox-group">
                        <label class="checkbox-item">
                            <input type="checkbox" name="diabetes-complications" value="ç¥ç»æŸä¼¤">
                            <span>ç¥ç»æŸä¼¤</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="diabetes-complications" value="è‚¾åŠŸèƒ½æŸä¼¤">
                            <span>è‚¾åŠŸèƒ½æŸä¼¤</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="diabetes-complications" value="å¿ƒè¡€ç®¡é—®é¢˜">
                            <span>å¿ƒè¡€ç®¡é—®é¢˜</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="diabetes-complications" value="ç³–å°¿ç—…è¶³">
                            <span>ç³–å°¿ç—…è¶³</span>
                        </label>
                    </div>
                    <div class="form-row" style="margin-top: 15px;">
                        <label for="diabetes-other">å…¶ä»–å¹¶å‘ç—‡ï¼š</label>
                        <textarea id="diabetes-other" rows="2" placeholder="è¯·è¾“å…¥å…¶ä»–ç³–å°¿ç—…ç›¸å…³å¹¶å‘ç—‡æˆ–ç—‡çŠ¶"></textarea>
                    </div>
                </div>
            </fieldset>
    
            <!-- è¿‡æ•å² -->
            <fieldset>
                <legend>è¯ç‰©è¿‡æ•å²</legend>
                <div class="form-row">
                    <label>æ˜¯å¦æœ‰è¿‡æ•å²ï¼š</label>
                    <div style="display: flex; gap: 20px;">
                        <label class="male-item">
                            <input type="radio" name="allergy" value="æ˜¯" required>
                            <span>æ˜¯</span>
                        </label>
                        <label class="male-item">
                            <input type="radio" name="allergy" value="å¦">
                            <span>å¦</span>
                        </label>
                    </div>
                </div>
                <div class="form-row">
                    <label for="allergy-details">è¿‡æ•è¯¦æƒ…ï¼š</label>
                    <textarea id="allergy-details" rows="2" placeholder="è¯·è¯¦ç»†æè¿°æ‚¨çš„è¯ç‰©è¿‡æ•æƒ…å†µ"></textarea>
                </div>
            </fieldset>
    
            <button type="button" onclick="generateReport()">ç”Ÿæˆå¥åº·æŠ¥å‘Š</button>
            <div class="loading" id="loading">æ­£åœ¨ç”Ÿæˆä¸“ä¸šåŒ»ç–—æŠ¥å‘Š</div>
        </form>
    
        <!-- æŠ¥å‘Šæ˜¾ç¤ºåŒºåŸŸ -->
        <div id="reportContainer" style="display: none;"></div>
    </div>
    
    <script>
        const DEEPSEEK_API_KEY = 'sk-6cecc16e7c074089a36f153ec43f5b8a';
        const API_URL = 'https://api.deepseek.com/v1/chat/completions';
    
        // æ·»åŠ è‹—è¯­è¯å…¸
        const miaoTranslation = {
            // é¡µé¢æ ‡é¢˜å’Œè®¾ç½®
            "é«˜è¡€å‹ç³–å°¿ç—…æ™ºèƒ½é—®è¯Šç³»ç»Ÿ": "Qiub Niangb Diub Bangx Rongx Diex Zangt",
            "å¤§å­—æ˜¾ç¤º": "Meil Delk Lol",
            "è‹—è¯­åˆ‡æ¢": "Hmongb Lol Fuk",
            "åŒè¯­æ¨¡å¼": "Shuang Lol Mok",
            // å­—æ®µæ ‡ç­¾
            "åŸºæœ¬ä¿¡æ¯": "Duh Meil Fenb",
            "å§“å": "Guaix",
            "æ€§åˆ«": "Nix Nanb",
            "å¹´é¾„": "Hniangx",
            "æ°‘æ—": "Minb Zuk",
            "è”ç³»æ–¹å¼": "Dien Hua",
            "å±…ä½åœ°": "Zuk Dib",
            "è¡€å‹æµ‹é‡": "Sieb Yak Diub",
            "è¡€ç³–ç›‘æµ‹": "Sieb Tangb Diub",
            "èº«ä½“ä¸é€‚ç—‡çŠ¶": "Mangb Ghangb Zengt",
            "å¹¶å‘ç—‡è¯„ä¼°": "Zengt Vongb Pak",
            "è¯ç‰©è¿‡æ•å²": "Yak Mix Hak",
            // é€‰é¡¹
            "ç”·": "Nanb",
            "å¥³": "Nix",
            "æ±‰æ—": "Han Zuk",
            "è‹—æ—": "Hmongb Zuk",
            "ä¾—æ—": "Dongb Zuk",
            "æ°´æ—": "Suib Zuk",
            "ä»¡ä½¬æ—": "Gelb Laob Zuk",
            // ç—‡çŠ¶
            "å¤´æ™•": "Daub Yuk",
            "ä¹åŠ›": "Mongb Lik",
            "èƒ¸ç—›": "Hangt Tongb",
            "çœ¼èŠ±": "Maix Vut",
            "å£æ¸´": "Kot Hax",
            "å¤šå°¿": "Zix Senb",
            "å¿ƒæ‚¸": "Sim Baix",
            "å‘¼å¸å›°éš¾": "Haix Cuk Nant",
            // å¹¶å‘ç—‡
            "é«˜è¡€å‹å¹¶å‘ç—‡": "Qiub Niangb Zengt",
            "å¿ƒè„ç—…": "Sim Zengt",
            "ä¸­é£": "Tongb Fongb",
            "è‚¾ç—…": "Yenx Zengt",
            "è§†ç½‘è†œç—…å˜": "Maix Vut Zent",
            "ç³–å°¿ç—…å¹¶å‘ç—‡": "Tangb Zengt",
            "ç¥ç»æŸä¼¤": "Simt Zengt",
            "è‚¾åŠŸèƒ½æŸä¼¤": "Yenx Vek",
            "å¿ƒè¡€ç®¡é—®é¢˜": "Sim Sieb Zengt",
            "ç³–å°¿ç—…è¶³": "Diek Zengt",
            // è¿‡æ•å²
            "æ˜¯å¦æœ‰è¿‡æ•å²": "Mix Hak Lak",
            "æ˜¯": "Mix",
            "å¦": "Ax",
            "è¿‡æ•è¯¦æƒ…": "Mix Hak Duk",
            // æŒ‰é’®å’Œæç¤º
            "ç”Ÿæˆå¥åº·æŠ¥å‘Š": "Dak Jiank Kangt Baot",
            "æ­£åœ¨ç”Ÿæˆä¸“ä¸šåŒ»ç–—æŠ¥å‘Š": "Dak Zak Jiank Baot",
            "è¿”å›é—®è¯Šè¡¨å•": "Rout Diex Dab",
            "çš„å¥åº·æŠ¥å‘Š": "Jiank Kangt Baot",
            // æŒ‡æ ‡å’Œå•ä½
            "è¡€å‹å€¼": "Sieb Yak",
            "æ”¶ç¼©å‹": "Sot Yak",
            "èˆ’å¼ å‹": "Suk Yak",
            "ç©ºè…¹è¡€ç³–": "Kong Sieb",
            "é¤åè¡€ç³–": "Niaot Sieb",
            "æ­£å¸¸èŒƒå›´": "Zangt Fant",
            "é«˜è¡€å‹": "Qiub Sieb",
            "è¯·è¾“å…¥æ‚¨çš„å§“å": "Guaix",
            "è¯·è¾“å…¥æ‚¨çš„å¹´é¾„": "Hniangx",
            "è¯·é€‰æ‹©æ‚¨çš„æ°‘æ—": "Minb Zuk",
            "è¯·è¾“å…¥æ‚¨çš„è”ç³»ç”µè¯": "Dien Hua",
            "è¯·è¾“å…¥æ‚¨çš„å±…ä½åœ°å€": "Zuk Dib",
            "è¯·è¾“å…¥ç©ºè…¹è¡€ç³–å€¼": "Kong Sieb",
            "è¯·è¾“å…¥é¤å2å°æ—¶è¡€ç³–å€¼": "Niaot Sieb",
            "è¯·é€‰æ‹©æ‚¨ç›®å‰å­˜åœ¨çš„ä¸é€‚ç—‡çŠ¶": "Mangb Ghangb Zengt",
            "è¯·è¯¦ç»†æè¿°æ‚¨çš„è¯ç‰©è¿‡æ•æƒ…å†µ": "Mix Hak Duk",
            // æŠ¥å‘Šéƒ¨åˆ†
            "é£é™©è¯„ä¼°": "Fengx Xib Pakx",
            "åŒ»ç–—å»ºè®®": "Yix Dak Jiex",
            "è¥¿è¯æ²»ç–—æ–¹æ¡ˆ": "Seix Yak Fangx",
            "ä¸­è¯/æ°‘æ—åŒ»è¯å»ºè®®": "Zongx Yak Jiex",
            "æ°‘æ—åŒ»è¯å»ºè®®": "Minb Zux Yak",
            "ç”Ÿæ´»å»ºè®®": "Sengx Huox Jiex",
            "é¥®é£Ÿå»ºè®®": "Yinx Sik Jiex",
            "è¿åŠ¨å»ºè®®": "Yunx Dongx Jiex",
            "æ³¨æ„äº‹é¡¹": "Zux Yix Sirx",
            // æ–°å¢èº«é«˜ä½“é‡BMIç›¸å…³ç¿»è¯‘
            "èº«é«˜": "Ghaob",
            "ä½“é‡": "Zenb",
            "BMIæŒ‡æ•°": "BMI Zhix",
            "è¯·è¾“å…¥æ‚¨çš„èº«é«˜": "Ghaob",
            "è¯·è¾“å…¥æ‚¨çš„ä½“é‡": "Zenb",
            "åç˜¦": "Piant Sout",
            "æ­£å¸¸": "Zhengb Changk",
            "è¶…é‡": "Chaot Zhongb",
            "è‚¥èƒ–": "Feib Pangb",
            "é‡åº¦è‚¥èƒ–": "Zhongb Feib",
            // æ–°å¢ç¿»è¯‘
            "èº«ä½“æŒ‡æ ‡": "Shenb Tix Zhix",
            "BMIæ­£å¸¸èŒƒå›´": "BMI Fant Wei",
            "å…¶ä»–å¹¶å‘ç—‡": "Qib Taf Bingb",
            "è¯·è¾“å…¥å…¶ä»–é«˜è¡€å‹ç›¸å…³å¹¶å‘ç—‡æˆ–ç—‡çŠ¶": "Qiub Niangb Qib Taf Bingb",
            "è¯·è¾“å…¥å…¶ä»–ç³–å°¿ç—…ç›¸å…³å¹¶å‘ç—‡æˆ–ç—‡çŠ¶": "Tangb Diub Qib Taf Bingb"
        };

        // è‹—æ–‡æ£€æµ‹å™¨ - æ£€æŸ¥æ–‡æœ¬æ˜¯å¦ä¸ºè‹—æ–‡
        function isMiaoText(text) {
            // ç®€å•æ£€æµ‹ï¼šè‹—æ–‡å¸¸ç”¨å­—ç¬¦ç‰¹å¾
            const miaoCharacters = /[A-Z][a-z]+b|[A-Z][a-z]+k|[A-Z][a-z]+x|[A-Z][a-z]+t/;
            return miaoCharacters.test(text) && !/[\u4e00-\u9fa5]/.test(text); // åŒ…å«è‹—æ–‡ç‰¹å¾ä¸”ä¸åŒ…å«ä¸­æ–‡
        }

        // åå‘ç¿»è¯‘ï¼šè‹—æ–‡->ä¸­æ–‡
        const chineseTranslation = {};
        for (const [chinese, miao] of Object.entries(miaoTranslation)) {
            chineseTranslation[miao] = chinese;
        }

        // å­—ä½“å¤§å°åˆ‡æ¢
        let currentFontSize = 0; // 0: æ­£å¸¸, 1: å¤§, 2: ç‰¹å¤§
        const fontSizeToggle = document.getElementById('font-size-toggle');
        fontSizeToggle.addEventListener('click', function() {
            currentFontSize = (currentFontSize + 1) % 3;
            document.body.classList.remove('large-font', 'x-large-font');
            
            if (currentFontSize === 1) {
                document.body.classList.add('large-font');
                this.innerHTML = '<span>Aa</span> å¤§å­—æ¨¡å¼';
            } else if (currentFontSize === 2) {
                document.body.classList.add('x-large-font');
                this.innerHTML = '<span>Aa</span> ç‰¹å¤§å­—ä½“';
            } else {
                this.innerHTML = '<span>Aa</span> å¤§å­—æ˜¾ç¤º';
            }
            
            // å¦‚æœå·²ç»åˆ‡æ¢ä¸ºè‹—è¯­ï¼Œéœ€è¦è¿›è¡Œç›¸åº”ç¿»è¯‘
            if (isMiaoMode) {
                if (currentFontSize === 1) {
                    this.innerHTML = '<span>Aa</span> Meil Delk';
                } else if (currentFontSize === 2) {
                    this.innerHTML = '<span>Aa</span> Meil Dal';
                } else {
                    this.innerHTML = '<span>Aa</span> Meil Delk Lol';
                }
            }
        });

        // è‹—è¯­åˆ‡æ¢
        let isMiaoMode = false;
        const languageToggle = document.getElementById('language-toggle');
        languageToggle.addEventListener('click', function() {
            isMiaoMode = !isMiaoMode;
            this.classList.toggle('active');
            
            if (isMiaoMode) {
                // åˆ‡æ¢åˆ°è‹—è¯­
                this.innerHTML = '<span>ä¸­</span> åˆ‡æ¢ä¸­æ–‡';
                translateToMiao();
            } else {
                // åˆ‡æ¢å›ä¸­æ–‡
                this.innerHTML = '<span>è‹—</span> è‹—è¯­åˆ‡æ¢';
                translateToChinese();
            }
            
            // å¤„ç†å­—ä½“å¤§å°æŒ‰é’®çš„æ–‡æœ¬
            if (isMiaoMode) {
                if (currentFontSize === 1) {
                    fontSizeToggle.innerHTML = '<span>Aa</span> Meil Delk';
                } else if (currentFontSize === 2) {
                    fontSizeToggle.innerHTML = '<span>Aa</span> Meil Dal';
                } else {
                    fontSizeToggle.innerHTML = '<span>Aa</span> Meil Delk Lol';
                }
            } else {
                if (currentFontSize === 1) {
                    fontSizeToggle.innerHTML = '<span>Aa</span> å¤§å­—æ¨¡å¼';
                } else if (currentFontSize === 2) {
                    fontSizeToggle.innerHTML = '<span>Aa</span> ç‰¹å¤§å­—ä½“';
                } else {
                    fontSizeToggle.innerHTML = '<span>Aa</span> å¤§å­—æ˜¾ç¤º';
                }
            }
        });

        // è‡ªåŠ¨æ£€æµ‹è¾“å…¥è¯­è¨€ç±»å‹
        document.querySelectorAll('input[type="text"], textarea').forEach(input => {
            input.addEventListener('input', function() {
                const value = this.value.trim();
                if (value && isMiaoText(value)) {
                    // æ£€æµ‹åˆ°è‹—æ–‡è¾“å…¥ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°è‹—æ–‡æ¨¡å¼
                    if (!isMiaoMode) {
                        isMiaoMode = true;
                        languageToggle.classList.add('active');
                        languageToggle.innerHTML = '<span>ä¸­</span> åˆ‡æ¢ä¸­æ–‡';
                        translateToMiao();
                    }
                }
            });
        });

        // å°†é¡µé¢å…ƒç´ ç¿»è¯‘ä¸ºè‹—è¯­
        function translateToMiao() {
            // æ ‡é¢˜
            document.querySelector('h1').textContent = miaoTranslation["é«˜è¡€å‹ç³–å°¿ç—…æ™ºèƒ½é—®è¯Šç³»ç»Ÿ"] || document.querySelector('h1').textContent;
            
            // fieldset æ ‡é¢˜ (legend)
            document.querySelectorAll('legend').forEach(legend => {
                const chinese = legend.textContent;
                legend.textContent = miaoTranslation[chinese] || chinese;
            });
            
            // æ ‡ç­¾æ–‡æœ¬
            document.querySelectorAll('label').forEach(label => {
                if (label.childElementCount === 0) { // åªç¿»è¯‘æ²¡æœ‰å­å…ƒç´ çš„æ ‡ç­¾
                    const chinese = label.textContent.replace('ï¼š', '');
                    if (miaoTranslation[chinese]) {
                        label.textContent = miaoTranslation[chinese] + 'ï¼š';
                    }
                }
            });
            
            // å•é€‰æ¡†å’Œå¤é€‰æ¡†
            document.querySelectorAll('.male-item span, .checkbox-item span').forEach(span => {
                const chinese = span.textContent;
                span.textContent = miaoTranslation[chinese] || chinese;
            });
            
            // placeholder å±æ€§
            document.querySelectorAll('input[placeholder], textarea[placeholder]').forEach(input => {
                const chinese = input.placeholder;
                input.placeholder = miaoTranslation[chinese] || chinese;
            });
            
            // é€‰æ‹©æ¡†é€‰é¡¹
            document.querySelectorAll('option').forEach(option => {
                const chinese = option.textContent;
                if (chinese && chinese.trim() !== '') {
                    option.textContent = miaoTranslation[chinese] || chinese;
                }
            });
            
            // æŒ‰é’®æ–‡æœ¬
            document.querySelectorAll('button').forEach(button => {
                const chinese = button.textContent;
                button.textContent = miaoTranslation[chinese] || chinese;
            });
            
            // æç¤ºä¿¡æ¯
            document.querySelectorAll('.indicator span').forEach(span => {
                // ä»…æ›¿æ¢å†’å·å‰çš„æ–‡æœ¬ï¼Œä¿ç•™æ•°å€¼èŒƒå›´
                const parts = span.textContent.split(':');
                if (parts.length > 1) {
                    const textPart = parts[0].trim();
                    const valuePart = parts.slice(1).join(':').trim();
                    span.textContent = (miaoTranslation[textPart] || textPart) + ': ' + valuePart;
                }
            });
            
            // åŠ è½½æ–‡æœ¬
            const loading = document.getElementById('loading');
            if (loading) {
                loading.textContent = miaoTranslation["æ­£åœ¨ç”Ÿæˆä¸“ä¸šåŒ»ç–—æŠ¥å‘Š"] || loading.textContent;
            }
        }
        
        // å°†é¡µé¢å…ƒç´ æ¢å¤ä¸ºä¸­æ–‡
        function translateToChinese() {
            // åˆ·æ–°é¡µé¢æ˜¯æœ€ç®€å•çš„æ–¹å¼
            location.reload();
        }

        // æ£€æµ‹è¾“å…¥æ˜¯å¦ä¸ºè‹—æ–‡
        function detectMiaoInput() {
            // æ£€æŸ¥å…³é”®è¾“å…¥å­—æ®µ
            const nameValue = document.getElementById('name').value;
            const allergyDetails = document.getElementById('allergy-details').value;
            
            // å¦‚æœä»»ä¸€å­—æ®µåŒ…å«è‹—æ–‡ç‰¹å¾
            if (isMiaoText(nameValue) || isMiaoText(allergyDetails)) {
                return true;
            }
            
            return false;
        }
    
        // æ·»åŠ æ›´ç›´è§‚çš„åŠ è½½æç¤º
        function updateLoadingUI() {
            const loadingElement = document.getElementById('loading');
            const dots = document.createElement('div');
            dots.className = 'loading-dots';
            
            // æ¸…ç©ºå½“å‰å†…å®¹
            loadingElement.innerHTML = 'æ­£åœ¨ç”Ÿæˆä¸“ä¸šåŒ»ç–—æŠ¥å‘Š';
            
            // æ·»åŠ è¿›åº¦æŒ‡ç¤ºå™¨
            const progressBar = document.createElement('div');
            progressBar.className = 'loading-progress';
            progressBar.innerHTML = `
                <div class="progress-container">
                    <div class="progress-bar"></div>
                </div>
                <div class="loading-stages">
                    <span class="stage active">åˆ†ææ•°æ®</span>
                    <span class="stage">ç”Ÿæˆå»ºè®®</span>
                    <span class="stage">æ ¼å¼åŒ–æŠ¥å‘Š</span>
                </div>
            `;
            
            loadingElement.appendChild(dots);
            loadingElement.appendChild(progressBar);
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            loadingElement.style.display = 'block';
            
            // æ¨¡æ‹Ÿè¿›åº¦
            simulateProgress();
        }

        // æ¨¡æ‹ŸAPIå¤„ç†è¿›åº¦
        function simulateProgress() {
            const progressBar = document.querySelector('.progress-bar');
            const stages = document.querySelectorAll('.stage');
            let width = 0;
            
            // é‡ç½®è¿›åº¦æ¡å’Œé˜¶æ®µ
            progressBar.style.width = '0%';
            stages.forEach((stage, index) => {
                if (index === 0) {
                    stage.classList.add('active');
                } else {
                    stage.classList.remove('active');
                }
            });
            
            const interval = setInterval(() => {
                if (width >= 100) {
                    clearInterval(interval);
                } else {
                    width += 0.5;
                    progressBar.style.width = width + '%';
                    
                    // æ›´æ–°é˜¶æ®µæ˜¾ç¤º
                    if (width > 30 && width < 75) {
                        stages[0].classList.remove('active');
                        stages[1].classList.add('active');
                    } else if (width >= 75) {
                        stages[1].classList.remove('active');
                        stages[2].classList.add('active');
                    }
                }
            }, 100);
        }

        // ä¿®æ”¹ç”ŸæˆæŠ¥å‘Šå‡½æ•°ï¼Œæ·»åŠ è¶…æ—¶å¤„ç†å’Œç¼“å­˜
        async function generateReport() {
            try {
                // æ›´æ–°åŠ è½½UI
                updateLoadingUI();
    
                // æ”¶é›†è¡¨å•æ•°æ®
                const formData = {
                    name: document.getElementById('name').value,
                    gender: document.querySelector('input[name="gender"]:checked')?.value || '',
                    age: document.getElementById('age').value,
                    ethnicity: document.getElementById('ethnicity').value,
                    // èº«é«˜ä½“é‡BMIæ•°æ®
                    height: document.getElementById('height').value,
                    weight: document.getElementById('weight').value,
                    bmi: document.getElementById('bmi').value,
                    bmiCategory: document.getElementById('bmi-category').textContent,
                    systolic: document.getElementById('systolic').value,
                    diastolic: document.getElementById('diastolic').value,
                    bloodSugarFasting: document.getElementById('blood-sugar-fasting').value,
                    bloodSugarDinner: document.getElementById('blood-sugar-dinner').value,
                    symptoms: Array.from(document.querySelectorAll('[name="symptoms"]:checked')).map(c => c.value),
                    hypertensionComplications: Array.from(document.querySelectorAll('[name="hypertension-complications"]:checked')).map(c => c.value),
                    hypertensionOther: document.getElementById('hypertension-other').value, // æ–°å¢å­—æ®µ
                    diabetesComplications: Array.from(document.querySelectorAll('[name="diabetes-complications"]:checked')).map(c => c.value),
                    diabetesOther: document.getElementById('diabetes-other').value, // æ–°å¢å­—æ®µ
                    allergy: document.querySelector('input[name="allergy"]:checked')?.value || 'å¦',
                    allergyDetails: document.getElementById('allergy-details').value
                };
    
                // åŸºæœ¬éªŒè¯
                if (!formData.name || !formData.age || !formData.systolic || !formData.diastolic || !formData.height || !formData.weight) {
                    alert(isMiaoMode ? 'Niub Dab Fenb Qebt' : 'è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ');
                    document.getElementById('loading').style.display = 'none';
                    return;
                }
                
                // æ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦æœ‰ç›¸ä¼¼æŠ¥å‘Š
                const cacheKey = generateCacheKey(formData);
                const cachedReport = localStorage.getItem(cacheKey);
                
                if (cachedReport) {
                    // ä½¿ç”¨ç¼“å­˜çš„æŠ¥å‘Šå†…å®¹
                    console.log("ä½¿ç”¨ç¼“å­˜çš„æŠ¥å‘Šå†…å®¹");
                    showReport(formData, cachedReport);
                    return;
                }
    
                // æ„å»ºæç¤ºè¯
                const prompt = `ä½œä¸ºä¸“ä¸šåŒ»ç”Ÿï¼Œè¯·æ ¹æ®ä»¥ä¸‹æ‚£è€…ä¿¡æ¯ç”Ÿæˆè¯¦ç»†å¥åº·æŠ¥å‘Šï¼š
æ‚£è€…ä¿¡æ¯ï¼š
- å§“åï¼š${formData.name}
- å¹´é¾„ï¼š${formData.age}å²
- æ€§åˆ«ï¼š${formData.gender}
- æ°‘æ—ï¼š${formData.ethnicity}
- èº«é«˜ï¼š${formData.height} cm
- ä½“é‡ï¼š${formData.weight} kg
- BMIï¼š${formData.bmi}ï¼ˆ${formData.bmiCategory}ï¼‰
- è¡€å‹ï¼š${formData.systolic}/${formData.diastolic} mmHg
- è¡€ç³–ï¼šç©ºè…¹ ${formData.bloodSugarFasting} mmol/Lï¼Œé¤å ${formData.bloodSugarDinner} mmol/L
- ç—‡çŠ¶ï¼š${formData.symptoms.join(', ') || 'æ— '}
- å¹¶å‘ç—‡ï¼š
  * é«˜è¡€å‹ï¼š${formData.hypertensionComplications.join(', ') || 'æ— '}${formData.hypertensionOther ? 'ï¼Œ' + formData.hypertensionOther : ''}
  * ç³–å°¿ç—…ï¼š${formData.diabetesComplications.join(', ') || 'æ— '}${formData.diabetesOther ? 'ï¼Œ' + formData.diabetesOther : ''}
- è¿‡æ•å²ï¼š${formData.allergy === 'æ˜¯' ? formData.allergyDetails : 'æ— '}

è¯·ç”¨${isMiaoMode ? 'è‹—è¯­' : 'ä¸­æ–‡'}æŒ‰ä»¥ä¸‹ç»“æ„ç»„ç»‡æŠ¥å‘Šå†…å®¹ï¼Œä½¿ç”¨Markdownæ ¼å¼ï¼Œè¯·ä¸¥æ ¼ä½¿ç”¨ä»¥ä¸‹æ ¼å¼ï¼š
## é£é™©è¯„ä¼°
1. é«˜è¡€å‹é£é™©è¯„ä¼°...
    1.ç¬¬ä¸€æ¡å†…å®¹...
    2.ç¬¬äºŒæ¡å†…å®¹...
2. ç³–å°¿ç—…é£é™©è¯„ä¼°...
    1.ç¬¬ä¸€æ¡å†…å®¹...
    2.ç¬¬äºŒæ¡å†…å®¹...

## åŒ»ç–—å»ºè®®
### 1. è¥¿è¯æ²»ç–—æ–¹æ¡ˆ
1. ç¬¬ä¸€æ¡å»ºè®®...
2. ç¬¬äºŒæ¡å»ºè®®...

### 2. ä¸­è¯/æ°‘æ—åŒ»è¯å»ºè®®
1. ç¬¬ä¸€æ¡å»ºè®®...
2. ç¬¬äºŒæ¡å»ºè®®...

## æ°‘æ—åŒ»è¯ç‰¹è‰²å»ºè®®
${generateEthnicMedicinePrompt(formData.ethnicity)}

## ç”Ÿæ´»å»ºè®®
### 1. é¥®é£Ÿå»ºè®®
- ç¬¬ä¸€æ¡å»ºè®®...
- ç¬¬äºŒæ¡å»ºè®®...
### 2. è¿åŠ¨å»ºè®®
- ç¬¬ä¸€æ¡å»ºè®®...
- ç¬¬äºŒæ¡å»ºè®®..


## æ³¨æ„äº‹é¡¹
[ç‰¹æ®Šè­¦ç¤ºä¿¡æ¯]

${shouldProvideEthnicMedicine(formData.ethnicity) ? 'è¯·ç‰¹åˆ«å…³æ³¨ä¼ ç»ŸåŒ»è¯å’Œç°ä»£åŒ»å­¦çš„ç»“åˆï¼Œæä¾›å…¨é¢çš„å¥åº·æŒ‡å¯¼ã€‚' : ''}`;

                // æ·»åŠ æ ¹æ®æ°‘æ—ç”Ÿæˆå¯¹åº”åŒ»å­¦å»ºè®®æç¤ºçš„å‡½æ•°
                function generateEthnicMedicinePrompt(ethnicity) {
                    switch(ethnicity) {
                        case 'è‹—æ—':
                            return 'è¯·åœ¨æ­¤éƒ¨åˆ†è¯¦ç»†é˜è¿°é€‚åˆè‹—æ—æ‚£è€…çš„ä¼ ç»ŸåŒ»è¯çŸ¥è¯†ï¼ŒåŒ…æ‹¬è‰è¯ã€é£Ÿç–—å’Œä¼ ç»Ÿæ²»ç–—æ–¹æ³•ï¼Œè¿™éƒ¨åˆ†å•ç‹¬æˆä¸ºä¸€ä¸ªç« èŠ‚ã€‚ç‰¹åˆ«å…³æ³¨è‹—æ—æ°‘é—´å¯¹é«˜è¡€å‹å’Œç³–å°¿ç—…çš„ä¼ ç»Ÿæ²»ç–—æ–¹æ³•ä¸ç»éªŒï¼Œå¦‚è‹—åŒ»çš„"ç³¯æ‰"ï¼ˆæ”¾è¡€ç–—æ³•ï¼‰ã€"ç³¯ç¸"ï¼ˆè‰¾ç¸ï¼‰å’Œè‹—æ—å¸¸ç”¨è¯æå¦‚é»„ç²¾ã€è‹¦å‚ã€è’²å…¬è‹±ã€é‡‘é“¶èŠ±ç­‰åœ¨æ²»ç–—é«˜è¡€å‹å’Œç³–å°¿ç—…çš„åº”ç”¨ã€‚';
                            
                        case 'æ°´æ—':
                            return 'è¯·åœ¨æ­¤éƒ¨åˆ†è¯¦ç»†é˜è¿°é€‚åˆæ°´æ—æ‚£è€…çš„ä¼ ç»ŸåŒ»è¯çŸ¥è¯†ï¼ŒåŒ…æ‹¬è‰è¯ã€é£Ÿç–—å’Œä¼ ç»Ÿæ²»ç–—æ–¹æ³•ï¼Œè¿™éƒ¨åˆ†å•ç‹¬æˆä¸ºä¸€ä¸ªç« èŠ‚ã€‚ç‰¹åˆ«ä»‹ç»æ°´æ—åŒ»è¯ç‰¹è‰²ï¼Œå¦‚"æ°´æ—åä¸‰æ–¹"ä¼ ç»Ÿè¯æ–¹ã€æ°´æ—ç‰¹æœ‰çš„"å†·çƒ­å¹³è¡¡"æ²»ç–—ç†å¿µï¼Œä»¥åŠæ°´æ—å¸¸ç”¨è¯æå¦‚é‡‘æ¨±æ ¹ã€æ°´ç‰›ä¸ƒã€é±¼è…¥è‰ã€é©¬è¹„æ ¹ç­‰åœ¨æ²»ç–—é«˜è¡€å‹å’Œç³–å°¿ç—…æ–¹é¢çš„åº”ç”¨ã€‚ä¹Ÿä»‹ç»æ°´æ—ç‰¹è‰²çš„è¯æµ´ã€è‰¾ç¸å’Œåˆ®ç—§ç­‰å¤–æ²»æ³•ã€‚';
                            
                        case 'ä»¡ä½¬æ—':
                            return 'è¯·åœ¨æ­¤éƒ¨åˆ†è¯¦ç»†é˜è¿°é€‚åˆä»¡ä½¬æ—æ‚£è€…çš„ä¼ ç»ŸåŒ»è¯çŸ¥è¯†ï¼ŒåŒ…æ‹¬è‰è¯ã€é£Ÿç–—å’Œä¼ ç»Ÿæ²»ç–—æ–¹æ³•ï¼Œè¿™éƒ¨åˆ†å•ç‹¬æˆä¸ºä¸€ä¸ªç« èŠ‚ã€‚ç‰¹åˆ«å…³æ³¨ä»¡ä½¬æ—ä¼ ç»ŸåŒ»è¯ä¸­çš„"ä¸‰ä¸ƒ"åº”ç”¨ã€"è·Œæ‰“æŸä¼¤è¯"è½¬åŒ–æ²»ç–—æ…¢æ€§ç—…çš„æ–¹æ³•ï¼Œä»¥åŠä»¡ä½¬æ—ç‰¹æœ‰çš„è¯é…’ã€è¯è†ç­‰åˆ¶å‰‚åœ¨é«˜è¡€å‹å’Œç³–å°¿ç—…æ²»ç–—ä¸­çš„è¾…åŠ©ä½œç”¨ã€‚ä»‹ç»ä»¡ä½¬æ—å¸¸ç”¨è¯æå¦‚ä»™èŒ…ã€è‘›æ ¹ã€è›‡åºŠå­ã€ä»¡ä½¬å‡‰å¸­è‰ç­‰çš„åŠŸæ•ˆå’Œç”¨æ³•ã€‚';
                            
                        case 'ä¾—æ—':
                            return 'è¯·åœ¨æ­¤éƒ¨åˆ†è¯¦ç»†é˜è¿°é€‚åˆä¾—æ—æ‚£è€…çš„ä¼ ç»ŸåŒ»è¯çŸ¥è¯†ï¼ŒåŒ…æ‹¬è‰è¯ã€é£Ÿç–—å’Œä¼ ç»Ÿæ²»ç–—æ–¹æ³•ï¼Œè¿™éƒ¨åˆ†å•ç‹¬æˆä¸ºä¸€ä¸ªç« èŠ‚ã€‚ç‰¹åˆ«ä»‹ç»ä¾—æ—åŒ»è¯ä¸­çš„"ä¾—è¯ä¹åˆ¶"ã€"ä¾—æ—è¯æ•"ã€è¯æµ´ç–—æ³•ï¼Œä»¥åŠä¾—æ—ç‰¹æœ‰çš„"ä¾—åŒ»è¯èŒ¶"ã€é…¸æ€§é£Ÿç‰©åœ¨è°ƒèŠ‚è¡€å‹å’Œè¡€ç³–æ–¹é¢çš„ä½œç”¨ã€‚ç»“åˆä¾—æ—å¸¸ç”¨è¯æå¦‚ä¾—æ—è‰è¯ã€é‡ç”ŸçµèŠã€ä¾—è¯äº”å€å­ç­‰åœ¨æ²»ç–—é«˜è¡€å‹å’Œç³–å°¿ç—…æ–¹é¢çš„åº”ç”¨ã€‚';
                            
                        default:
                            return 'æ­¤éƒ¨åˆ†æ ¹æ®æ‚£è€…æ°‘æ—èƒŒæ™¯æä¾›ç›¸å…³çš„ä¼ ç»ŸåŒ»è¯å»ºè®®ã€‚';
                    }
                }

                // åˆ¤æ–­æ˜¯å¦åº”è¯¥æä¾›æ°‘æ—åŒ»å­¦å»ºè®®
                function shouldProvideEthnicMedicine(ethnicity) {
                    return ['è‹—æ—', 'æ°´æ—', 'ä»¡ä½¬æ—', 'ä¾—æ—'].includes(ethnicity) || isMiaoMode;
                }
    
                // è®¾ç½®è¯·æ±‚è¶…æ—¶
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 30000); // 30ç§’è¶…æ—¶
                
                try {
                // è°ƒç”¨API
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${DEEPSEEK_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: "deepseek-chat",
                        messages: [{ role: "user", content: prompt }],
                        temperature: 0.3
                        }),
                        signal: controller.signal
                });
                    
                    clearTimeout(timeoutId);
    
                const data = await response.json();
                const reportContent = data.choices[0].message.content;
                    
                    // ç¼“å­˜æŠ¥å‘Šå†…å®¹
                    localStorage.setItem(cacheKey, reportContent);
    
                // ç”ŸæˆæŠ¥å‘Šé¡µé¢
                showReport(formData, reportContent);
                } catch (fetchError) {
                    if (fetchError.name === 'AbortError') {
                        // å¤„ç†è¶…æ—¶
                        handleTimeoutFallback(formData);
                    } else {
                        throw fetchError;
                    }
                }
            } catch (error) {
                alert(isMiaoMode ? 'Baot Dak Bib: ' + error.message : `æŠ¥å‘Šç”Ÿæˆå¤±è´¥: ${error.message}`);
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }
    
        // ç”Ÿæˆç¼“å­˜é”®
        function generateCacheKey(formData) {
            // åˆ›å»ºå”¯ä¸€æ ‡è¯†ï¼Œä½¿ç”¨å…³é”®å­—æ®µ
            return `report_${formData.ethnicity}_${formData.gender}_${formData.age}_${formData.systolic}_${formData.diastolic}_${formData.bloodSugarFasting}_${Math.floor(Date.now() / (1000 * 60 * 60 * 24))}`;
        }
    
        // å¤„ç†è¶…æ—¶çš„å›é€€æ–¹æ¡ˆ
        function handleTimeoutFallback(formData) {
            alert("ç”ŸæˆæŠ¥å‘Šæ—¶é—´è¾ƒé•¿ï¼Œæ­£åœ¨ä½¿ç”¨å¿«é€Ÿæ¨¡å¼...");
            
            // ç”Ÿæˆä¸€ä¸ªç®€åŒ–çš„æŠ¥å‘Š
            const simplifiedReport = generateSimplifiedReport(formData);
            showReport(formData, simplifiedReport);
        }
    
        // ç”Ÿæˆç®€åŒ–ç‰ˆæŠ¥å‘Š
        function generateSimplifiedReport(formData) {
            return `
## é£é™©è¯„ä¼°
1. é«˜è¡€å‹é£é™©è¯„ä¼°
   - è¡€å‹å€¼ï¼š${formData.systolic}/${formData.diastolic} mmHgï¼Œ${evaluateBloodPressure(formData.systolic, formData.diastolic)}
   - éœ€å…³æ³¨å¹¶å‘ç—‡ï¼š${formData.hypertensionComplications.join('ã€') || 'æš‚æ— '}

2. ç³–å°¿ç—…é£é™©è¯„ä¼°
   - ç©ºè…¹è¡€ç³–ï¼š${formData.bloodSugarFasting} mmol/Lï¼Œ${evaluateBloodSugar(formData.bloodSugarFasting, true)}
   - é¤åè¡€ç³–ï¼š${formData.bloodSugarDinner} mmol/Lï¼Œ${evaluateBloodSugar(formData.bloodSugarDinner, false)}
   - éœ€å…³æ³¨å¹¶å‘ç—‡ï¼š${formData.diabetesComplications.join('ã€') || 'æš‚æ— '}

## åŒ»ç–—å»ºè®®
### 1. è¥¿è¯æ²»ç–—æ–¹æ¡ˆ
1. è¯·éµåŒ»å˜±æœç”¨é™å‹è¯ç‰©
2. è¯·éµåŒ»å˜±æ§åˆ¶è¡€ç³–

### 2. ä¸­è¯/æ°‘æ—åŒ»è¯å»ºè®®
1. å»ºè®®åœ¨ä¸“ä¸šä¸­åŒ»æŒ‡å¯¼ä¸‹ä½¿ç”¨ä¸­è¯è°ƒç†
2. è¾¨è¯æ–½æ²»ï¼Œæ ¹æ®ä½“è´¨ä¸ªæ€§åŒ–ç”¨è¯

## ç”Ÿæ´»å»ºè®®
### 1. é¥®é£Ÿå»ºè®®
- å‡å°‘ç›åˆ†æ‘„å…¥ï¼Œæ§åˆ¶æ¯æ—¥æ‘„å…¥é‡ä½äº6g
- é™åˆ¶é«˜ç³–é£Ÿç‰©ï¼Œå¢åŠ è†³é£Ÿçº¤ç»´æ‘„å…¥
- å¤šé£Ÿç”¨æ–°é²œè”¬æœï¼Œæ§åˆ¶æ€»çƒ­é‡

### 2. è¿åŠ¨å»ºè®®
- åšæŒæœ‰æ°§è¿åŠ¨ï¼Œå¦‚å¿«èµ°ã€æ¸¸æ³³ç­‰
- æ¯å‘¨è‡³å°‘150åˆ†é’Ÿä¸­ç­‰å¼ºåº¦è¿åŠ¨
- é¿å…å‰§çƒˆè¿åŠ¨ï¼Œæ§åˆ¶è¿åŠ¨å¼ºåº¦

## æ³¨æ„äº‹é¡¹
å®šæœŸç›‘æµ‹è¡€å‹å’Œè¡€ç³–ï¼Œå‡ºç°å¼‚å¸¸åŠæ—¶å°±åŒ»ã€‚ä¿æŒè‰¯å¥½å¿ƒæ€ï¼Œé¿å…æƒ…ç»ªæ³¢åŠ¨ã€‚

*æœ¬æŠ¥å‘Šä¸ºä¸´æ—¶ç”Ÿæˆï¼Œè¯·ä»¥åŒ»ç”Ÿè¯Šæ–­ä¸ºå‡†*
`;
        }
    
        // è¯„ä¼°è¡€å‹
        function evaluateBloodPressure(systolic, diastolic) {
            if (systolic < 120 && diastolic < 80) {
                return "æ­£å¸¸";
            } else if ((systolic >= 120 && systolic < 140) || (diastolic >= 80 && diastolic < 90)) {
                return "è¡€å‹åé«˜";
            } else if (systolic >= 140 || diastolic >= 90) {
                return "é«˜è¡€å‹";
            }
            return "éœ€è¯„ä¼°";
        }
    
        // è¯„ä¼°è¡€ç³–
        function evaluateBloodSugar(value, isFasting) {
            if (isFasting) {
                if (value < 6.1) return "æ­£å¸¸";
                else if (value >= 6.1 && value < 7.0) return "ç©ºè…¹è¡€ç³–å—æŸ";
                else return "åé«˜";
            } else {
                if (value < 7.8) return "æ­£å¸¸";
                else if (value >= 7.8 && value < 11.1) return "ç³–è€é‡å—æŸ";
                else return "åé«˜";
            }
        }
    
        // æ›´æ–°æ˜¾ç¤ºæŠ¥å‘Šçš„ä¸»å‡½æ•°
function showReport(formData, reportContent) {
    // ç§»é™¤å¯èƒ½å‡ºç°çš„markdownå‰ç¼€å’Œæ ‡è®°
    let cleanedReportContent = reportContent.replace(/^markdown\s*/i, '').replace(/\bmarkdown\b/gi, '');
    
    // å°†Markdownè½¬æ¢ä¸ºHTML
    const htmlContent = parseMarkdown(cleanedReportContent);
    
            // æ·»åŠ æ°‘æ—åŒ»è¯å»ºè®®ç‰¹æ®ŠåŒºåŸŸ
            const enhancedHtmlContent = addEthnicMedicineHighlight(htmlContent, formData.ethnicity);
            
            // ä¿å­˜åŸæ¥çš„é¡¶éƒ¨å·¥å…·æ 
            const originalToolbar = document.querySelector('.top-toolbar');
            
            // æ›´æ–°DOMæ˜¾ç¤ºæŠ¥å‘Šï¼Œä½†ä¿ç•™é¡¶éƒ¨å·¥å…·æ 
    document.getElementById('healthForm').style.display = 'none';
    document.getElementById('reportContainer').innerHTML = `
                <h2>${formData.name}${isMiaoMode ? ' Jiank Kangt Baot' : 'çš„å¥åº·æŠ¥å‘Š'}</h2>
                <div class="language-indicator">${isMiaoMode ? 'è‹—è¯­ç‰ˆæœ¬' : 'ä¸­æ–‡ç‰ˆæœ¬'}</div>
        <div class="report-section">
                    <div class="report-content" contenteditable="true">${enhancedHtmlContent}</div>
        </div>
                <div class="report-controls">
                    <button class="control-btn" onclick="printReport()">æ‰“å°æŠ¥å‘Š</button>
                    <button class="control-btn" onclick="saveReport()">ä¿å­˜æŠ¥å‘Š</button>
                    <button onclick="location.reload()">${isMiaoMode ? 'Rout Diex Dab' : 'è¿”å›é—®è¯Šè¡¨å•'}</button>
                </div>
    `;
    document.getElementById('reportContainer').style.display = 'block';
    
    // åº”ç”¨ä¼˜åŒ–æ ·å¼
    applyOptimizedReportStyles();
            
            // ç¡®ä¿å·¥å…·æ æŒ‰é’®åœ¨æŠ¥å‘Šé¡µé¢ä»ç„¶æœ‰æ•ˆ
            rebindToolbarEvents();
        }
        
        // æ–°å¢å‡½æ•°ï¼šé‡æ–°ç»‘å®šå·¥å…·æ äº‹ä»¶
        function rebindToolbarEvents() {
            // é‡æ–°è·å–å­—ä½“å¤§å°æŒ‰é’®å¹¶ç»‘å®šäº‹ä»¶
            const fontSizeToggle = document.getElementById('font-size-toggle');
            if (fontSizeToggle) {
                fontSizeToggle.addEventListener('click', function() {
                    currentFontSize = (currentFontSize + 1) % 3;
                    document.body.classList.remove('large-font', 'x-large-font');
                    
                    if (currentFontSize === 1) {
                        document.body.classList.add('large-font');
                        this.innerHTML = '<span>Aa</span> ' + (isMiaoMode ? 'Meil Delk' : 'å¤§å­—æ¨¡å¼');
                    } else if (currentFontSize === 2) {
                        document.body.classList.add('x-large-font');
                        this.innerHTML = '<span>Aa</span> ' + (isMiaoMode ? 'Meil Dal' : 'ç‰¹å¤§å­—ä½“');
                    } else {
                        this.innerHTML = '<span>Aa</span> ' + (isMiaoMode ? 'Meil Delk Lol' : 'å¤§å­—æ˜¾ç¤º');
                    }
                });
            }
            
            // é‡æ–°ç»‘å®šè¯­è¨€åˆ‡æ¢æŒ‰é’®äº‹ä»¶
            const languageToggle = document.getElementById('language-toggle');
            if (languageToggle) {
                languageToggle.addEventListener('click', function() {
                    // åœ¨æŠ¥å‘Šé¡µé¢ä¸å…è®¸åˆ‡æ¢è¯­è¨€ï¼Œå› ä¸ºè¿™éœ€è¦é‡æ–°ç”ŸæˆæŠ¥å‘Š
                    alert('æŠ¥å‘Šå·²ç”Ÿæˆï¼Œæ— æ³•åœ¨æ­¤é¡µé¢åˆ‡æ¢è¯­è¨€ã€‚è¯·è¿”å›è¡¨å•é¡µé¢é‡æ–°ç”ŸæˆæŠ¥å‘Šã€‚');
                });
            }
        }

        // ä¿®æ”¹é«˜äº®æ°‘æ—åŒ»è¯å»ºè®®éƒ¨åˆ†çš„å‡½æ•°
        function addEthnicMedicineHighlight(html, ethnicity) {
            // è¯†åˆ«åŒ…å«æ°‘æ—åŒ»è¯å»ºè®®çš„æ ‡é¢˜å’Œå†…å®¹
            const ethnicMedicineRegex = /<h2>æ°‘æ—åŒ»è¯ç‰¹è‰²å»ºè®®<\/h2>|<h2>Minb Zux Yak<\/h2>/;
            
            // å¦‚æœæ˜¯è‹—æ—ç”¨æˆ·æˆ–ä½¿ç”¨è‹—è¯­æ¨¡å¼ï¼Œç¡®ä¿æ°‘æ—åŒ»è¯å»ºè®®éƒ¨åˆ†å¾—åˆ°çªå‡ºæ˜¾ç¤º
            const shouldHighlightEthnicMedicine = ethnicity === 'è‹—æ—' || isMiaoMode;
            
            if (ethnicMedicineRegex.test(html)) {
                // æå–æ°‘æ—åŒ»è¯éƒ¨åˆ†çš„å†…å®¹
                let parts = html.split(ethnicMedicineRegex);
                if (parts.length >= 2) {
                    // æ‰¾åˆ°ä¸‹ä¸€ä¸ªh2æ ‡é¢˜çš„ä½ç½®ï¼Œæˆªå–ä¸­é—´éƒ¨åˆ†
                    const nextH2Index = parts[1].indexOf('<h2>');
                    let ethnicMedicinePart;
                    
                    if (nextH2Index !== -1) {
                        ethnicMedicinePart = parts[1].substring(0, nextH2Index);
                        parts[1] = parts[1].substring(nextH2Index);
                    } else {
                        ethnicMedicinePart = parts[1];
                        parts[1] = '';
                    }
                    
                    // åº”ç”¨ç‰¹æ®Šæ ·å¼åˆ°æ°‘æ—åŒ»è¯éƒ¨åˆ†
                    const ethnicMedicineHtml = `
                    <div class="ethnic-medicine-advice">
                        <h2>${isMiaoMode ? 'Minb Zux Yak' : 'æ°‘æ—åŒ»è¯ç‰¹è‰²å»ºè®®'}</h2>
                        ${ethnicMedicinePart}
                        ${shouldHighlightEthnicMedicine ? '<div class="miao-medicine-note">ä»¥ä¸Šå»ºè®®æ ¹æ®è‹—æ—ä¼ ç»ŸåŒ»è¯çŸ¥è¯†æä¾›ï¼Œç»“åˆç°ä»£åŒ»å­¦ç†è®ºå‚è€ƒã€‚</div>' : ''}
                    </div>
                    `;
                    
                    // é‡ç»„HTML
                    return parts[0] + ethnicMedicineHtml + parts[1];
                }
            }
            
            return html;
}

// Markdownè§£æä¸»å‡½æ•°
function parseMarkdown(markdown) {
    // å¤„ç†æ ‡é¢˜
    let html = markdown
        .replace(/^# (.*$)/gm, '<h1>$1</h1>')
        .replace(/^## (.*$)/gm, '<h2>$1</h2>')
        .replace(/^### (.*$)/gm, '<h3>$1</h3>')
        .replace(/^#### (.*$)/gm, '<h4>$1</h4>');
    
    // å¤„ç†åˆ—è¡¨ - ä½¿ç”¨æ–°çš„ç®€åŒ–æ–¹æ³•
    html = processLists(html);
    
    // å¤„ç†ç²—ä½“å’Œæ–œä½“
    html = html
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.*?)\*/g, '<em>$1</em>')
        .replace(/_([^_]+)_/g, '<em>$1</em>');
    
    // å¤„ç†ä»£ç 
    html = html
        .replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>')
        .replace(/`([^`]+)`/g, '<code>$1</code>');
    
    // å¤„ç†é“¾æ¥å’Œå›¾ç‰‡
    html = html
        .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2">$1</a>')
        .replace(/!\[([^\]]+)\]\(([^)]+)\)/g, '<img src="$2" alt="$1">');
    
    // å¤„ç†å¼•ç”¨å’Œæ°´å¹³çº¿
    html = html
        .replace(/^> (.*$)/gm, '<blockquote>$1</blockquote>')
        .replace(/^\-\-\-$/gm, '<hr>');
    
    // å¤„ç†æ®µè½
    html = processParagraphs(html);
    
    return html;
}
        
function addBulletListStyle() {
    const styleElement = document.createElement('style');
    styleElement.textContent = `
        .bullet-list {
            list-style-type: disc; /* ä½¿ç”¨å®å¿ƒåœ†ç‚¹ */
            padding-left: 30px;
            margin: 15px 0;
        }
        
        .bullet-list li {
            margin-bottom: 8px;
            position: relative;
        }
        
        /* ç§»é™¤æ—§çš„ç¼–å·æ ·å¼ */
        .numbered-list {
            list-style-type: disc !important; /* å¼ºåˆ¶ä½¿ç”¨å®å¿ƒåœ†ç‚¹ */
        }
        
        .numbered-list li::before {
            content: none !important; /* ç§»é™¤è‡ªå®šä¹‰ç¼–å· */
        }
    `;
    document.head.appendChild(styleElement);
}

// å¤„ç†æ®µè½
function processParagraphs(html) {
    // æŒ‰æ¢è¡Œç¬¦åˆ†å‰²
    const lines = html.split('\n');
    let processedHtml = '';
    let inParagraph = false;
    
    for (let i = 0; i < lines.length; i++) {
        const line = lines[i].trim();
        
        // è·³è¿‡å·²ç»æ˜¯HTMLæ ‡ç­¾çš„è¡Œ
        if (!line || 
            line.startsWith('<h') || 
            line.startsWith('<ul') || 
            line.startsWith('<ol') || 
            line.startsWith('<li') || 
            line.startsWith('<pre') || 
            line.startsWith('<blockquote') ||
            line.startsWith('<hr') ||
            line.startsWith('</')) {
            
            if (inParagraph) {
                processedHtml += '</p>\n';
                inParagraph = false;
            }
            
            processedHtml += line + '\n';
            continue;
        }
        
        // å¼€å§‹æ–°æ®µè½
        if (!inParagraph) {
            processedHtml += '<p>' + line;
            inParagraph = true;
        } else {
            // ç»§ç»­å½“å‰æ®µè½
            processedHtml += '<br>' + line;
        }
        
        // å¦‚æœä¸‹ä¸€è¡Œæ˜¯ç©ºè¡Œæˆ–è€…æ˜¯HTMLæ ‡ç­¾ï¼Œç»“æŸå½“å‰æ®µè½
        if (i === lines.length - 1 || 
            !lines[i + 1].trim() || 
            lines[i + 1].trim().startsWith('<')) {
            
            if (inParagraph) {
                processedHtml += '</p>\n';
                inParagraph = false;
            }
        }
    }
    
    // ç¡®ä¿æ‰€æœ‰æ®µè½éƒ½æ­£ç¡®å…³é—­
    if (inParagraph) {
        processedHtml += '</p>\n';
    }
    
    return processedHtml;
}

// å®Œå…¨é‡å†™åˆ—è¡¨å¤„ç†å‡½æ•°ï¼Œå°†æ‰€æœ‰æœ‰åºåˆ—è¡¨è½¬æ¢ä¸ºæ— åºåˆ—è¡¨ï¼ˆé¡¹ç›®ç¬¦å·ï¼‰
function processLists(text) {
    // 1. å…ˆç§»é™¤æ‰€æœ‰ç±»å‹çš„åˆ—è¡¨æ ‡è®°ï¼ŒåŒ…æ‹¬ç¼–å·å’Œç¬¦å·
    let cleanedText = text;
    
    // ç§»é™¤é‡å¤çš„ç¼–å·ï¼ˆå¦‚"1. 1."ï¼‰
    cleanedText = cleanedText.replace(/^(\s*)(\d+)\.\s*(\d+)\.\s+(.*?)$/gm, function(match, space, num1, num2, content) {
        return `${space}BULLET_MARKER ${content}`;
    });
    
    // ç§»é™¤å•ä¸ªç¼–å·ï¼ˆå¦‚"1."ï¼‰
    cleanedText = cleanedText.replace(/^(\s*)(\d+)\.\s+(.*?)$/gm, function(match, space, num, content) {
        return `${space}BULLET_MARKER ${content}`;
    });
    
    // ç§»é™¤æ— åºåˆ—è¡¨ç¬¦å·ï¼ˆå¦‚"- "ã€"* "ã€"+ "ï¼‰
    cleanedText = cleanedText.replace(/^(\s*)[-*+]\s+(.*?)$/gm, function(match, space, content) {
        return `${space}BULLET_MARKER ${content}`;
    });
    
    // 2. è¯†åˆ«åˆ—è¡¨åŒºåŸŸå¹¶è½¬æ¢ä¸ºæ— åºåˆ—è¡¨
    const lines = cleanedText.split('\n');
    let result = '';
    let inList = false;
    let listItems = [];
    
    for (let i = 0; i < lines.length; i++) {
        const line = lines[i];
        // æŸ¥æ‰¾æˆ‘ä»¬æ ‡è®°çš„åˆ—è¡¨é¡¹
        const listItemMatch = line.match(/^(\s*)BULLET_MARKER\s+(.*)/);
        
        if (listItemMatch) {
            // æ‰¾åˆ°åˆ—è¡¨é¡¹
            if (!inList) {
                // å¼€å§‹ä¸€ä¸ªæ–°åˆ—è¡¨
                inList = true;
                listItems = [];
            }
            
            // æ·»åŠ åˆ—è¡¨é¡¹å†…å®¹
            listItems.push(listItemMatch[2]);
        } else if (inList && (line.trim() === '' || !line.includes('BULLET_MARKER'))) {
            // åˆ—è¡¨ç»“æŸ
            result += generateBulletListHtml(listItems);
            inList = false;
            listItems = [];
            if (line.trim() !== '') {
                result += line;
            }
            result += '\n';
        } else {
            // éåˆ—è¡¨å†…å®¹
            result += line + '\n';
        }
    }
    
    // å¤„ç†æ–‡æ¡£ç»“æŸæ—¶çš„åˆ—è¡¨
    if (inList) {
        result += generateBulletListHtml(listItems);
    }
    
    return result;
}
        
// ç”Ÿæˆé¡¹ç›®ç¬¦å·åˆ—è¡¨HTML
function generateBulletListHtml(items) {
    if (items.length === 0) return '';
    
    let html = '<ul class="bullet-list">\n';
    for (let item of items) {
        html += `  <li>${item}</li>\n`;
    }
    html += '</ul>\n';
    return html;
}
        
// å¤„ç†æœ‰åºåˆ—è¡¨ - ä¿®å¤é‡å¤ç¼–å·é—®é¢˜
function processOrderedLists(text) {
    // 1. å…ˆç§»é™¤è¡Œé¦–çš„æ•°å­—ç¼–å·ï¼Œä¿ç•™å†…å®¹
    let cleanedText = text.replace(/^(\s*)(\d+)\.\s*(\d+)\.\s+(.*?)$/gm, function(match, space, num1, num2, content) {
        // åªä¿ç•™å†…å®¹ï¼Œåˆ é™¤æ‰€æœ‰ç¼–å·
        return `${space}LIST_ITEM_MARKER ${content}`;
    });

    // 2. å¯¹äºåªæœ‰ä¸€ä¸ªç¼–å·çš„è¡Œä¹Ÿè¿›è¡Œå¤„ç†
    cleanedText = cleanedText.replace(/^(\s*)(\d+)\.\s+(.*?)$/gm, function(match, space, num, content) {
        return `${space}LIST_ITEM_MARKER ${content}`;
    });

    // 3. è¯†åˆ«åˆ—è¡¨åŒºåŸŸ
    const lines = cleanedText.split('\n');
    let result = '';
    let inList = false;
    let listItems = [];
    
    for (let i = 0; i < lines.length; i++) {
        const line = lines[i];
        // æŸ¥æ‰¾æˆ‘ä»¬æ ‡è®°çš„åˆ—è¡¨é¡¹
        const listItemMatch = line.match(/^(\s*)LIST_ITEM_MARKER\s+(.*)/);
        
        if (listItemMatch) {
            // æ‰¾åˆ°åˆ—è¡¨é¡¹
            if (!inList) {
                // å¼€å§‹ä¸€ä¸ªæ–°åˆ—è¡¨
                inList = true;
                listItems = [];
            }
            
            // æ·»åŠ åˆ—è¡¨é¡¹å†…å®¹
            listItems.push(listItemMatch[2]);
        } else if (inList && line.trim() === '') {
            // ç©ºè¡Œç»“æŸåˆ—è¡¨
            result += generateOrderedListHtml(listItems);
            inList = false;
            listItems = [];
            result += '\n';
        } else if (inList) {
            // å…¶ä»–å†…å®¹ç»“æŸåˆ—è¡¨
            result += generateOrderedListHtml(listItems);
            inList = false;
            listItems = [];
            result += line + '\n';
        } else {
            // éåˆ—è¡¨å†…å®¹
            result += line + '\n';
        }
    }
    
    // å¤„ç†æ–‡æ¡£ç»“æŸæ—¶çš„åˆ—è¡¨
    if (inList) {
        result += generateOrderedListHtml(listItems);
    }
    
    return result;
}

// ç”Ÿæˆæœ‰åºåˆ—è¡¨HTML
function generateOrderedListHtml(items) {
    if (items.length === 0) return '';
    
    let html = '<ol class="numbered-list">\n';
    for (let item of items) {
        html += `  <li>${item}</li>\n`;
    }
    html += '</ol>\n';
    return html;
}

// å¤„ç†æ— åºåˆ—è¡¨
function processUnorderedLists(text) {
    const lines = text.split('\n');
    let result = '';
    let inList = false;
    let listItems = [];
    
    for (let i = 0; i < lines.length; i++) {
        const line = lines[i];
        const listMatch = line.match(/^(\s*)[-*+]\s+(.*)/);
        
        if (listMatch) {
            // æ‰¾åˆ°æ— åºåˆ—è¡¨é¡¹
            if (!inList) {
                inList = true;
                listItems = [];
            }
            
            // ä¿å­˜åˆ—è¡¨é¡¹
            const indent = listMatch[1].length;
            const content = listMatch[2];
            listItems.push({ indent, content });
        } else if (inList && (line.trim() === '' || !line.match(/^(\s*)[-*+]\s+(.*)/))) {
            // åˆ—è¡¨ç»“æŸ
            result += generateUnorderedListHtml(listItems);
            inList = false;
            listItems = [];
            result += line + '\n';
        } else {
            // éåˆ—è¡¨å†…å®¹
            result += line + '\n';
        }
    }
    
    // å¤„ç†æ–‡æ¡£ç»“æŸæ—¶çš„åˆ—è¡¨
    if (inList) {
        result += generateUnorderedListHtml(listItems);
    }
    
    return result;
}

// ç”Ÿæˆæ— åºåˆ—è¡¨HTML
function generateUnorderedListHtml(items) {
    if (items.length === 0) return '';
    
    let html = '<ul class="bulleted-list">\n';
    
    for (let item of items) {
        html += `  <li>${item.content}</li>\n`;
    }
    
    html += '</ul>\n';
    return html;
}
        
// æ·»åŠ å¢å¼ºçš„æŠ¥å‘Šæ ·å¼
function applyOptimizedReportStyles() {
    const styleElement = document.createElement('style');
    styleElement.textContent = `
        /* å®¹å™¨æ ·å¼ */
        .container {
            padding: 30px !important;
            margin: 0 auto !important;
        }

                /* å…¨å±€å­—ä½“è®¾ç½® */
                #reportContainer, .report-section, .report-content, 
                .report-content h2, .report-content h3, .report-content p, 
                .report-content ul, .report-content ol, .report-content li {
                    font-family: "Microsoft YaHei", "å¾®è½¯é›…é»‘", sans-serif !important;
                }

                /* æŠ¥å‘ŠåŒºåŸŸå“åº”å¼å­—ä½“å¤§å° */
                body.large-font .report-content {
                    font-size: 18px !important;
                }
                
                body.large-font .report-content h2 {
                    font-size: 30px !important;
                }
                
                body.large-font .report-content h3 {
                    font-size: 24px !important;
                }
                
                body.x-large-font .report-content {
                    font-size: 22px !important;
                }
                
                body.x-large-font .report-content h2 {
                    font-size: 36px !important;
                }
                
                body.x-large-font .report-content h3 {
                    font-size: 28px !important;
                }
                
                /* ä¿æŒå·¥å…·æ åœ¨æŠ¥å‘Šé¡µé¢å¯è§ */
                .top-toolbar {
                    position: fixed;
                    top: 15px;
                    right: 20px;
                    display: flex;
                    gap: 15px;
                    z-index: 1000;
                    background: rgba(255, 255, 255, 0.9);
                    padding: 5px;
                    border-radius: 30px;
                    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
                }
                
                /* å…¶ä½™åŸæœ‰æ ·å¼... */
            `;
            document.head.appendChild(styleElement);
        }

        // ä¿®å¤å·¥å…·æ ä½ç½®é—®é¢˜
        document.addEventListener('DOMContentLoaded', function() {
            // ç¡®ä¿å·¥å…·æ å§‹ç»ˆä½äºçª—å£é¡¶éƒ¨
            const toolbar = document.querySelector('.top-toolbar');
            if (toolbar) {
                document.body.appendChild(toolbar);
            }
        });

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥URLå‚æ•°ï¼Œè‡ªåŠ¨æ¿€æ´»ç›¸åº”æ¨¡å¼
        window.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            
            // æ£€æŸ¥æ˜¯å¦æœ‰è¯­è¨€è®¾ç½®å‚æ•°
            if (urlParams.has('lang')) {
                const lang = urlParams.get('lang');
                if (lang === 'miao') {
                    // è‡ªåŠ¨æ¿€æ´»è‹—è¯­æ¨¡å¼
                    isMiaoMode = true;
                    languageToggle.classList.add('active');
                    languageToggle.innerHTML = '<span>ä¸­</span> åˆ‡æ¢ä¸­æ–‡';
                    translateToMiao();
                }
            }
            
            // æ£€æŸ¥æ˜¯å¦æœ‰å­—ä½“å¤§å°å‚æ•°
            if (urlParams.has('fontSize')) {
                const size = urlParams.get('fontSize');
                if (size === 'large') {
                    currentFontSize = 1;
                    document.body.classList.add('large-font');
                    fontSizeToggle.innerHTML = '<span>Aa</span> ' + (isMiaoMode ? 'Meil Delk' : 'å¤§å­—æ¨¡å¼');
                } else if (size === 'xlarge') {
                    currentFontSize = 2;
                    document.body.classList.add('x-large-font');
                    fontSizeToggle.innerHTML = '<span>Aa</span> ' + (isMiaoMode ? 'Meil Dal' : 'ç‰¹å¤§å­—ä½“');
                }
            }
            
            // æ£€æŸ¥æ˜¯å¦æœ‰åŒè¯­æ¨¡å¼å‚æ•°
            if (urlParams.has('bilingual') && urlParams.get('bilingual') === 'true') {
                isBilingualMode = true;
                inputModeToggle.classList.add('active');
                inputModeToggle.innerHTML = '<span>å•</span> ' + (isMiaoMode ? 'Dant Lol Mok' : 'å•è¯­æ¨¡å¼');
            }
        });

        // è®¡ç®—BMIå’Œåˆ†ç±»
        function calculateBMI() {
            const height = parseFloat(document.getElementById('height').value);
            const weight = parseFloat(document.getElementById('weight').value);
            const bmiField = document.getElementById('bmi');
            const bmiCategory = document.getElementById('bmi-category');
            
            if (height && weight && height > 0 && weight > 0) {
                // è®¡ç®—BMI: ä½“é‡(kg) / èº«é«˜(m)Â²
                const heightInMeter = height / 100;
                const bmiValue = (weight / (heightInMeter * heightInMeter)).toFixed(1);
                
                // æ˜¾ç¤ºBMIå€¼
                bmiField.value = bmiValue;
                
                // ç¡®å®šBMIåˆ†ç±»å¹¶æ˜¾ç¤º
                let category = "";
                let color = "";
                
                if (bmiValue < 18.5) {
                    category = isMiaoMode ? "Piant Sout" : "åç˜¦";
                    color = "#4285f4"; // è“è‰²
                } else if (bmiValue < 25) {
                    category = isMiaoMode ? "Zhengb Changk" : "æ­£å¸¸";
                    color = "#34a853"; // ç»¿è‰²
                } else if (bmiValue < 30) {
                    category = isMiaoMode ? "Chaot Zhongb" : "è¶…é‡";
                    color = "#fbbc05"; // é»„è‰²
                } else if (bmiValue < 35) {
                    category = isMiaoMode ? "Feib Pangb" : "è‚¥èƒ–";
                    color = "#ea4335"; // çº¢è‰²
                } else {
                    category = isMiaoMode ? "Zhongb Feib" : "é‡åº¦è‚¥èƒ–";
                    color = "#a50e0e"; // æ·±çº¢è‰²
                }
                
                bmiCategory.textContent = category;
                bmiCategory.style.color = color;
            } else {
                // æ¸…ç©ºç»“æœ
                bmiField.value = "";
                bmiCategory.textContent = "";
            }
        }

        // æ·»åŠ æ‰“å°æŠ¥å‘ŠåŠŸèƒ½
        function printReport() {
            window.print();
        }

        // æ·»åŠ ä¿å­˜æŠ¥å‘ŠåŠŸèƒ½
        function saveReport() {
            const reportContent = document.querySelector('.report-content').innerHTML;
            const patientName = document.querySelector('#reportContainer h2').textContent.replace(/çš„å¥åº·æŠ¥å‘Š|Jiank Kangt Baot/g, '');
            const dateStr = new Date().toLocaleDateString().replace(/\//g, '-');
            
            // åˆ›å»ºä¸€ä¸ªä¸´æ—¶é“¾æ¥ç”¨äºä¸‹è½½
            const a = document.createElement('a');
            const blob = new Blob([`
            <!DOCTYPE html>
            <html>
            <head>
                <meta charset="UTF-8">
                <title>${patientName}çš„å¥åº·æŠ¥å‘Š - ${dateStr}</title>
                <style>
                    body {
                        font-family: "Microsoft YaHei", "å¾®è½¯é›…é»‘", sans-serif;
                        margin: 40px;
                        line-height: 1.6;
                        color: #333;
                    }
                    h1, h2, h3 {
                        color: #1a73e8;
                    }
                    .report-content {
                        background: #fff;
                        padding: 20px;
                        border-radius: 8px;
                    }
                    ul, ol {
                        padding-left: 25px;
                    }
                    .ethnic-medicine-advice {
                        background: #f0f8f0;
                        padding: 15px;
                        border-left: 4px solid #34a853;
            margin: 20px 0;
            border-radius: 6px;
                    }
                </style>
            </head>
            <body>
                <h1>${patientName}çš„å¥åº·æŠ¥å‘Š</h1>
                <p>ç”Ÿæˆæ—¥æœŸï¼š${dateStr}</p>
                <div class="report-content">
                    ${reportContent}
                </div>
            </body>
            </html>
            `], {type: 'text/html'});
            
            a.href = URL.createObjectURL(blob);
            a.download = `${patientName}å¥åº·æŠ¥å‘Š-${dateStr}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }
    </script>

    <!-- æ·»åŠ ç›¸å…³CSSæ ·å¼ -->
    <style>
        /* ä¸ºå¯ç¼–è¾‘åŒºåŸŸæ·»åŠ æ ·å¼ */
        .report-content[contenteditable="true"] {
            border: 1px solid transparent;
            transition: all 0.3s ease;
            outline: none;
            padding: 5px;
        }
        
        .report-content[contenteditable="true"]:hover {
            border-color: #dadce0;
            background-color: #f8f9fa;
        }
        
        .report-content[contenteditable="true"]:focus {
            border-color: #4285f4;
            background-color: #fff;
            box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.2);
        }
        
        /* æ·»åŠ æŠ¥å‘Šæ§åˆ¶æŒ‰é’®æ ·å¼ */
        .report-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
        }
        
        .control-btn {
            background: #f8f9fa;
            color: #1a73e8;
            border: 1px solid #dadce0;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .control-btn:hover {
            background: #e8f0fe;
            border-color: #4285f4;
        }
        
        /* æ‰“å°æ ·å¼ä¼˜åŒ– */
        @media print {
            body {
                margin: 0;
                padding: 0;
                background: white;
            }
            
            .top-toolbar, .report-controls, .language-indicator {
                display: none !important;
            }
            
            .report-section {
                box-shadow: none !important;
                border: none !important;
                padding: 0 !important;
            }
            
            .report-content {
                font-size: 12pt !important;
            }
            
            .report-content h2 {
                font-size: 16pt !important;
            }
            
            .report-content h3 {
                font-size: 14pt !important;
            }
        }
    </style>
</body>
</html>
